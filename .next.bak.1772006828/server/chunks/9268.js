exports.id=9268,exports.ids=[9268],exports.modules={4326:(a,b,c)=>{"use strict";c.d(b,{AppShell:()=>e});var d=c(97954);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call AppShell() from the server but AppShell is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/dolho/beyond-pricing/app/src/components/AppShell.tsx","AppShell");(0,d.registerClientReference)(function(){throw Error("Attempted to call PageTransition() from the server but PageTransition is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/dolho/beyond-pricing/app/src/components/AppShell.tsx","PageTransition")},21932:(a,b,c)=>{"use strict";c.d(b,{AppShell:()=>T});var d=c(21124),e=c(3991),f=c.n(e),g=c(42378),h=c(70798),i=c(11913),j=c(40937),k=c(77850),l=c(99821),m=c(45334),n=c(44688),o=c(67748),p=c(94684),q=c(53256),r=c(3663),s=c(74097),t=c(57886),u=c(30720),v=c(94104),w=c(18004),x=c(6343),y=c(46422),z=c(70175),A=c(60988),B=c(19710),C=c(38301),D=c(70045),E=c(30733),F=c(18310),G=c(16636),H=c(47268),I=c(47089);let J={new_message:n.A,new_deliverable:D.A,approval_requested:E.A,request_created:F.A,milestone_reached:G.A};function K(){let[a,b]=(0,C.useState)(!1),[c,e]=(0,C.useState)([]),[g,i]=(0,C.useState)(0),j=(0,C.useRef)(null);(0,C.useMemo)(()=>(0,h.U)(),[]);let k=(0,C.useCallback)(async()=>{let a=await fetch("/api/notifications?limit=20");if(!a.ok)return;let b=await a.json();e(b),i(b.filter(a=>!a.read_at).length)},[]),l=async()=>{await fetch("/api/notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"markAllRead"})}),k()},m=async a=>{await fetch("/api/notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"markRead",id:a})}),k()};return(0,d.jsxs)("div",{className:"relative",ref:j,children:[(0,d.jsxs)("button",{onClick:()=>b(a=>!a),className:"relative p-2 rounded-xl hover:bg-white/10 transition-colors","aria-label":"Notifica\xe7\xf5es",children:[(0,d.jsx)(H.A,{className:"w-5 h-5 text-white/70"}),g>0&&(0,d.jsx)("span",{className:"absolute top-1 right-1 min-w-[16px] h-4 px-0.5 bg-rose-500 rounded-full text-[10px] font-bold text-white flex items-center justify-center",children:g>9?"9+":g})]}),a&&(0,d.jsxs)("div",{className:"absolute right-0 mt-2 w-80 max-h-[480px] rounded-2xl bg-gray-900 border border-white/10 shadow-2xl overflow-hidden flex flex-col z-50",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/8",children:[(0,d.jsx)("span",{className:"text-sm font-semibold text-white",children:"Notifica\xe7\xf5es"}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[g>0&&(0,d.jsx)("button",{onClick:l,className:"text-xs text-white/40 hover:text-white/70 transition-colors",children:"Ler tudo"}),(0,d.jsx)("button",{onClick:()=>b(!1),className:"text-white/40 hover:text-white",children:(0,d.jsx)(I.A,{className:"w-4 h-4"})})]})]}),(0,d.jsx)("div",{className:"overflow-y-auto flex-1",children:0===c.length?(0,d.jsxs)("div",{className:"text-center py-10 text-white/30",children:[(0,d.jsx)(H.A,{className:"w-6 h-6 mx-auto mb-2 opacity-40"}),(0,d.jsx)("p",{className:"text-xs",children:"Sem notifica\xe7\xf5es"})]}):c.map(a=>{let c=J[a.type]??H.A,e=!a.read_at,g=(0,d.jsxs)("div",{onClick:()=>e&&m(a.id),className:`flex gap-3 px-4 py-3 hover:bg-white/5 transition-colors cursor-pointer border-b border-white/5 last:border-0 ${e?"bg-blue-500/5":""}`,children:[(0,d.jsx)("div",{className:`shrink-0 w-8 h-8 rounded-xl flex items-center justify-center ${e?"bg-blue-500/20":"bg-white/8"}`,children:(0,d.jsx)(c,{className:`w-4 h-4 ${e?"text-blue-400":"text-white/40"}`})}),(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsx)("p",{className:`text-xs font-medium line-clamp-1 ${e?"text-white":"text-white/60"}`,children:a.title}),a.body&&(0,d.jsx)("p",{className:"text-xs text-white/40 line-clamp-2 mt-0.5",children:a.body})]}),(0,d.jsx)("span",{className:"text-[10px] text-white/30 shrink-0 mt-0.5",children:function(a){let b=new Date(a),c=Math.floor((Date.now()-b.getTime())/6e4);if(c<1)return"agora";if(c<60)return`${c}m`;let d=Math.floor(c/60);return d<24?`${d}h`:b.toLocaleDateString("pt-PT",{day:"2-digit",month:"short"})}(a.created_at)})]});return a.link_url?(0,d.jsx)(f(),{href:a.link_url,onClick:()=>{m(a.id),b(!1)},children:g},a.id):(0,d.jsx)("div",{children:g},a.id)})})]})]})}var L=c(49377),M=c(53298),N=c(46998);let O=[{href:"/app/dashboard",label:"Dashboard",icon:k.A},{href:"/app/projects",label:"Projects",icon:l.A},{href:"/app/clients",label:"Clients",icon:m.A},{href:"/app/inbox",label:"Inbox",icon:n.A},{href:"/app/insights",label:"Insights",icon:o.A},{href:"/app/settings",label:"Settings",icon:p.A}],P=[{href:"/app/checklists",label:"Checklists",icon:q.A},{href:"/app/templates",label:"Templates",icon:r.A},{href:"/app/journal",label:"Journal",icon:s.A},{href:"/app/tasks",label:"Tasks",icon:t.A},{href:"/app/crm",label:"CRM",icon:u.A},{href:"/app/callsheets",label:"Call Sheets",icon:v.A},{href:"/app/diagnostics",label:"Diagnostics",icon:w.A}],Q=[{href:"/app/tasks",label:"My Tasks",icon:t.A},{href:"/app/callsheets",label:"Calendar",icon:x.A},{href:"/app/inbox",label:"Inbox",icon:n.A}],R=[{href:"/app/dashboard",label:"Dash",icon:k.A},{href:"/app/projects",label:"Projects",icon:l.A},{href:"/app/clients",label:"Clients",icon:m.A},{href:"/app/inbox",label:"Inbox",icon:n.A},{href:"/app/settings",label:"Settings",icon:p.A}];function S(a,b){return("/app/preferences"===a&&(a="/app/settings"),"/app/dashboard"===b)?"/app"===a||"/app/dashboard"===a:a===b||a.startsWith(`${b}/`)}function T({children:a,userEmail:b}){let c=(0,g.usePathname)(),e=(0,g.useRouter)(),[k,l]=(0,C.useState)(!1),{theme:m,toggleTheme:n,dashboardMode:o}=(0,L.D)(),p=(0,i.I)(),q=(0,C.useMemo)(()=>(function(a){let b=O.find(b=>S(a,b.href));return b?.href??"/app/dashboard"})(c),[c]),r=async()=>{l(!0);let a=(0,h.U)();await a.auth.signOut(),e.push("/login"),e.refresh()},s=(b?.[0]??"U").toUpperCase();return(0,d.jsxs)("div",{className:"super-theme super-shell-bg h-dvh min-h-dvh overflow-x-clip",style:{padding:"clamp(16px, 2.5vw, 40px)"},children:[(0,d.jsxs)(M.AC,{className:"mx-auto flex h-full min-h-full w-full max-w-[1440px] flex-col overflow-x-clip",children:[(0,d.jsxs)("header",{className:"super-topbar",children:[(0,d.jsxs)(f(),{href:"/app/dashboard",className:"inline-flex items-center gap-2.5",children:[(0,d.jsx)("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full",style:{background:"var(--accent-blue)",color:"#fff"},children:(0,d.jsx)(y.A,{className:"h-4 w-4"})}),(0,d.jsx)("span",{className:"text-sm font-semibold tracking-tight",style:{color:"var(--text)"},children:"Beyond Pricing"})]}),(0,d.jsx)("div",{className:"hidden min-w-0 flex-1 justify-center px-5 md:flex",children:(0,d.jsx)(M.EE,{tabs:O.map(a=>({href:a.href,label:a.label})),active:q})}),(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,d.jsx)(K,{}),(0,d.jsx)(j.P.button,{onClick:n,className:"icon-btn",title:"dark"===m?"Modo claro":"Modo escuro","aria-label":"dark"===m?"Modo claro":"Modo escuro",...(0,N.HY)({enabled:!p}),children:"dark"===m?(0,d.jsx)(z.A,{className:"h-4 w-4"}):(0,d.jsx)(A.A,{className:"h-4 w-4"})}),(0,d.jsx)(j.P.button,{onClick:r,disabled:k,className:"icon-btn",title:"Terminar sess\xe3o","aria-label":"Terminar sess\xe3o",...(0,N.HY)({enabled:!p}),children:(0,d.jsx)(B.A,{className:"h-4 w-4"})}),(0,d.jsx)("span",{className:"hidden h-8 w-8 items-center justify-center rounded-full text-xs font-semibold md:inline-flex",style:{background:"rgba(26, 143, 163, 0.14)",border:"1px solid rgba(26, 143, 163, 0.32)",color:"var(--accent-blue)"},title:b,children:s})]})]}),(0,d.jsx)("div",{className:"border-b px-3 py-2 md:hidden",style:{borderColor:"var(--border)"},children:(0,d.jsx)(M.EE,{tabs:O.map(a=>({href:a.href,label:a.label})),active:q})}),(0,d.jsx)("main",{className:"min-h-0 flex-1 overflow-y-auto px-4 pb-24 pt-5 md:px-7 md:pb-7 md:pt-6",children:(0,d.jsxs)(j.P.div,{initial:!p&&"initial",animate:p?void 0:"animate",variants:N.HI.page,transition:N.bm.page,className:"mx-auto w-full app-main-grid",children:[(0,d.jsx)("aside",{className:"quick-rail hidden xl:flex",children:("ceo"===o?Q:P).map(a=>{var b;let e="/app/dashboard"===(b=a.href)?"/app"===c||"/app/dashboard"===c:c===b||c.startsWith(`${b}/`);return(0,d.jsxs)(f(),{href:a.href,className:`quick-rail__link ${e?"quick-rail__link--active":""}`,children:[(0,d.jsx)(a.icon,{className:"h-4 w-4"}),(0,d.jsx)("span",{children:a.label})]},a.href)})}),(0,d.jsx)("section",{className:"min-w-0",children:a})]})})]}),(0,d.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 z-40 border-t backdrop-blur-md md:hidden",style:{borderColor:"var(--border)",background:"color-mix(in srgb, var(--surface) 88%, transparent)",paddingBottom:"env(safe-area-inset-bottom)"},children:(0,d.jsx)("div",{className:"mx-auto flex max-w-[1380px] items-stretch justify-around px-1 py-1.5",children:R.map(a=>{let b=S(c,a.href);return(0,d.jsxs)(f(),{href:a.href,className:"relative flex min-w-0 flex-1 flex-col items-center justify-center gap-0.5 rounded-2xl py-1",style:{color:b?"#1a8fa3":"#7d889d"},children:[b?(0,d.jsx)(j.P.span,{layoutId:"mobile-nav-pill",className:"absolute inset-0 rounded-2xl",style:{background:"rgba(26, 143, 163, 0.12)",border:"1px solid rgba(26, 143, 163, 0.26)"},transition:{type:"spring",stiffness:420,damping:34}}):null,(0,d.jsx)(a.icon,{className:"relative z-10 h-4 w-4"}),(0,d.jsx)("span",{className:"relative z-10 text-[0.63rem] font-semibold",children:a.label})]},a.href)})})})]})}},36400:(a,b,c)=>{"use strict";function d(a){return a?"team"===a||"client"===a||"collaborator"===a?a:"freelancer"===a?"collaborator":null:null}async function e(a,b){let c=String(b.app_metadata?.role??"").toLowerCase(),d=new Set;try{let c=a.from("team_members").select("role"),{data:e}=await c.eq("user_id",b.id).limit(10);for(let a of e??[])"string"==typeof a?.role&&d.add(a.role.toLowerCase())}catch{}let e=!1;try{let c=a.from("client_users").select("id"),{data:d}=await c.eq("user_id",b.id).limit(1);e=(d?.length??0)>0}catch{}let f=!1;try{let c=a.from("project_members").select("id",{count:"exact",head:!0}),{count:d,error:e}=await c.eq("user_id",b.id);e||(f=(d??0)>0)}catch{}return{isTeam:d.has("owner")||d.has("admin")||d.has("member")||"owner"===c||"admin"===c||"member"===c,isClient:e,isCollaborator:d.has("collaborator")||d.has("freelancer")||"collaborator"===c||"freelancer"===c||f}}function f(a,b){if("team"===a&&b.isTeam||"client"===a&&b.isClient||"collaborator"===a&&b.isCollaborator)return{ok:!0,message:"Acesso autorizado.",suggestedAudience:a,suggestedPath:"client"===a?"/portal":"/app/dashboard",membership:b};let c=b.isClient?"client":b.isCollaborator?"collaborator":"team";return{ok:!1,message:`Esta conta n\xe3o tem acesso para ${"team"===a?"Equipa Beyond":"client"===a?"Cliente":"Colaborador"}.`,suggestedAudience:c,suggestedPath:"client"===c?"/portal/login?mode=client":"collaborator"===c?"/portal/login?mode=collaborator":"/login?mode=team",membership:b}}c.d(b,{QA:()=>d,rv:()=>e,zb:()=>f})},45291:(a,b,c)=>{"use strict";c.d(b,{ThemeProvider:()=>e});var d=c(97954);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call ThemeProvider() from the server but ThemeProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/dolho/beyond-pricing/app/src/components/ThemeProvider.tsx","ThemeProvider");(0,d.registerClientReference)(function(){throw Error("Attempted to call useTheme() from the server but useTheme is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/dolho/beyond-pricing/app/src/components/ThemeProvider.tsx","useTheme")},50254:(a,b,c)=>{Promise.resolve().then(c.bind(c,21932)),Promise.resolve().then(c.bind(c,49377)),Promise.resolve().then(c.bind(c,50324))},50324:(a,b,c)=>{"use strict";c.d(b,{ToastProvider:()=>n,d:()=>k});var d=c(21124),e=c(38301),f=c(59268),g=c(91292),h=c(71117),i=c(47089);let j=(0,e.createContext)(null);function k(){let a=(0,e.useContext)(j);if(!a)throw Error("useToast must be used inside <ToastProvider>");return a}let l={success:(0,d.jsx)(f.A,{className:"h-4 w-4 shrink-0",style:{color:"#22c55e"}}),error:(0,d.jsx)(g.A,{className:"h-4 w-4 shrink-0",style:{color:"#ef4444"}}),info:(0,d.jsx)(h.A,{className:"h-4 w-4 shrink-0",style:{color:"var(--accent)"}})},m={success:"rgba(34,197,94,0.3)",error:"rgba(239,68,68,0.3)",info:"rgba(26,143,163,0.3)"};function n({children:a}){let[b,c]=(0,e.useState)([]),f=(0,e.useRef)({}),g=(0,e.useCallback)(a=>{c(b=>b.filter(b=>b.id!==a)),f.current[a]&&(clearTimeout(f.current[a]),delete f.current[a])},[]),h=(0,e.useCallback)((a,b)=>{let d=Math.random().toString(36).slice(2);c(c=>[...c.slice(-4),{id:d,type:a,message:b}]),f.current[d]=setTimeout(()=>g(d),3500)},[g]),k=(0,e.useMemo)(()=>({success:a=>h("success",a),error:a=>h("error",a),info:a=>h("info",a)}),[h]);return(0,d.jsxs)(j.Provider,{value:k,children:[a,(0,d.jsx)("div",{"aria-live":"polite",className:"fixed bottom-5 right-4 z-[9999] flex flex-col gap-2 items-end pointer-events-none",style:{maxWidth:"min(380px, calc(100vw - 2rem))"},children:b.map(a=>(0,d.jsxs)("div",{role:"alert",className:"pointer-events-auto flex items-start gap-3 rounded-xl px-4 py-3 text-sm shadow-lg animate-toast-in",style:{background:"var(--surface-3)",border:`1px solid ${m[a.type]}`,backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",color:"var(--text)",minWidth:"240px"},children:[l[a.type],(0,d.jsx)("p",{className:"flex-1 leading-snug",style:{color:"var(--text)"},children:a.message}),(0,d.jsx)("button",{onClick:()=>g(a.id),className:"shrink-0 mt-0.5 opacity-50 hover:opacity-100 transition-opacity","aria-label":"Fechar",children:(0,d.jsx)(i.A,{className:"h-3.5 w-3.5"})})]},a.id))}),(0,d.jsx)("style",{children:`
        @keyframes toast-in {
          from { opacity: 0; transform: translateY(8px) scale(0.96); }
          to   { opacity: 1; transform: translateY(0) scale(1); }
        }
        .animate-toast-in { animation: toast-in 0.18s ease-out forwards; }
      `})]})}},77078:(a,b,c)=>{"use strict";c.d(b,{ToastProvider:()=>e});var d=c(97954);(0,d.registerClientReference)(function(){throw Error("Attempted to call useToast() from the server but useToast is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/dolho/beyond-pricing/app/src/components/Toast.tsx","useToast");let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call ToastProvider() from the server but ToastProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/dolho/beyond-pricing/app/src/components/Toast.tsx","ToastProvider")},79816:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>k});var d=c(75338),e=c(82161),f=c(95030),g=c(4326),h=c(77078),i=c(45291),j=c(36400);async function k({children:a}){let b=await (0,f.U)(),{data:{user:c}}=await b.auth.getUser();c||(0,e.redirect)("/login");let k=await (0,j.rv)(b,c);return k.isTeam||(await b.auth.signOut(),(k.isClient||k.isCollaborator)&&(0,e.redirect)("/portal/login?mismatch=1"),(0,e.redirect)("/login?mode=team&mismatch=1")),(0,d.jsx)(i.ThemeProvider,{userId:c.id,children:(0,d.jsxs)(h.ToastProvider,{children:[!1,(0,d.jsx)(g.AppShell,{userEmail:c.email??"",children:a})]})})}},80518:(a,b,c)=>{Promise.resolve().then(c.bind(c,4326)),Promise.resolve().then(c.bind(c,45291)),Promise.resolve().then(c.bind(c,77078))},95030:(a,b,c)=>{"use strict";c.d(b,{U:()=>f});var d=c(86802),e=c(4410);async function f(){let a=await (0,d.UL)();return(0,e.createServerClient)("https://wjzcutnjnzxylzqysneg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndqemN1dG5qbnp4eWx6cXlzbmVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMjYzMjcsImV4cCI6MjA4NjkwMjMyN30.bku3F43nks_Uq22Ag-viZZpMQfrw43eq3sahNChbBq8",{cookies:{getAll:()=>a.getAll(),setAll(b){try{b.forEach(({name:b,value:c,options:d})=>{a.set(b,c,d)})}catch{}}}})}}};