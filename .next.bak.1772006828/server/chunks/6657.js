exports.id=6657,exports.ids=[6657],exports.modules={4426:(a,b,c)=>{"use strict";c.d(b,{default:()=>n});var d=c(21124),e=c(38301),f=c(40937),g=c(70798),h=c(44943),i=c(93930),j=c(49377),k=c(53298);let l={crew:"Crew",equipamento:"Equipamento",pos_producao:"P\xf3s",despesas:"Despesas",outro:"Outros"};function m(a){let b=(a??"").toLowerCase();return"rascunho"===b||"draft"===b?"Rascunho":"enviado"===b||"sent"===b?"Enviado":"aprovado"===b||"approved"===b?"Aprovado":"cancelado"===b||"cancelled"===b?"Cancelado":"arquivado"===b||"archived"===b?"Arquivado":"done"===b?"Done":"todo"===b?"Todo":a||"Ativo"}function n(){let{dashboardMode:a,setDashboardMode:b}=(0,j.D)(),[c,n]=(0,e.useState)(!0),[o,p]=(0,e.useState)(null),[q,r]=(0,e.useState)(""),[s,t]=(0,e.useState)([]),[u,v]=(0,e.useState)([]),[w,x]=(0,e.useState)([]),[y,z]=(0,e.useState)(0),[A,B]=(0,e.useState)(0),[C,D]=(0,e.useState)(0),[E,F]=(0,e.useState)(0),[G,H]=(0,e.useState)(0),[I,J]=(0,e.useState)("Daniel"),K=(0,e.useCallback)(async()=>{n(!0),p(null);try{let a=(0,g.U)(),{data:b}=await a.auth.getUser(),c=b.user,d=c?.email?.split("@")[0]?.split(".")[0]??"Daniel",e=c?.user_metadata?.first_name??c?.user_metadata?.name?.split(" ")?.[0]??d;J(e.charAt(0).toUpperCase()+e.slice(1));let[f,h,i,j,k,l,m,n]=await Promise.all([a.from("projects").select("id, project_name, client_name, status, created_at, calc, inputs").is("deleted_at",null).order("created_at",{ascending:!1}).limit(120),a.from("tasks").select("id, title, status, due_date, created_at").is("deleted_at",null).order("created_at",{ascending:!1}).limit(120),a.from("clients").select("id",{count:"exact",head:!0}).is("deleted_at",null),a.from("conversations").select("id",{count:"exact",head:!0}),a.from("call_sheets").select("id",{count:"exact",head:!0}),a.from("call_sheets").select("id, created_at").order("created_at",{ascending:!1}).limit(8),a.from("logistics_routes").select("id",{count:"exact",head:!0}),a.from("weather_cache").select("id",{count:"exact",head:!0})]);if(f.error)throw Error(f.error.message);if(h.error)throw Error(h.error.message);if(i.error)throw Error(i.error.message);t(f.data??[]),v(h.data??[]),x(l.data??[]),z(i.count??0),B(j.count??0),D(k.count??0),F(m.count??0),H(n.count??0)}catch(a){p(a instanceof Error?a.message:"Erro ao carregar dashboard")}finally{n(!1)}},[]),L=Date.now(),M=L-6048e5,N=(0,e.useMemo)(()=>{let a=s.length,b=s.filter(a=>new Date(a.created_at).getTime()>=M).length,c=u.filter(a=>"done"!==a.status).length,d=s.filter(a=>["enviado","sent"].includes((a.status||"").toLowerCase())).length,e=s.map(a=>Number(a.calc?.margem_real_pct??0)).filter(a=>Number.isFinite(a)&&a>0);return{activeProjects:a,weeklyBudgets:b,leads:y,openTasks:c,pendingApprovals:d,avgMargin:e.length>0?e.reduce((a,b)=>a+b,0)/e.length:0}},[s,u,y,M]),O=(0,e.useMemo)(()=>{let a=u.filter(a=>"done"!==a.status&&a.due_date).sort((a,b)=>new Date(a.due_date??"").getTime()-new Date(b.due_date??"").getTime()).slice(0,6).map((a,b)=>{let c=new Date(a.due_date??""),d=c.toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"});return{id:a.id,time:d,title:a.title,subtitle:`Deadline \xb7 ${(0,h.kz)(c.toISOString())}`,startsAt:c.toISOString(),calendarHref:`/api/calendar/event.ics?source=task&id=${a.id}`,active:0===b}});if(a.length>0)return a;let b=new Date;return[{id:"ph-1",time:"09:00",title:"Kickoff Produ\xe7\xe3o",subtitle:"Com equipa e cliente",active:!0},{id:"ph-2",time:"11:00",title:"Revis\xe3o de Budget",subtitle:"Guardrails + margem"},{id:"ph-3",time:"14:30",title:"Follow-up Leads",subtitle:"Pipeline comercial"},{id:"ph-4",time:"16:00",title:"Feedback Entregas",subtitle:"Aprova\xe7\xf5es pendentes"}].map(a=>{let[c,d]=a.time.split(":").map(Number),e=new Date(b);return e.setHours(c,d,0,0),{...a,startsAt:e.toISOString(),calendarHref:((a,b,c)=>{let d=new Date(b.getTime()+27e5),e=new URLSearchParams({title:a,start:b.toISOString(),end:d.toISOString(),description:c});return`/api/calendar/event.ics?${e.toString()}`})(a.title,e,a.subtitle)}})},[u]),P=(0,e.useMemo)(()=>s.slice(0,8).map(a=>({id:a.id,name:a.project_name,owner:a.client_name||"Sem cliente",status:m(a.status),value:Number(a.calc?.preco_recomendado??0)})),[s]),Q=(0,e.useMemo)(()=>{let a=[];for(let b of s.slice(0,12)){let c=Number(b.inputs?.margem_minima_pct??0),d=Number(b.calc?.margem_real_pct??0);if(c>0&&d>0&&d<c&&a.push({level:"warn",text:`${b.project_name}: margem ${d.toFixed(1)}% abaixo do m\xednimo ${c}%`}),["enviado","sent"].includes((b.status||"").toLowerCase())){let c=(L-new Date(b.created_at).getTime())/864e5;c>7&&a.push({level:"warn",text:`${b.project_name}: enviado h\xe1 ${Math.round(c)} dias sem decis\xe3o`})}}return N.openTasks>18&&a.push({level:"warn",text:`${N.openTasks} tarefas em aberto â€” risco de atraso operacional`}),0===a.length&&a.push({level:"ok",text:"Margens e pipeline est\xe3o dentro do esperado."}),a},[s,L,N.openTasks]),R=(0,e.useMemo)(()=>{let a=[];for(let b=5;b>=0;b-=1){let c=new Date;c.setMonth(c.getMonth()-b,1);let d=c.toLocaleDateString("en-US",{month:"short"}),e=s.filter(a=>{let b=new Date(a.created_at);return b.getFullYear()===c.getFullYear()&&b.getMonth()===c.getMonth()}).reduce((a,b)=>a+Number(b.calc?.preco_recomendado??0),0);a.push({month:d,value:e})}return a},[s]),S=(0,e.useMemo)(()=>{let a=new Map;for(let b of s.slice(0,30))for(let c of b.inputs?.itens??[]){let b=c.categoria??"outro",d=Number(c.quantidade??0)*Number(c.preco_unitario??0);a.set(b,(a.get(b)??0)+d)}let b=[...a.entries()].filter(([,a])=>a>0).map(([a,b])=>({name:l[a]??a,value:b})).sort((a,b)=>b.value-a.value).slice(0,4);return b.length>0?b:[{name:"Crew",value:4200},{name:"Equipamento",value:2800},{name:"P\xf3s",value:1700},{name:"Despesas",value:900}]},[s]),T=(0,e.useMemo)(()=>{let a=new Map;for(let b of s){let c=m(b.status);a.set(c,(a.get(c)??0)+1)}return[...a.entries()].sort((a,b)=>b[1]-a[1]).slice(0,5).map(([a,b],c)=>({id:`${a}-${c}`,title:a,subtitle:`${b} projetos`,status:b>5?"Hot":"Normal"}))},[s]),U=(0,e.useMemo)(()=>{let a=q.trim().toLowerCase(),b=s.map(a=>({id:a.id,title:a.project_name,subtitle:`${a.client_name||"Sem cliente"} \xb7 ${(0,h.kz)(a.created_at)}`,status:m(a.status),ctaHref:`/app/projects/${a.id}`,ctaLabel:"Open"})),c=u.map(a=>({id:`task-${a.id}`,title:a.title,subtitle:a.due_date?`Task \xb7 ${(0,h.kz)(a.due_date)}`:"Task sem deadline",status:m(a.status),ctaHref:"/app/tasks",ctaLabel:"Reply"})),d=[...b.slice(0,4),...c.slice(0,3)];return a?d.filter(b=>b.title.toLowerCase().includes(a)||(b.subtitle??"").toLowerCase().includes(a)):d},[s,q,u]),V=(0,e.useMemo)(()=>{let a=u.filter(a=>"done"!==a.status).sort((a,b)=>(a.due_date?new Date(a.due_date).getTime():Number.MAX_SAFE_INTEGER)-(b.due_date?new Date(b.due_date).getTime():Number.MAX_SAFE_INTEGER)).slice(0,5);return 0===a.length?[{id:"placeholder",title:"Sem tarefas cr\xedticas",subtitle:"A equipa est\xe1 em dia.",status:"OK"}]:a.map(a=>({id:a.id,title:a.title,subtitle:a.due_date?`Prazo ${(0,h.kz)(a.due_date)}`:"Sem prazo",status:m(a.status),ctaHref:"/app/tasks",ctaLabel:"Ver"}))},[u]),W=(0,e.useMemo)(()=>0===w.length?[{id:"empty-calls",title:"Sem call sheets recentes",subtitle:"Cria um call sheet para a opera\xe7\xe3o."}]:w.map((a,b)=>({id:a.id,title:`Call Sheet #${String(b+1).padStart(2,"0")}`,subtitle:`Atualizado ${(0,h.kz)(a.created_at)}`,ctaHref:"/app/callsheets",ctaLabel:"Abrir"})),[w]),X=(0,e.useMemo)(()=>[{id:"routes",title:"Rotas log\xedsticas",subtitle:`${E} registos`,status:E>0?"OK":"Setup",ctaHref:"/app/logistics",ctaLabel:"Ver"},{id:"weather",title:"Weather cache",subtitle:`${G} entradas`,status:G>10?"Fresh":"Low",ctaHref:"/app/weather",ctaLabel:"Abrir"},{id:"approvals",title:"Aprova\xe7\xf5es pendentes",subtitle:`${N.pendingApprovals} projetos`,status:N.pendingApprovals>0?"Warn":"OK",ctaHref:"/app/projects",ctaLabel:"Rever"},{id:"inbox",title:"Conversas ativas",subtitle:`${A} threads`,status:A>0?"Live":"Empty",ctaHref:"/app/inbox",ctaLabel:"Inbox"}],[A,E,N.pendingApprovals,G]),Y=(0,d.jsxs)("div",{className:"flex flex-wrap items-end justify-between gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-[0.72rem] uppercase tracking-[0.12em]",style:{color:"var(--text-3)"},children:"ceo"===a?"CEO Dashboard":"Empresa Dashboard"}),(0,d.jsxs)("h2",{className:"mt-1.5 text-[2rem] font-[540] tracking-[-0.03em]",style:{color:"var(--text)"},children:["Hi, ",I,"!"]}),(0,d.jsx)("p",{className:"text-sm",style:{color:"var(--text-2)"},children:"ceo"===a?"Vis\xe3o premium, calma e estrat\xe9gica para decis\xf5es de neg\xf3cio.":"Vista operacional para execu\xe7\xe3o di\xe1ria e controlo de produ\xe7\xe3o."})]}),(0,d.jsxs)("div",{className:"flex flex-wrap items-center gap-2.5",children:[(0,d.jsx)(k.ke,{value:q,onChange:r,placeholder:"Pesquisar updates"}),(0,d.jsx)(k.Er,{mode:a,onChange:b})]})]});return c?(0,d.jsx)(k.O2,{}):o?(0,d.jsx)("div",{className:"card",children:(0,d.jsx)(i.pp,{title:"Erro ao carregar dashboard",description:o,action:(0,d.jsx)(i.KF,{className:"px-4 py-2 text-xs",onClick:()=>void K(),children:"Retry"})})}):(0,d.jsx)(f.P.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.32,ease:"easeOut"},className:"space-y-6",children:(0,d.jsx)(k.Rd,{header:Y,children:"ceo"===a?(0,d.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2 xl:grid-cols-12",children:[(0,d.jsx)("div",{className:"lg:col-span-1 xl:col-span-8",children:(0,d.jsx)(k.nz,{greeting:`Hi, ${I}!`,subtitle:"Resumo de hoje com foco em pipeline, risco e execu\xe7\xe3o sem ru\xeddo operacional.",metrics:[{id:"projects",label:"Or\xe7amentos ativos",value:String(N.activeProjects),hint:`${N.weeklyBudgets} novos esta semana`,tone:"blue"},{id:"approvals",label:"Aprova\xe7\xf5es pendentes",value:String(N.pendingApprovals),hint:"Aguardam resposta",tone:"yellow"},{id:"critical",label:"Tarefas cr\xedticas",value:String(N.openTasks),hint:"Necessitam follow-up",tone:"lilac"},{id:"leads",label:"Leads quentes",value:String(N.leads),hint:"Clientes ativos",tone:"mint"}],primaryCta:{href:"/app/projects/new",label:"Novo Projeto"},secondaryCta:{href:"/app/projects/new",label:"Novo Or\xe7amento"}})}),(0,d.jsx)("div",{className:"lg:col-span-1 xl:col-span-4",children:(0,d.jsx)(k.Lz,{events:O,feedHref:"/api/calendar/feed.ics"})}),(0,d.jsx)("div",{className:"lg:col-span-1 xl:col-span-4",children:(0,d.jsx)(k.do,{title:"Forecast",subtitle:"Receita projetada",children:(0,d.jsx)(k.G1,{data:R})})}),(0,d.jsx)("div",{className:"lg:col-span-1 xl:col-span-3",children:(0,d.jsx)(k.$_,{title:"Pipeline",subtitle:"Hot / Follow-up / Waiting",rows:T})}),(0,d.jsx)("div",{className:"lg:col-span-2 xl:col-span-5",children:(0,d.jsx)(k.$_,{title:"Inbox / Updates",subtitle:"5 itens mais recentes",rows:U})}),(0,d.jsx)("div",{className:"lg:col-span-1 xl:col-span-7",children:(0,d.jsx)(k.wq,{items:O.slice(0,5)})}),(0,d.jsx)("div",{className:"lg:col-span-1 xl:col-span-5",children:(0,d.jsx)(k.Zg,{alerts:Q})}),(0,d.jsx)("div",{className:"lg:col-span-1 xl:col-span-6",children:(0,d.jsx)(k.do,{title:"Composi\xe7\xe3o de Custos",subtitle:"Distribui\xe7\xe3o por categoria",children:(0,d.jsx)(k.Gk,{data:S})})}),(0,d.jsx)("div",{className:"lg:col-span-1 xl:col-span-6",children:(0,d.jsx)(k.$_,{title:"Tarefas do dia",subtitle:"Top 5 por prioridade de prazo",rows:V})})]}):(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-4",children:[(0,d.jsx)(k.Sl,{label:"Projetos ativos",value:String(N.activeProjects),hint:"Opera\xe7\xe3o em curso"}),(0,d.jsx)(k.Sl,{label:"Entregas semana",value:String(C),hint:"Call sheets e entregas"}),(0,d.jsx)(k.Sl,{label:"Backlog",value:String(N.openTasks),hint:"Tarefas abertas"}),(0,d.jsx)(k.Sl,{label:"Margem m\xe9dia",value:`${N.avgMargin.toFixed(1)}%`,hint:"Projetos recentes"})]}),(0,d.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2 xl:grid-cols-12",children:[(0,d.jsx)("div",{className:"lg:col-span-1 xl:col-span-4",children:(0,d.jsx)(k.$_,{title:"Callsheets recentes",subtitle:"\xdaltimas opera\xe7\xf5es",rows:W})}),(0,d.jsx)("div",{className:"lg:col-span-1 xl:col-span-4",children:(0,d.jsx)(k.$_,{title:"Log\xedstica / Weather",subtitle:"Estado t\xe9cnico",rows:X})}),(0,d.jsx)("div",{className:"lg:col-span-2 xl:col-span-4",children:(0,d.jsx)(k.Zg,{alerts:Q})}),(0,d.jsx)("div",{className:"lg:col-span-2 xl:col-span-7",children:(0,d.jsx)(k.wF,{rows:P})}),(0,d.jsx)("div",{className:"lg:col-span-1 xl:col-span-5",children:(0,d.jsx)(k.do,{title:"Forecast operacional",subtitle:"Volume mensal",children:(0,d.jsx)(k.G1,{data:R})})}),(0,d.jsx)("div",{className:"lg:col-span-1 xl:col-span-5",children:(0,d.jsx)(k.do,{title:"Mix de custos",subtitle:"Custos dos projetos ativos",children:(0,d.jsx)(k.Gk,{data:S})})}),(0,d.jsx)("div",{className:"lg:col-span-1 xl:col-span-7",children:(0,d.jsx)(k.$_,{title:"Aprova\xe7\xf5es e conversas",subtitle:"Follow-up em progresso",rows:U})})]})]})})})}},36865:(a,b,c)=>{Promise.resolve().then(c.bind(c,76648))},50017:(a,b,c)=>{Promise.resolve().then(c.bind(c,4426))},76648:(a,b,c)=>{"use strict";c.d(b,{default:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/dolho/beyond-pricing/app/src/components/dashboard/dashboard-home.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/dolho/beyond-pricing/app/src/components/dashboard/dashboard-home.tsx","default")},93930:(a,b,c)=>{"use strict";c.d(b,{do:()=>p,pp:()=>q,ab:()=>l,KF:()=>m,O3:()=>n,u4:()=>r,A:()=>o});var d=c(21124),e=c(40937),f=c(11913),g=c(6343);let h=(0,c(23339).A)("Clock3",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]]);var i=c(88285),j=c(44943),k=c(46998);function l({className:a,children:b,active:c=!1}){let f=(0,k.Y3)();return(0,d.jsx)(e.P.span,{className:(0,j.cn)("pill",c&&"pill-active",a),...f?{whileHover:{y:-1},transition:k.bm.smooth}:{},children:b})}function m({className:a,children:b,variant:c="secondary",...f}){let g=(0,k.Pm)();return(0,d.jsx)(e.P.button,{className:(0,j.cn)("pill-btn","primary"===c?"pill-btn-primary":"pill-btn-secondary",a),...(0,k.HY)({enabled:g}),...f,children:b})}function n({className:a,...b}){return(0,d.jsx)("input",{className:(0,j.cn)("pill-input",a),...b})}function o({className:a,avatars:b=[]}){let c=(0,f.I)(),i=new Date().toLocaleDateString("pt-PT",{weekday:"long",day:"2-digit",month:"long"});return(0,d.jsx)(e.P.div,{initial:!c&&"initial",animate:c?void 0:"animate",variants:{initial:{opacity:0,y:-8},animate:{opacity:1,y:0}},transition:k.bm.page,className:(0,j.cn)("top-schedule-bar p-4 md:p-5",a),children:(0,d.jsxs)("div",{className:"flex flex-wrap items-center gap-3 md:gap-5",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,d.jsx)("span",{className:"icon-btn","aria-hidden":!0,children:(0,d.jsx)(g.A,{className:"h-4 w-4"})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-xs uppercase tracking-[0.08em]",style:{color:"var(--muted)"},children:"Schedule"}),(0,d.jsx)("p",{className:"text-sm font-semibold capitalize",style:{color:"var(--text)"},children:i})]})]}),(0,d.jsx)("div",{className:"flex flex-1 flex-wrap items-center gap-2",children:["09:00","11:30","14:00","16:30"].map(a=>(0,d.jsxs)("span",{className:"pill inline-flex items-center gap-1.5",children:[(0,d.jsx)(h,{className:"h-3.5 w-3.5"}),a]},a))}),(0,d.jsx)("div",{className:"flex items-center",children:b.length>0?(0,d.jsx)("div",{className:"-space-x-2",children:b.slice(0,4).map(a=>(0,d.jsx)("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full border text-xs font-semibold",style:{background:"var(--surface-2)",borderColor:"var(--border-soft)",color:"var(--text)"},children:a.trim().slice(0,1).toUpperCase()},a))}):(0,d.jsx)("span",{className:"pill",children:"Sem equipa atribuida"})})]})})}function p({className:a,title:b,action:c,children:f}){let g=(0,k.Y3)();return(0,d.jsxs)(e.P.section,{className:(0,j.cn)("chart-card card-hover",a),...(0,k.XC)(g),children:[(0,d.jsxs)("header",{className:"mb-4 flex items-center justify-between gap-3",children:[(0,d.jsx)("h3",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:b}),c]}),f]})}function q({className:a,title:b,description:c,action:e}){return(0,d.jsxs)("div",{className:(0,j.cn)("empty-state empty-state-premium",a),children:[(0,d.jsx)(i.A,{className:"empty-icon"}),(0,d.jsx)("p",{className:"empty-title",children:b}),c?(0,d.jsx)("p",{className:"empty-desc",children:c}):null,e]})}function r({className:a}){return(0,d.jsx)(e.P.div,{initial:{opacity:.65},animate:{opacity:1},transition:{duration:.45,ease:"easeOut"},className:(0,j.cn)("skeleton-card h-28",a)})}}};