(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1177],{6132:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(71847).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},17910:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(71847).A)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},20508:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(71847).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},31800:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>b});var t=a(95155),l=a(12115),r=a(62890),c=a(61362),i=a(78874),o=a(6132),n=a(71847);let d=(0,n.A)("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);var m=a(17910);let h=(0,n.A)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);var u=a(20508);let x=(0,n.A)("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);var p=a(89559),y=a(56154);function b(){var e,s;let[a,n]=(0,l.useState)([]),[b,v]=(0,l.useState)(!1),[k,g]=(0,l.useState)(null),[j,f]=(0,l.useState)(null),N=async()=>{var e,s;v(!0);let a=[],t="https://wjzcutnjnzxylzqysneg.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndqemN1dG5qbnp4eWx6cXlzbmVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMjYzMjcsImV4cCI6MjA4NjkwMjMyN30.bku3F43nks_Uq22Ag-viZZpMQfrw43eq3sahNChbBq8";a.push({label:"NEXT_PUBLIC_SUPABASE_URL",status:t?"ok":"error",detail:t?t.replace(/https?:\/\//,"").split(".")[0]+".supabase.co":"Vari\xe1vel em falta — adiciona ao .env.local"}),a.push({label:"NEXT_PUBLIC_SUPABASE_ANON_KEY",status:l?"ok":"error",detail:l?"…".concat(l.slice(-8)):"Vari\xe1vel em falta"}),n([...a]);let c=(0,r.U)(),{data:{user:i},error:o}=await c.auth.getUser();if(o||!i){a.push({label:"Autentica\xe7\xe3o Supabase",status:"error",detail:null!=(e=null==o?void 0:o.message)?e:"N\xe3o autenticado — faz login primeiro"}),n([...a]),v(!1);return}for(let e of(f(null!=(s=i.email)?s:null),a.push({label:"Autentica\xe7\xe3o Supabase",status:"ok",detail:"Sess\xe3o v\xe1lida: ".concat(i.email)}),n([...a]),["projects","project_members","checklists","checklist_items","templates","template_items","clients","client_users","conversations","messages","journal_entries","tasks","crm_contacts","crm_companies","crm_deals","team_members","organizations","catalog_items","call_sheets","notifications","fuel_cache","route_cache","plugin_status","plugin_runs"])){let{error:s}=await c.from(e).select("id").limit(1);a.push({label:"Tabela: ".concat(e),status:s?"error":"ok",detail:s?"".concat(s.code,": ").concat(s.message):"Acess\xedvel via RLS"}),n([...a])}try{let e=await fetch("/api/admin/org-role");if(e.ok){let s=await e.json();g(s),a.push({label:"Org Role (team_members)",status:s.role?"ok":"warn",detail:s.role?"Role: ".concat(s.role).concat(s.isAdmin?" (admin ✓)":""):"Sem role — corre /api/admin/bootstrap para atribuir owner"})}else a.push({label:"Org Role (team_members)",status:"error",detail:"Falha ao verificar role — verifica autentica\xe7\xe3o"})}catch(e){a.push({label:"Org Role (team_members)",status:"error",detail:"Erro de rede ao verificar role"})}try{let e=await fetch("/api/admin/bootstrap",{method:"GET"});a.push({label:"Bootstrap endpoint",status:e.ok||405===e.status?"ok":"warn",detail:e.ok?"Acess\xedvel":"HTTP ".concat(e.status)})}catch(e){a.push({label:"Bootstrap endpoint",status:"warn",detail:"N\xe3o acess\xedvel"})}try{let[e,s,t]=await Promise.all([fetch("/api/plugins/weather?location=Setubal"),fetch("/api/plugins/fuel?country=PT&type=diesel"),fetch("/api/plugins/route?from=Setubal&to=Lisboa")]);a.push({label:"Plugin Weather",status:e.ok?"ok":"warn",detail:e.ok?"API + cache operacional":"HTTP ".concat(e.status)}),a.push({label:"Plugin Fuel",status:s.ok?"ok":"warn",detail:s.ok?"API + cache operacional":"HTTP ".concat(s.status)}),a.push({label:"Plugin Route",status:t.ok?"ok":"warn",detail:t.ok?"API + cache operacional":"HTTP ".concat(t.status)})}catch(e){a.push({label:"Plugins",status:"warn",detail:"Falha no ping aos plugins"})}n([...a]),v(!1)};(0,l.useEffect)(()=>{N()},[]);let w=e=>{let{status:s}=e;return"ok"===s?(0,t.jsx)(c.A,{className:"h-4 w-4 shrink-0",style:{color:"var(--success)"}}):"error"===s?(0,t.jsx)(i.A,{className:"h-4 w-4 shrink-0",style:{color:"var(--error)"}}):"warn"===s?(0,t.jsx)(o.A,{className:"h-4 w-4 shrink-0",style:{color:"var(--warning)"}}):(0,t.jsxs)("svg",{className:"h-4 w-4 shrink-0 animate-spin",viewBox:"0 0 24 24",fill:"none",style:{color:"var(--text-3)"},children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]})},A=a.filter(e=>"ok"===e.status).length,I=a.filter(e=>"error"===e.status).length,_=a.filter(e=>"warn"===e.status).length,C=[{label:"Vari\xe1veis de Ambiente",icon:d,items:a.filter(e=>e.label.startsWith("NEXT_PUBLIC"))},{label:"Autentica\xe7\xe3o",icon:m.A,items:a.filter(e=>e.label.includes("Autentica\xe7\xe3o"))},{label:"Base de Dados",icon:h,items:a.filter(e=>e.label.startsWith("Tabela:"))},{label:"RBAC & Admin",icon:u.A,items:a.filter(e=>e.label.includes("Org Role")||e.label.includes("Bootstrap"))}];return(0,t.jsxs)("div",{className:"space-y-6 max-w-3xl",children:[(0,t.jsxs)("div",{className:"page-header",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"page-title flex items-center gap-2",children:[(0,t.jsx)(x,{className:"h-6 w-6",style:{color:"var(--accent)"}}),"Diagn\xf3sticos"]}),(0,t.jsx)("p",{className:"page-subtitle",children:"Estado do sistema — apenas para desenvolvimento"})]}),(0,t.jsxs)("button",{onClick:N,disabled:b,className:"btn btn-secondary",children:[(0,t.jsx)(p.A,{className:"h-4 w-4 ".concat(b?"animate-spin":"")}),b?"A verificar…":"Re-executar"]})]}),a.length>0&&!b&&(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{className:"card text-center",style:{border:"1px solid var(--success-border)",background:"var(--success-bg)"},children:[(0,t.jsx)("p",{className:"text-2xl font-bold",style:{color:"var(--success)"},children:A}),(0,t.jsx)("p",{className:"text-xs mt-1",style:{color:"var(--text-2)"},children:"OK"})]}),(0,t.jsxs)("div",{className:"card text-center",style:{border:"1px solid var(--warning-border)",background:"var(--warning-bg)"},children:[(0,t.jsx)("p",{className:"text-2xl font-bold",style:{color:"var(--warning)"},children:_}),(0,t.jsx)("p",{className:"text-xs mt-1",style:{color:"var(--text-2)"},children:"Avisos"})]}),(0,t.jsxs)("div",{className:"card text-center",style:{border:"1px solid var(--error-border)",background:"var(--error-bg)"},children:[(0,t.jsx)("p",{className:"text-2xl font-bold",style:{color:"var(--error)"},children:I}),(0,t.jsx)("p",{className:"text-xs mt-1",style:{color:"var(--text-2)"},children:"Erros"})]})]}),j&&(0,t.jsxs)("div",{className:"card flex items-center gap-3",style:{background:"var(--accent-dim)",border:"1px solid rgba(26,143,163,0.2)"},children:[(0,t.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-full text-sm font-bold text-white shrink-0",style:{background:"var(--accent)"},children:null==(e=j[0])?void 0:e.toUpperCase()}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium",style:{color:"var(--text)"},children:j}),k&&(0,t.jsxs)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:["Role: ",(0,t.jsx)("strong",{style:{color:"var(--accent-2)"},children:null!=(s=k.role)?s:"sem role"}),k.isAdmin&&(0,t.jsx)("span",{style:{color:"var(--success)"},children:" \xb7 admin ✓"})]})]}),(0,t.jsx)(y.A,{className:"h-4 w-4 shrink-0",style:{color:"var(--accent)"}})]}),C.map(e=>e.items.length>0&&(0,t.jsxs)("div",{className:"card space-y-1",style:{padding:0,overflow:"hidden"},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 px-4 py-3",style:{borderBottom:"1px solid var(--border)",background:"var(--surface-2)"},children:[(0,t.jsx)(e.icon,{className:"h-4 w-4",style:{color:"var(--text-3)"}}),(0,t.jsx)("p",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:e.label}),(0,t.jsxs)("span",{className:"ml-auto text-xs",style:{color:"var(--text-3)"},children:[e.items.filter(e=>"ok"===e.status).length,"/",e.items.length," OK"]})]}),(0,t.jsx)("div",{className:"divide-y",style:{borderColor:"var(--border)"},children:e.items.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-start gap-3 px-4 py-3",children:[(0,t.jsx)(w,{status:e.status}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium",style:{color:"var(--text)"},children:e.label}),e.detail&&(0,t.jsx)("p",{className:"text-xs mt-0.5 font-mono",style:{color:"var(--text-3)"},children:e.detail})]})]},s))})]},e.label)),k&&!k.role&&(0,t.jsxs)("div",{className:"card space-y-3",style:{border:"1px solid var(--warning-border)",background:"var(--warning-bg)"},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(o.A,{className:"h-5 w-5",style:{color:"var(--warning)"}}),(0,t.jsx)("p",{className:"font-semibold",style:{color:"var(--text)"},children:"Sem role org — ac\xe7\xf5es necess\xe1rias"})]}),(0,t.jsx)("p",{className:"text-sm",style:{color:"var(--text-2)"},children:"Para atribuir role de owner, abre uma nova aba e visita:"}),(0,t.jsx)("a",{href:"/api/admin/bootstrap",target:"_blank",className:"btn btn-primary btn-sm",rel:"noopener noreferrer",children:"Abrir /api/admin/bootstrap"}),(0,t.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:"Requer OWNER_EMAIL em .env.local a coincidir com o teu email de login."})]}),a.length>0&&(0,t.jsxs)("details",{className:"card",children:[(0,t.jsxs)("summary",{className:"cursor-pointer text-sm font-medium py-1",style:{color:"var(--text-2)"},children:["Ver todos os resultados (",a.length,")"]}),(0,t.jsx)("div",{className:"mt-3 space-y-1",children:a.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-start gap-2 py-1",style:{borderBottom:"1px solid var(--border)"},children:[(0,t.jsx)(w,{status:e.status}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("span",{className:"text-xs font-medium",style:{color:"var(--text)"},children:e.label}),e.detail&&(0,t.jsx)("span",{className:"text-xs ml-2 font-mono",style:{color:"var(--text-3)"},children:e.detail})]})]},s))})]})]})}},39580:(e,s,a)=>{Promise.resolve().then(a.bind(a,31800))},56154:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(71847).A)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},61362:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(71847).A)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},62890:(e,s,a)=>{"use strict";a.d(s,{U:()=>l});var t=a(55417);function l(){return(0,t.createBrowserClient)("https://wjzcutnjnzxylzqysneg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndqemN1dG5qbnp4eWx6cXlzbmVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMjYzMjcsImV4cCI6MjA4NjkwMjMyN30.bku3F43nks_Uq22Ag-viZZpMQfrw43eq3sahNChbBq8")}},71847:(e,s,a)=>{"use strict";a.d(s,{A:()=>i});var t=a(12115);let l=function(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];return s.filter((e,s,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===s).join(" ").trim()};var r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let c=(0,t.forwardRef)((e,s)=>{let{color:a="currentColor",size:c=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:n="",children:d,iconNode:m,...h}=e;return(0,t.createElement)("svg",{ref:s,...r,width:c,height:c,stroke:a,strokeWidth:o?24*Number(i)/Number(c):i,className:l("lucide",n),...h},[...m.map(e=>{let[s,a]=e;return(0,t.createElement)(s,a)}),...Array.isArray(d)?d:[d]])}),i=(e,s)=>{let a=(0,t.forwardRef)((a,r)=>{let{className:i,...o}=a;return(0,t.createElement)(c,{ref:r,iconNode:s,className:l("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),i),...o})});return a.displayName="".concat(e),a}},78874:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(71847).A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},89559:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(71847).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])}},e=>{e.O(0,[5417,8441,1255,7358],()=>e(e.s=39580)),_N_E=e.O()}]);