(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9661],{5917:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},6132:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},12108:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]])},20063:(e,a,t)=>{"use strict";var s=t(47260);t.o(s,"useParams")&&t.d(a,{useParams:function(){return s.useParams}}),t.o(s,"usePathname")&&t.d(a,{usePathname:function(){return s.usePathname}}),t.o(s,"useRouter")&&t.d(a,{useRouter:function(){return s.useRouter}}),t.o(s,"useSearchParams")&&t.d(a,{useSearchParams:function(){return s.useSearchParams}})},21190:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},21873:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},23327:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},24033:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},26041:(e,a,t)=>{"use strict";t.d(a,{BU:()=>n,V:()=>r,dx:()=>o,iJ:()=>l,qd:()=>c,vj:()=>s});let s=[{value:"crew",label:"Equipa (Crew)",color:"#1a8fa3"},{value:"equipamento",label:"Equipamento",color:"#8b6b56"},{value:"pos_producao",label:"P\xf3s-Produ\xe7\xe3o",color:"#7c3aed"},{value:"despesas",label:"Despesas",color:"#d97706"},{value:"outro",label:"Outro",color:"#5a6280"}],l=[{value:"continental_23",label:"Continental (23%)",rate:23},{value:"madeira_22",label:"Madeira (22%)",rate:22},{value:"acores_16",label:"A\xe7ores (16%)",rate:16},{value:"isento",label:"Isento / Art. 53.\xba (0%)",rate:0}];function r(e){var a,t;return null!=(t=null==(a=l.find(a=>a.value===e))?void 0:a.rate)?t:23}let n=[{value:"rascunho",label:"Rascunho",badge:"badge-default"},{value:"enviado",label:"Enviado",badge:"badge-accent"},{value:"aprovado",label:"Aprovado",badge:"badge-success"},{value:"cancelado",label:"Cancelado",badge:"badge-error"},{value:"arquivado",label:"Arquivado",badge:"badge-warning"}],c=[{value:"pre_producao",label:"Pr\xe9-Produ\xe7\xe3o",color:"#1a8fa3"},{value:"rodagem",label:"Rodagem",color:"#d97706"},{value:"pos_producao",label:"P\xf3s-Produ\xe7\xe3o",color:"#7c3aed"}],o={iva_regime:"continental_23",overhead_pct:15,contingencia_pct:10,margem_alvo_pct:30,margem_minima_pct:15,investimento_pct:0,moeda:"EUR"}},26617:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]])},26983:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},35299:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},35626:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},39867:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},42196:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},46046:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},46398:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]])},53304:(e,a,t)=>{Promise.resolve().then(t.bind(t,80876))},58734:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]])},62890:(e,a,t)=>{"use strict";t.d(a,{U:()=>l});var s=t(55417);function l(){return(0,s.createBrowserClient)("https://wjzcutnjnzxylzqysneg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndqemN1dG5qbnp4eWx6cXlzbmVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMjYzMjcsImV4cCI6MjA4NjkwMjMyN30.bku3F43nks_Uq22Ag-viZZpMQfrw43eq3sahNChbBq8")}},64269:(e,a,t)=>{"use strict";t.d(a,{$C:()=>i,SS:()=>c,Sc:()=>n,Yv:()=>o,cn:()=>r,kz:()=>d});var s=t(2821),l=t(75889);function r(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,l.QP)((0,s.$)(a))}function n(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e.toLocaleString("pt-PT",{minimumFractionDigits:a,maximumFractionDigits:a})}function c(e){return e.toLocaleString("pt-PT",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2})}function o(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")}function i(){return Math.random().toString(36).slice(2,9)}function d(e){return new Date(e).toLocaleDateString("pt-PT")}},65229:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},71360:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},78874:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},80876:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>ea});var s=t(95155),l=t(12115),r=t(20063),n=t(69434),c=t(26497),o=t(62890),i=t(26041);function d(e,a){return e.filter(e=>e.categoria===a).reduce((e,a)=>e+a.quantidade*a.preco_unitario,0)}function m(e){return Math.round(100*e)/100}var u=t(64269),x=t(26265),p=t(12723),h=t(4035),v=t(69386),y=t(10232),b=t(71360),g=t(35626),j=t(5917),f=t(21190),N=t(39867),_=t(71847);let k=(0,_.A)("Presentation",[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]]);var w=t(46046),C=t(12108),S=t(24033),A=t(6191);let P=(0,_.A)("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);var M=t(58734),L=t(89559),q=t(26617),z=t(42196);let E=(0,_.A)("Film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]);var I=t(89715);let D=(0,_.A)("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);var R=t(93499),F=t(52619),T=t.n(F),U=t(65229),V=t(86651);function O(e){let{open:a,defaultCategoria:t,onClose:r,onSelect:n}=e,[c,o]=(0,l.useState)(null!=t?t:"crew"),[d,m]=(0,l.useState)([]),[x,p]=(0,l.useState)(!1),[h,v]=(0,l.useState)(""),[y,b]=(0,l.useState)(new Set),g=(0,l.useCallback)(async()=>{p(!0);try{let a=await fetch("/api/catalog?categoria=".concat(c));if(a.ok){var e;let t=await a.json();m(null!=(e=t.items)?e:[])}}finally{p(!1)}},[c]);(0,l.useEffect)(()=>{a&&(g(),b(new Set),v(""))},[a,g]),(0,l.useEffect)(()=>{a&&(t&&o(t),g(),b(new Set),v(""))},[a]);let f=d.filter(e=>e.nome.toLowerCase().includes(h.toLowerCase()));return a?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4",style:{background:"rgba(0,0,0,0.5)"},onClick:e=>{e.target===e.currentTarget&&r()},children:(0,s.jsxs)("div",{className:"rounded-2xl w-full max-w-lg max-h-[80vh] flex flex-col",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-5 pt-5 pb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(q.A,{className:"h-5 w-5",style:{color:"var(--accent)"}}),(0,s.jsx)("h2",{className:"font-semibold",style:{color:"var(--text)"},children:"Cat\xe1logo de itens"})]}),(0,s.jsx)("button",{className:"btn btn-ghost btn-icon-sm",onClick:r,children:(0,s.jsx)(U.A,{className:"h-4 w-4"})})]}),(0,s.jsx)("div",{className:"flex gap-1 px-5 pb-3 overflow-x-auto",children:i.vj.map(e=>(0,s.jsx)("button",{onClick:()=>o(e.value),className:"px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-all",style:{background:c===e.value?e.color:"var(--surface-2)",color:c===e.value?"#fff":"var(--text-2)"},children:e.label.split(" ")[0]},e.value))}),(0,s.jsx)("div",{className:"px-5 pb-3",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(V.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-3.5 w-3.5",style:{color:"var(--text-3)"}}),(0,s.jsx)("input",{className:"input w-full pl-9 text-sm",placeholder:"Pesquisar...",value:h,onChange:e=>v(e.target.value)})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto px-5 pb-3 space-y-1.5",children:x?(0,s.jsx)("div",{className:"space-y-2 py-2",children:[1,2,3,4].map(e=>(0,s.jsx)("div",{className:"h-12 rounded-lg animate-pulse",style:{background:"var(--surface-2)"}},e))}):0===f.length?(0,s.jsx)("p",{className:"text-sm py-4 text-center",style:{color:"var(--text-3)"},children:"Nenhum item encontrado"}):f.map(e=>{let a=y.has(e.id);return(0,s.jsxs)("button",{onClick:()=>{var a;return a=e.id,void b(e=>{let t=new Set(e);return t.has(a)?t.delete(a):t.add(a),t})},className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left transition-all",style:{background:a?"var(--accent-subtle)":"var(--surface-2)",border:"1px solid ".concat(a?"var(--accent)":"transparent")},children:[(0,s.jsx)("div",{className:"h-5 w-5 rounded flex items-center justify-center shrink-0",style:{background:a?"var(--accent)":"var(--surface)",border:"1.5px solid ".concat(a?"var(--accent)":"var(--border)")},children:a&&(0,s.jsx)(j.A,{className:"h-3 w-3 text-white"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium truncate",style:{color:"var(--text)"},children:e.nome}),(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:e.preco_base>0?"".concat(e.preco_base.toFixed(2)," € / ").concat(e.unidade):e.unidade})]})]},e.id)})}),(0,s.jsxs)("div",{className:"px-5 py-4 flex items-center gap-2 justify-between",style:{borderTop:"1px solid var(--border)"},children:[(0,s.jsxs)("button",{className:"btn btn-ghost btn-sm",onClick:()=>{n({id:(0,u.$C)(),categoria:c,nome:"",unidade:"dia",quantidade:1,preco_unitario:0,total:0}),r()},children:[(0,s.jsx)(A.A,{className:"h-3.5 w-3.5"}),"Item em branco"]}),(0,s.jsxs)("button",{className:"btn btn-primary btn-sm",onClick:()=>{d.filter(e=>y.has(e.id)).forEach(e=>{n({id:(0,u.$C)(),categoria:e.categoria,nome:e.nome,unidade:e.unidade,quantidade:1,preco_unitario:e.preco_base,total:e.preco_base})}),r()},disabled:0===y.size,children:["Adicionar ",y.size>0?"(".concat(y.size,")"):""]})]})]})}):null}var B=t(35299),H=t(21873),W=t(46398),K=t(26983),G=t(6132),J=t(93014);let X={0:{emoji:"☀️",label:"C\xe9u limpo"},1:{emoji:"\uD83C\uDF24️",label:"Principalmente limpo"},2:{emoji:"⛅",label:"Parcialmente nublado"},3:{emoji:"☁️",label:"Nublado"},45:{emoji:"\uD83C\uDF2B️",label:"Nevoeiro"},61:{emoji:"\uD83C\uDF27️",label:"Chuva leve"},63:{emoji:"\uD83C\uDF27️",label:"Chuva"},65:{emoji:"⛈️",label:"Chuva forte"},80:{emoji:"\uD83C\uDF26️",label:"Aguaceiros"}},Z={lat:38.5243,lng:-8.8926};function Y(e){let a=(0,J.d)(),[t,r]=(0,l.useState)(e.locationText||""),[n,c]=(0,l.useState)(!1),[o,i]=(0,l.useState)([]),[d,m]=(0,l.useState)(!1),[u,x]=(0,l.useState)(null),[p,h]=(0,l.useState)(null),[v,y]=(0,l.useState)(null),[b,g]=(0,l.useState)(!1),j=(0,l.useCallback)(async()=>{if(e.locationLat&&e.locationLng){m(!0),x(null);try{var a,t;let s=await fetch("/api/plugins/weather?lat=".concat(e.locationLat,"&lng=").concat(e.locationLng)),l=await s.json();if(!s.ok)throw Error(l.error||"Falha a carregar weather");let r=(null!=(a=l.days)?a:[]).map(e=>({date:e.date,temp_max:e.temp_max,temp_min:e.temp_min,precipitation_sum:e.precipitation_sum,weather_code:e.weather_code,weather_label:e.weather_label}));i(r.slice(0,7)),l.warning&&x(null!=(t=l.warning)?t:null)}catch(e){x(e instanceof Error?e.message:"N\xe3o foi poss\xedvel carregar previs\xe3o")}finally{m(!1)}}},[e.locationLat,e.locationLng]);(0,l.useEffect)(()=>{j()},[j]),(0,l.useEffect)(()=>{e.travelKm&&(async()=>{g(!0);try{var e;let a=await fetch("/api/plugins/fuel?country=PT&type=diesel"),t=await a.json();if(!a.ok||"number"!=typeof t.price_per_liter)throw Error(t.error||"Sem pre\xe7o de combust\xedvel");h(t.price_per_liter),y(null!=(e=t.source)?e:"fallback")}catch(e){h(null),y(null)}finally{g(!1)}})()},[e.travelKm]);let f=async()=>{if(!t.trim())return void a.error("Introduz um local");c(!0);try{let s=await fetch("/api/geo/geocode?q=".concat(encodeURIComponent(t)));if(!s.ok){let e=await s.json();throw Error(e.error||"Geocoding failed")}let{lat:l,lng:r,address:n,name:c}=await s.json(),o=await fetch("/api/plugins/route?from=Setubal&fromLat=".concat(Z.lat,"&fromLng=").concat(Z.lng,"&to=").concat(encodeURIComponent(c),"&toLat=").concat(l,"&toLng=").concat(r)),i=0,d=0;if(o.ok){let e=await o.json();i=e.travel_km,d=e.travel_minutes}await e.onUpdate({location_text:c,location_lat:l,location_lng:r,location_address:n,travel_km:i,travel_minutes:d}),a.success("Local: ".concat(c," (").concat(i,"km, ").concat(d,"min)")),j()}catch(e){a.error(e instanceof Error?e.message:"Erro ao geocodificar")}finally{c(!1)}},N=async()=>{await e.onUpdate({location_text:null,location_lat:null,location_lng:null,location_address:null,travel_km:null,travel_minutes:null}),r(""),i([]),a.success("Local removido")};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"card space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"section-title",children:"Local de Produ\xe7\xe3o"}),(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:"Introduz uma cidade ou morada para calcular dist\xe2ncia e ver previs\xe3o"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:t,onChange:e=>r(e.target.value),onKeyDown:e=>"Enter"===e.key&&f(),placeholder:"Ex: Lisboa, Porto, ou rua...",className:"input flex-1",disabled:n}),(0,s.jsx)("button",{onClick:f,disabled:n||!t.trim(),className:"btn btn-primary",children:n?(0,s.jsx)(B.A,{className:"w-4 h-4 animate-spin"}):(0,s.jsx)(H.A,{className:"w-4 h-4"})})]}),e.locationText&&(0,s.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 dark:bg-blue-950 dark:border-blue-800",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-sm",children:e.locationText}),(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:e.locationAddress})]}),(0,s.jsx)("button",{onClick:N,className:"text-xs underline",style:{color:"var(--error)"},children:"Remover"})]}),(e.travelKm||e.travelMinutes)&&(0,s.jsxs)("div",{className:"flex gap-4 text-sm",children:[e.travelKm&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(W.A,{className:"w-4 h-4",style:{color:"var(--accent)"}}),(0,s.jsxs)("span",{children:[e.travelKm," km"]})]}),e.travelMinutes&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(K.A,{className:"w-4 h-4",style:{color:"var(--accent)"}}),(0,s.jsxs)("span",{children:[e.travelMinutes," min"]})]})]})]})})]}),e.locationLat&&e.locationLng&&(0,s.jsxs)("div",{className:"card space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("label",{className:"section-title",children:"Previs\xe3o Meteorol\xf3gica"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[d?(0,s.jsx)(B.A,{className:"w-4 h-4 animate-spin",style:{color:"var(--text-3)"}}):null,(0,s.jsx)("button",{onClick:()=>void j(),className:"btn btn-ghost btn-sm text-xs",disabled:d,children:"Atualizar agora"})]})]}),o.length>0?(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-7 gap-2",children:o.map(e=>{let a=X[e.weather_code]||{emoji:"❓",label:e.weather_label||"C\xf3digo ".concat(e.weather_code)};return(0,s.jsxs)("div",{className:"p-2 rounded-lg",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[(0,s.jsx)("p",{className:"text-xs font-medium mb-1",children:new Date(e.date).toLocaleDateString("pt-PT",{weekday:"short",month:"short",day:"numeric"})}),(0,s.jsx)("p",{className:"text-2xl mb-1",children:a.emoji}),(0,s.jsx)("p",{className:"text-xs mb-1.5",style:{color:"var(--text-3)"},children:a.label}),(0,s.jsxs)("div",{className:"space-y-0.5 text-xs",children:[(0,s.jsxs)("p",{children:[(0,s.jsxs)("span",{style:{color:"var(--text)"},children:[Math.round(e.temp_max),"\xb0"]}),(0,s.jsxs)("span",{style:{color:"var(--text-3)"},children:[" /"," ",Math.round(e.temp_min),"\xb0"]})]}),e.precipitation_sum>0&&(0,s.jsxs)("p",{style:{color:"var(--warning)"},children:["\uD83D\uDCA7 ",e.precipitation_sum,"mm"]})]})]},e.date)})}):d?(0,s.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,s.jsx)(B.A,{className:"w-4 h-4 animate-spin",style:{color:"var(--text-3)"}})}):(0,s.jsxs)("div",{className:"flex items-center gap-2 p-3 rounded-lg",style:{background:"var(--warning-bg)",border:"1px solid var(--warning-border)"},children:[(0,s.jsx)(G.A,{className:"w-4 h-4 shrink-0",style:{color:"var(--warning)"}}),(0,s.jsx)("p",{className:"text-sm",style:{color:"var(--warning)"},children:null!=u?u:"N\xe3o foi poss\xedvel carregar previs\xe3o"})]})]}),e.travelKm&&(0,s.jsxs)("div",{className:"card space-y-2",children:[(0,s.jsx)("p",{className:"section-title",children:"Estimativa de Custo de Combust\xedvel"}),(0,s.jsxs)("div",{className:"p-3 rounded-lg",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{style:{color:"var(--text-3)"},children:"Ida e volta:"}),(0,s.jsxs)("span",{className:"ml-2 font-medium",children:[(2*e.travelKm).toFixed(1)," km"]})]}),b?(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:"A carregar pre\xe7o de combust\xedvel..."}):null,p?(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{style:{color:"var(--text-3)"},children:"Combust\xedvel estimado:"}),(0,s.jsxs)("span",{className:"ml-2 font-medium",children:[(2*e.travelKm*7.5/100*p).toFixed(2)," €"]}),(0,s.jsxs)("span",{className:"ml-2 text-xs",style:{color:"var(--text-3)"},children:["(",p.toFixed(3)," €/L \xb7 ",null!=v?v:"fallback",")"]})]}):null,(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:"(Cache 24h + fallback autom\xe1tico)"})]})]})]})}let Q={itens:[],overhead_pct:15,contingencia_pct:10,margem_alvo_pct:30,margem_minima_pct:15,investimento_pct:0,iva_regime:"continental_23"};function $(e){let{label:a,value:t,min:l,max:r,step:n=1,onChange:c,color:o="var(--accent)"}=e;return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm",style:{color:"var(--text-2)"},children:a}),(0,s.jsxs)("span",{className:"text-sm font-bold tabular-nums",style:{color:o},children:[t.toFixed(+(n<1)),"%"]})]}),(0,s.jsx)("input",{type:"range",min:l,max:r,step:n,value:t,onChange:e=>c(parseFloat(e.target.value)),className:"slider",style:{"--slider-color":o}}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("span",{className:"text-xs",style:{color:"var(--text-3)"},children:[l,"%"]}),(0,s.jsxs)("span",{className:"text-xs",style:{color:"var(--text-3)"},children:[r,"%"]})]})]})}function ee(e){var a;let{item:t,onUpdate:l,onDelete:r}=e,c=t.quantidade*t.preco_unitario,o=i.vj.find(e=>e.value===t.categoria);return(0,s.jsxs)(n.P.div,{layout:!0,initial:{opacity:0,x:-8},animate:{opacity:1,x:0},exit:{opacity:0,x:8,height:0},transition:{duration:.2},className:"grid gap-2 items-center py-2 px-3 rounded-lg",style:{background:"var(--surface-2)",gridTemplateColumns:"auto 1fr 80px 90px 90px 80px auto"},children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full shrink-0",style:{background:null!=(a=null==o?void 0:o.color)?a:"var(--text-3)"},title:null==o?void 0:o.label}),(0,s.jsx)("input",{value:t.nome,onChange:e=>l({...t,nome:e.target.value}),className:"input input-sm bg-transparent border-transparent hover:border-opacity-50 focus:border-opacity-100",style:{padding:"0.25rem 0.5rem",minWidth:0},placeholder:"Nome do item"}),(0,s.jsx)("select",{value:t.categoria,onChange:e=>l({...t,categoria:e.target.value}),className:"input input-sm hidden sm:block",style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem"},children:i.vj.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label.split(" ")[0]},e.value))}),(0,s.jsx)("input",{type:"number",min:0,step:.5,value:t.quantidade,onChange:e=>l({...t,quantidade:parseFloat(e.target.value)||0}),className:"input input-sm text-right",style:{padding:"0.25rem 0.5rem"},placeholder:"Qtd"}),(0,s.jsx)("input",{type:"number",min:0,step:10,value:t.preco_unitario,onChange:e=>l({...t,preco_unitario:parseFloat(e.target.value)||0}),className:"input input-sm text-right",style:{padding:"0.25rem 0.5rem"},placeholder:"€/un"}),(0,s.jsxs)("span",{className:"text-sm font-semibold text-right tabular-nums",style:{color:"var(--accent-2)"},children:[(0,u.Sc)(c),"€"]}),(0,s.jsx)("button",{onClick:r,className:"btn btn-ghost btn-icon-sm shrink-0",style:{color:"var(--error)"},children:(0,s.jsx)(b.A,{className:"h-3.5 w-3.5"})})]})}function ea(){var e,a,_,F,U,V,B,H,W,K,G,X,Z,ea;let et=(0,r.useParams)(),es=(0,r.useRouter)(),el=et.id,er=(0,J.d)(),[en,ec]=(0,l.useState)("Novo Projeto"),[eo,ei]=(0,l.useState)(""),[ed,em]=(0,l.useState)("rascunho"),[eu,ex]=(0,l.useState)(Q),[ep,eh]=(0,l.useState)(null),[ev,ey]=(0,l.useState)(!0),[eb,eg]=(0,l.useState)(!1),[ej,ef]=(0,l.useState)(!1),[eN,e_]=(0,l.useState)("items"),[ek,ew]=(0,l.useState)("crew"),[eC,eS]=(0,l.useState)(!1),[eA,eP]=(0,l.useState)("crew"),[eM,eL]=(0,l.useState)(!1),eq=(0,l.useRef)(null),[ez,eE]=(0,l.useState)(null),[eI,eD]=(0,l.useState)(null),[eR,eF]=(0,l.useState)(null),[eT,eU]=(0,l.useState)(null),[eV,eO]=(0,l.useState)(null),[eB,eH]=(0,l.useState)(null),[eW,eK]=(0,l.useState)(null),[eG,eJ]=(0,l.useState)(null),[eX,eZ]=(0,l.useState)([]),[eY,eQ]=(0,l.useState)("all"),[e$,e0]=(0,l.useState)("all"),[e1,e2]=(0,l.useState)(""),[e3,e4]=(0,l.useState)(!1),[e5,e7]=(0,l.useState)(!1),[e8,e6]=(0,l.useState)(null),[e9,ae]=(0,l.useState)(!1),[aa,at]=(0,l.useState)(!1),as=(0,l.useCallback)(async()=>{var e,a,t,s,l,r,n,c,i,d,m;let u=(0,o.U)(),{data:x,error:p}=await u.from("projects").select("*").eq("id",el).single();if(p||!x)return void es.push("/app/projects");ec(null!=(e=x.project_name)?e:""),ei(null!=(a=x.client_name)?a:""),em(null!=(t=x.status)?t:"rascunho");let h=x.inputs;ex({...Q,...h,itens:null!=(s=null==h?void 0:h.itens)?s:[]}),eh(x.calc),eE(null!=(l=x.location_text)?l:null),eD("number"==typeof x.location_lat?x.location_lat:null),eF("number"==typeof x.location_lng?x.location_lng:null),eU(null!=(r=x.location_address)?r:null),eO("number"==typeof x.travel_km?x.travel_km:null),eH("number"==typeof x.travel_minutes?x.travel_minutes:null),eK(null!=(n=x.logistics_start_date)?n:null),eJ(null!=(c=x.logistics_end_date)?c:null);let v=(0,o.U)(),[y,b]=await Promise.all([v.from("project_dropbox").select("root_path, last_sync_at").eq("project_id",el).single(),v.from("deliverable_files").select("id, filename, ext, file_type, collection, shared_link, bytes, captured_at, created_at").eq("project_id",el).order("captured_at",{ascending:!1})]);y.data&&(e2(null!=(i=y.data.root_path)?i:""),e4(!0),e6(null!=(d=y.data.last_sync_at)?d:null)),eZ(null!=(m=b.data)?m:[]),ey(!1)},[el,es]);(0,l.useEffect)(()=>{as()},[as]),(0,l.useEffect)(()=>{ev||eh(function(e,a,t,s,l){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"continental_23",c=d(e,"crew"),o=d(e,"equipamento"),u=d(e,"pos_producao"),x=d(e,"despesas"),p=d(e,"outro"),h=c+o+u+x+p,v=a/100*h,y=h+v,b=t/100*y,g=y+b,j=r/100*g,f=g+j,N=s<100?f/(1-s/100):f,_=N-f,k=l<100?f/(1-l/100):f,w=k-f,C=(0,i.V)(n),S=C/100*N;return{custo_crew:m(c),custo_equipamento:m(o),custo_pos:m(u),custo_despesas:m(x),custo_outro:m(p),custo_direto:m(h),overhead_valor:m(v),subtotal_com_overhead:m(y),contingencia_valor:m(b),subtotal_com_contingencia:m(g),investimento_valor:m(j),subtotal_pre_iva:m(f),iva_valor:m(S),preco_recomendado:m(N),preco_recomendado_com_iva:m(N+S),margem_alvo_valor:m(_),preco_minimo:m(k),preco_minimo_com_iva:m(k*(1+C/100)),margem_minima_valor:m(w)}}(eu.itens,eu.overhead_pct,eu.contingencia_pct,eu.margem_alvo_pct,eu.margem_minima_pct,eu.investimento_pct,eu.iva_regime))},[eu,ev]);let al=(0,l.useCallback)(async()=>{if(!ep)return;eg(!0);let e=(0,o.U)(),{error:a}=await e.from("projects").update({project_name:en.trim()||"Sem nome",client_name:eo.trim(),status:ed,inputs:eu,calc:ep,location_text:ez,location_lat:eI,location_lng:eR,location_address:eT,travel_km:eV,travel_minutes:eB,logistics_start_date:eW,logistics_end_date:eG,updated_at:new Date().toISOString()}).eq("id",el);eg(!1),a?er.error("Erro ao guardar: ".concat(a.message)):(ef(!0),setTimeout(()=>ef(!1),2e3))},[ep,en,eo,ed,eu,el,er,ez,eI,eR,eT,eV,eB,eW,eG]),ar=(0,l.useRef)(null);(0,l.useEffect)(()=>{if(!ev)return ar.current&&clearTimeout(ar.current),ar.current=setTimeout(()=>{al()},1500),()=>{ar.current&&clearTimeout(ar.current)}},[eu,en,eo,ed,ev,al,ez,eI,eR,eT,eV,eB,eW,eG]);let an=async e=>{eE(e.location_text),eD(e.location_lat),eF(e.location_lng),eU(e.location_address),eO(e.travel_km),eH(e.travel_minutes)},[ac,ao]=(0,l.useState)(!1),[ai,ad]=(0,l.useState)(!1),am=async()=>{ad(!0);let e=(0,o.U)(),{error:a}=await e.from("projects").update({deleted_at:new Date().toISOString()}).eq("id",el);ad(!1),a?er.error("Erro ao apagar projeto: ".concat(a.message)):(er.success("Projeto arquivado com sucesso"),es.push("/app/projects"))},au=async()=>{try{let{generatePdf:e}=await Promise.all([t.e(3394),t.e(3558)]).then(t.bind(t,3558)),a=await e({id:el,user_id:"",project_name:en,client_name:eo,status:ed,inputs:eu,calc:ep,created_at:new Date().toISOString()}),s=new Blob([a],{type:"application/pdf"}),l=URL.createObjectURL(s),r=document.createElement("a");r.href=l,r.download="orcamento-".concat(en.replace(/\s+/g,"-").toLowerCase(),".pdf"),r.click(),URL.revokeObjectURL(l)}catch(e){er.error("Erro ao gerar PDF — tenta novamente")}},ax=async()=>{if(ep)try{let{generateCsv:e}=await Promise.all([t.e(3394),t.e(3558)]).then(t.bind(t,3558)),a=e({id:el,user_id:"",project_name:en,client_name:eo,status:ed,inputs:eu,calc:ep,created_at:new Date().toISOString()}),s=new Blob([a],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(s),r=document.createElement("a");r.href=l,r.download="orcamento-".concat(en.replace(/\s+/g,"-").toLowerCase(),".csv"),r.click(),URL.revokeObjectURL(l)}catch(e){alert("Erro ao gerar CSV")}},[ap,ah]=(0,l.useState)(!1),av=async()=>{if(ep&&!ap){ah(!0);try{let e=await fetch("/api/export/pptx?projectId=".concat(el));if(!e.ok)return void er.error("Erro ao gerar apresenta\xe7\xe3o PPTX");let a=await e.blob(),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download="".concat(en.replace(/\s+/g,"-").toLowerCase(),".pptx"),s.click(),URL.revokeObjectURL(t)}catch(e){er.error("Erro ao gerar apresenta\xe7\xe3o")}finally{ah(!1)}}},ay=ep?i.vj.map(e=>{let a="crew"===e.value?ep.custo_crew:"equipamento"===e.value?ep.custo_equipamento:"pos_producao"===e.value?ep.custo_pos:"despesas"===e.value?ep.custo_despesas:ep.custo_outro;return{name:e.label,value:a,color:e.color}}).filter(e=>e.value>0):[];if(ev)return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"skeleton h-8 w-48 rounded-lg"}),(0,s.jsx)("div",{className:"skeleton h-4 w-32 rounded"}),(0,s.jsxs)("div",{className:"grid gap-4 lg:grid-cols-3",children:[(0,s.jsx)("div",{className:"lg:col-span-2 space-y-3",children:Array.from({length:3}).map((e,a)=>(0,s.jsx)("div",{className:"skeleton h-16 rounded-xl"},a))}),(0,s.jsx)("div",{className:"skeleton h-64 rounded-xl"})]})]});let ab=eu.itens.length,ag=i.BU.find(e=>e.value===ed);return(0,s.jsxs)("div",{className:"space-y-5 pb-8",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(T(),{href:"/app/projects",className:"btn btn-ghost btn-icon-sm mt-1 shrink-0",children:(0,s.jsx)(g.A,{className:"h-4 w-4"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[eM?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{ref:eq,value:en,onChange:e=>ec(e.target.value),onBlur:()=>eL(!1),onKeyDown:e=>"Enter"===e.key&&eL(!1),className:"input text-xl font-bold",style:{letterSpacing:"-0.02em"},autoFocus:!0}),(0,s.jsx)("button",{onClick:()=>eL(!1),className:"btn btn-ghost btn-icon-sm",children:(0,s.jsx)(j.A,{className:"h-4 w-4"})})]}):(0,s.jsxs)("button",{className:"flex items-center gap-2 group text-left",onClick:()=>eL(!0),children:[(0,s.jsx)("h1",{className:"text-xl font-bold truncate",style:{color:"var(--text)",letterSpacing:"-0.02em"},children:en||"Sem nome"}),(0,s.jsx)(f.A,{className:"h-3.5 w-3.5 opacity-0 group-hover:opacity-100 transition-opacity shrink-0",style:{color:"var(--text-3)"}})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[(0,s.jsx)("input",{value:eo,onChange:e=>ei(e.target.value),placeholder:"Nome do cliente",className:"text-sm bg-transparent border-none outline-none",style:{color:"var(--text-2)",minWidth:"10rem"}}),(0,s.jsx)("span",{style:{color:"var(--border-3)"},children:"\xb7"}),(0,s.jsx)("select",{value:ed,onChange:e=>em(e.target.value),className:"badge ".concat(null!=(_=null==ag?void 0:ag.badge)?_:"badge-default"," cursor-pointer border-none bg-transparent text-xs"),style:{appearance:"none",WebkitAppearance:"none",padding:"0.125rem 0.625rem"},children:i.BU.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 shrink-0",children:[(0,s.jsx)(c.N,{children:ej&&(0,s.jsxs)(n.P.span,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0},className:"text-xs flex items-center gap-1",style:{color:"var(--success)"},children:[(0,s.jsx)(j.A,{className:"h-3.5 w-3.5"}),"Guardado"]})}),(0,s.jsxs)("button",{onClick:ax,className:"btn btn-ghost btn-sm",title:"Exportar CSV",children:[(0,s.jsx)(N.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"CSV"})]}),(0,s.jsxs)("button",{onClick:av,disabled:ap||!ep,className:"btn btn-ghost btn-sm",title:"Gerar Apresenta\xe7\xe3o (.pptx)",children:[ap?(0,s.jsxs)("svg",{className:"h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):(0,s.jsx)(k,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:ap?"…":"Slides"})]}),(0,s.jsxs)("button",{onClick:au,className:"btn btn-secondary btn-sm",children:[(0,s.jsx)(N.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"PDF"})]}),(0,s.jsxs)("button",{onClick:al,disabled:eb,className:"btn btn-primary btn-sm",children:[(0,s.jsx)(w.A,{className:"h-4 w-4"}),eb?"…":(0,s.jsx)("span",{className:"hidden sm:inline",children:"Guardar"})]}),(0,s.jsx)("button",{onClick:()=>ao(!0),className:"btn btn-ghost btn-icon-sm",title:"Arquivar projeto",style:{color:"var(--error)"},children:(0,s.jsx)(b.A,{className:"h-4 w-4"})})]})]}),(0,s.jsx)(c.N,{children:ac&&(0,s.jsx)(n.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)"},onClick:e=>{e.target===e.currentTarget&&ao(!1)},children:(0,s.jsxs)(n.P.div,{initial:{scale:.95,y:12,opacity:0},animate:{scale:1,y:0,opacity:1},exit:{scale:.95,y:12,opacity:0},className:"card w-full max-w-sm space-y-4",style:{border:"1px solid var(--error-border)",background:"var(--surface)"},children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-xl",style:{background:"var(--error-bg)"},children:(0,s.jsx)(b.A,{className:"h-5 w-5",style:{color:"var(--error)"}})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold",style:{color:"var(--text)"},children:"Arquivar Projeto"}),(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:"Esta a\xe7\xe3o \xe9 revers\xedvel"})]})]}),(0,s.jsxs)("p",{className:"text-sm",style:{color:"var(--text-2)"},children:["O projeto ",(0,s.jsxs)("strong",{style:{color:"var(--text)"},children:['"',en,'"']})," ser\xe1 arquivado e removido da lista principal. Podes recuper\xe1-lo mais tarde."]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>ao(!1),className:"btn btn-secondary flex-1",children:"Cancelar"}),(0,s.jsx)("button",{onClick:am,disabled:ai,className:"btn btn-sm flex-1",style:{background:"var(--error)",color:"white",borderRadius:"var(--r-full)"},children:ai?"A arquivar…":"Arquivar"})]})]})})}),(0,s.jsx)("div",{className:"tabs-list",children:["resumo","items","logistica","tempo","brief","entregas","aprovacoes"].map(e=>(0,s.jsxs)("button",{onClick:()=>e_(e),className:"tab-trigger ".concat(eN===e?"active":""),children:["resumo"===e&&"Resumo","items"===e&&"Items (".concat(ab,")"),"logistica"===e&&"Log\xedstica","tempo"===e&&"Tempo","brief"===e&&"Brief","entregas"===e&&"Entregas","aprovacoes"===e&&"Aprova\xe7\xf5es"]},e))}),(0,s.jsxs)(c.N,{mode:"wait",children:["items"===eN&&(0,s.jsx)(n.P.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.15},className:"space-y-3",children:i.vj.map(e=>{let a=eu.itens.filter(a=>a.categoria===e.value),t=a.reduce((e,a)=>e+a.quantidade*a.preco_unitario,0),l=ek===e.value;return(0,s.jsxs)("div",{className:"card",style:{padding:0,overflow:"hidden"},children:[(0,s.jsxs)("button",{className:"w-full flex items-center gap-3 px-4 py-3 transition-colors",style:{background:"var(--surface)"},onMouseEnter:e=>e.currentTarget.style.background="var(--surface-2)",onMouseLeave:e=>e.currentTarget.style.background="var(--surface)",onClick:()=>ew(l?null:e.value),children:[(0,s.jsx)("span",{className:"w-2.5 h-2.5 rounded-full shrink-0",style:{background:e.color}}),(0,s.jsx)("span",{className:"text-sm font-medium flex-1 text-left",style:{color:"var(--text)"},children:e.label}),a.length>0&&(0,s.jsx)("span",{className:"badge badge-default text-xs",children:a.length}),t>0&&(0,s.jsx)("span",{className:"text-sm font-semibold tabular-nums",style:{color:e.color},children:(0,u.SS)(t)}),l?(0,s.jsx)(C.A,{className:"h-4 w-4 shrink-0",style:{color:"var(--text-3)"}}):(0,s.jsx)(S.A,{className:"h-4 w-4 shrink-0",style:{color:"var(--text-3)"}})]}),(0,s.jsx)(c.N,{children:l&&(0,s.jsx)(n.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},style:{overflow:"hidden"},children:(0,s.jsxs)("div",{className:"px-3 pb-3 space-y-1.5",style:{borderTop:"1px solid var(--border)"},children:[a.length>0&&(0,s.jsxs)("div",{className:"grid gap-2 px-3 pt-2 pb-1 text-xs",style:{color:"var(--text-3)",gridTemplateColumns:"auto 1fr 80px 90px 90px 80px auto"},children:[(0,s.jsx)("span",{}),(0,s.jsx)("span",{children:"Nome"}),(0,s.jsx)("span",{className:"hidden sm:block",children:"Cat."}),(0,s.jsx)("span",{className:"text-right",children:"Qtd"}),(0,s.jsx)("span",{className:"text-right",children:"€/un"}),(0,s.jsx)("span",{className:"text-right",children:"Total"}),(0,s.jsx)("span",{})]}),(0,s.jsx)(c.N,{children:a.map(e=>(0,s.jsx)(ee,{item:e,onUpdate:a=>{var t;return t=e.id,void ex(e=>({...e,itens:e.itens.map(e=>e.id===t?a:e)}))},onDelete:()=>{var a;return a=e.id,void ex(e=>({...e,itens:e.itens.filter(e=>e.id!==a)}))}},e.id))}),(0,s.jsxs)("button",{onClick:()=>{eP(e.value),eS(!0)},className:"btn btn-ghost btn-sm w-full mt-1",style:{color:e.color,justifyContent:"flex-start"},children:[(0,s.jsx)(A.A,{className:"h-3.5 w-3.5"}),"Adicionar ",e.label.split(" ")[0]]})]})})})]},e.value)})},"items"),"tempo"===eN&&(0,s.jsxs)(n.P.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.15},className:"grid gap-4 lg:grid-cols-2",children:[(0,s.jsxs)("div",{className:"card space-y-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:"Regime de IVA"}),(0,s.jsx)("div",{className:"grid gap-2",children:i.iJ.map(e=>(0,s.jsxs)("button",{onClick:()=>ex(a=>({...a,iva_regime:e.value})),className:"flex items-center gap-3 rounded-lg px-3 py-2.5 transition-all text-left",style:{background:eu.iva_regime===e.value?"var(--accent-dim)":"var(--surface-2)",border:"1px solid ".concat(eu.iva_regime===e.value?"rgba(26,143,163,0.3)":"var(--border)")},children:[(0,s.jsx)("span",{className:"w-4 h-4 rounded-full border-2 flex items-center justify-center shrink-0",style:{borderColor:eu.iva_regime===e.value?"var(--accent)":"var(--border-3)",background:eu.iva_regime===e.value?"var(--accent)":"transparent"},children:eu.iva_regime===e.value&&(0,s.jsx)(j.A,{className:"h-2.5 w-2.5 text-white"})}),(0,s.jsx)("span",{className:"flex-1 text-sm",style:{color:"var(--text)"},children:e.label}),(0,s.jsxs)("span",{className:"badge badge-accent text-xs",children:[e.rate,"%"]})]},e.value))})]}),(0,s.jsxs)("div",{className:"card space-y-5",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:"Margens e Custos"}),(0,s.jsx)($,{label:"Overhead",value:eu.overhead_pct,min:0,max:50,onChange:e=>ex(a=>({...a,overhead_pct:e})),color:"var(--accent)"}),(0,s.jsx)($,{label:"Conting\xeancia",value:eu.contingencia_pct,min:0,max:30,onChange:e=>ex(a=>({...a,contingencia_pct:e})),color:"#d97706"}),(0,s.jsx)($,{label:"Margem Alvo",value:eu.margem_alvo_pct,min:0,max:60,onChange:e=>ex(a=>({...a,margem_alvo_pct:e})),color:"#34d399"}),(0,s.jsx)($,{label:"Margem M\xednima",value:eu.margem_minima_pct,min:0,max:40,onChange:e=>ex(a=>({...a,margem_minima_pct:e})),color:"#7c3aed"}),(0,s.jsx)($,{label:"Investimento",value:eu.investimento_pct,min:0,max:20,onChange:e=>ex(a=>({...a,investimento_pct:e})),color:"#f87171"})]})]},"tempo"),"resumo"===eN&&ep&&(0,s.jsxs)(n.P.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.15},className:"space-y-4",children:[(0,s.jsxs)("div",{className:"card-accent rounded-2xl p-6 text-center space-y-1",style:{background:"linear-gradient(135deg, var(--surface) 0%, var(--surface-3) 100%)"},children:[(0,s.jsx)("p",{className:"section-title",children:"Pre\xe7o Recomendado"}),(0,s.jsx)(n.P.p,{initial:{scale:.95,opacity:.5},animate:{scale:1,opacity:1},className:"text-4xl font-bold",style:{color:"var(--accent-2)",letterSpacing:"-0.04em"},children:(0,u.SS)(ep.preco_recomendado)},ep.preco_recomendado),(0,s.jsxs)("p",{className:"text-sm",style:{color:"var(--text-2)"},children:["c/ IVA: ",(0,s.jsx)("strong",{style:{color:"var(--text)"},children:(0,u.SS)(ep.preco_recomendado_com_iva)})," \xb7 ","Margem: ",(0,s.jsxs)("strong",{style:{color:"#34d399"},children:[eu.margem_alvo_pct,"%"]})]}),(0,s.jsxs)("div",{className:"mt-3 pt-3 flex items-center justify-center gap-6",style:{borderTop:"1px solid var(--border)"},children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:"Pre\xe7o M\xednimo"}),(0,s.jsx)("p",{className:"text-base font-bold",style:{color:"var(--text-2)"},children:(0,u.SS)(ep.preco_minimo)}),(0,s.jsxs)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:["c/ IVA ",(0,u.SS)(ep.preco_minimo_com_iva)]})]}),(0,s.jsx)("div",{className:"h-10",style:{width:"1px",background:"var(--border-2)"}}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:["IVA (","isento"===eu.iva_regime?"0":null==(e=i.iJ.find(e=>e.value===eu.iva_regime))?void 0:e.rate,"%)"]}),(0,s.jsx)("p",{className:"text-base font-bold",style:{color:"var(--text-2)"},children:(0,u.SS)(ep.iva_valor)})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[ay.length>0&&(0,s.jsxs)("div",{className:"card space-y-4",children:[(0,s.jsx)("p",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:"Distribui\xe7\xe3o de Custos"}),(0,s.jsx)("div",{className:"h-48",children:(0,s.jsx)(x.u,{width:"100%",height:"100%",children:(0,s.jsxs)(p.r,{children:[(0,s.jsx)(h.Fq,{data:ay,cx:"50%",cy:"50%",innerRadius:55,outerRadius:80,paddingAngle:3,dataKey:"value",children:ay.map((e,a)=>(0,s.jsx)(v.f,{fill:e.color,strokeWidth:0},a))}),(0,s.jsx)(y.m,{formatter:e=>[(0,u.SS)(Number(null!=e?e:0)),""],contentStyle:{background:"var(--surface-3)",border:"1px solid var(--border-2)",borderRadius:"8px",fontSize:"0.8rem",color:"var(--text)"}})]})})}),(0,s.jsx)("div",{className:"space-y-1.5",children:ay.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-2.5 h-2.5 rounded-full shrink-0",style:{background:e.color}}),(0,s.jsx)("span",{className:"text-xs",style:{color:"var(--text-2)"},children:e.name})]}),(0,s.jsx)("span",{className:"text-xs font-medium tabular-nums",style:{color:"var(--text)"},children:(0,u.SS)(e.value)})]},e.name))})]}),(0,s.jsxs)("div",{className:"card space-y-2",children:[(0,s.jsx)("p",{className:"text-sm font-semibold mb-3",style:{color:"var(--text)"},children:"Breakdown Financeiro"}),[{label:"Custo Direto",value:ep.custo_direto,color:"var(--text)"},{label:"Overhead (".concat(eu.overhead_pct,"%)"),value:ep.overhead_valor,color:"var(--accent-2)"},{label:"Conting\xeancia (".concat(eu.contingencia_pct,"%)"),value:ep.contingencia_valor,color:"#d97706"},...ep.investimento_valor>0?[{label:"Investimento (".concat(eu.investimento_pct,"%)"),value:ep.investimento_valor,color:"#f87171"}]:[],{label:"Subtotal s/ IVA",value:ep.subtotal_pre_iva,color:"var(--text)",bold:!0},{label:"Margem Alvo (".concat(eu.margem_alvo_pct,"%)"),value:ep.margem_alvo_valor,color:"#34d399"}].map(e=>{let{label:a,value:t,color:l,bold:r}=e;return(0,s.jsxs)("div",{className:"flex items-center justify-between py-1",style:{borderBottom:"1px solid var(--border)"},children:[(0,s.jsx)("span",{className:"text-sm",style:{color:r?"var(--text)":"var(--text-2)",fontWeight:r?600:400},children:a}),(0,s.jsx)("span",{className:"text-sm tabular-nums",style:{color:l,fontWeight:r?700:500},children:(0,u.SS)(t)})]},a)})]})]}),(0,s.jsxs)("div",{className:"card space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:"Condi\xe7\xf5es Comerciais"}),(0,s.jsx)("button",{onClick:()=>{var e,a;let t=null!=(a=null!=(e=null==ep?void 0:ep.preco_recomendado_com_iva)?e:null==ep?void 0:ep.preco_recomendado)?a:0,s=Math.round(.5*t*100)/100,l=Math.round((t-s)*100)/100,r="Proposta v\xe1lida por 30 dias. Pagamento: 50% de sinal (".concat((0,u.SS)(s),") na adjudica\xe7\xe3o + 50% (").concat((0,u.SS)(l),") na entrega. Prazo de pagamento: 30 dias. Revis\xf5es inclu\xeddas: 2 rondas. Propriedade intelectual transferida ap\xf3s pagamento integral.");ex(e=>({...e,condicoes:r}))},className:"btn btn-ghost btn-sm text-xs",style:{color:"var(--accent-2)"},children:"Gerar automaticamente"})]}),(0,s.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Observa\xe7\xf5es Internas"}),(0,s.jsx)("textarea",{value:null!=(F=eu.observacoes)?F:"",onChange:e=>ex(a=>({...a,observacoes:e.target.value})),className:"input",rows:3,placeholder:"Notas internas, pontos de aten\xe7\xe3o…",style:{resize:"none"}})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Termos e Condi\xe7\xf5es (PDF)"}),(0,s.jsx)("textarea",{value:null!=(U=eu.condicoes)?U:"",onChange:e=>ex(a=>({...a,condicoes:e.target.value})),className:"input",rows:3,placeholder:"Clica em 'Gerar automaticamente' ou escreve aqui…",style:{resize:"none"}})]})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:[{label:"50/50",desc:"50% sinal + 50% entrega"},{label:"30/70",desc:"30% sinal + 70% entrega"},{label:"Faseado",desc:"33% in\xedcio + 33% rodagem + 34% entrega"}].map(e=>(0,s.jsxs)("button",{onClick:()=>{var a,t;let s=null!=(t=null!=(a=null==ep?void 0:ep.preco_recomendado_com_iva)?a:null==ep?void 0:ep.preco_recomendado)?t:0,l="";if("50/50"===e.label){let e=Math.round(.5*s*100)/100;l="Pagamento em 2 presta\xe7\xf5es: 50% de sinal (".concat((0,u.SS)(e),") + 50% na entrega. V\xe1lido 30 dias.")}else if("30/70"===e.label){let e=Math.round(.3*s*100)/100;l="Pagamento em 2 presta\xe7\xf5es: 30% de sinal (".concat((0,u.SS)(e),") + 70% na entrega. V\xe1lido 30 dias.")}else{let e=Math.round(.33*s*100)/100;l="Pagamento faseado: 1/3 in\xedcio (".concat((0,u.SS)(e),") + 1/3 durante rodagem + 1/3 entrega. V\xe1lido 30 dias.")}ex(e=>({...e,condicoes:l}))},className:"btn btn-ghost btn-sm text-xs",style:{fontSize:"0.7rem",padding:"0.25rem 0.6rem"},children:[e.label,(0,s.jsxs)("span",{className:"ml-1 hidden sm:inline",style:{color:"var(--text-3)"},children:["— ",e.desc]})]},e.label))})]})]},"resumo"),"logistica"===eN&&(0,s.jsx)(n.P.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.15},className:"space-y-4",children:(0,s.jsx)(Y,{projectId:el,locationText:ez,locationLat:eI,locationLng:eR,locationAddress:eT,travelKm:eV,travelMinutes:eB,startDate:eW,endDate:eG,onUpdate:an})},"logistica"),"brief"===eN&&(0,s.jsxs)(n.P.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.15},className:"space-y-4",children:[(0,s.jsxs)("div",{className:"card space-y-4",children:[(0,s.jsx)("p",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:"Briefing de Produ\xe7\xe3o"}),(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Tipo de Projeto"}),(0,s.jsxs)("select",{value:null!=(V=null==(a=eu.descricao)?void 0:a.split("|")[0])?V:"",onChange:e=>{var a;let t=(null!=(a=eu.descricao)?a:"").split("|");t[0]=e.target.value,ex(e=>({...e,descricao:t.join("|")}))},className:"input",children:[(0,s.jsx)("option",{value:"",children:"Selecionar tipo…"}),(0,s.jsx)("option",{value:"institucional",children:"V\xeddeo Institucional"}),(0,s.jsx)("option",{value:"shortform",children:"Conte\xfado Short-Form"}),(0,s.jsx)("option",{value:"documentary",children:"Document\xe1rio"}),(0,s.jsx)("option",{value:"event",children:"Capta\xe7\xe3o de Evento"}),(0,s.jsx)("option",{value:"commercial",children:"An\xfancio Publicit\xe1rio"}),(0,s.jsx)("option",{value:"social",children:"Social Media"}),(0,s.jsx)("option",{value:"interview",children:"Entrevista"}),(0,s.jsx)("option",{value:"training",children:"V\xeddeo de Forma\xe7\xe3o"}),(0,s.jsx)("option",{value:"other",children:"Outro"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Data de Entrega"}),(0,s.jsx)("input",{type:"date",value:null!=(B=eu.data_projeto)?B:"",onChange:e=>ex(a=>({...a,data_projeto:e.target.value})),className:"input"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Data In\xedcio de Rodagem"}),(0,s.jsx)("input",{type:"date",value:null!=(H=eu.shoot_date_start)?H:"",onChange:e=>ex(a=>({...a,shoot_date_start:e.target.value})),className:"input"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Data Fim de Rodagem"}),(0,s.jsx)("input",{type:"date",value:null!=(W=eu.shoot_date_end)?W:"",onChange:e=>ex(a=>({...a,shoot_date_end:e.target.value})),className:"input"})]}),(0,s.jsx)("div",{className:"sm:col-span-2",children:(0,s.jsxs)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:["\uD83D\uDCA1 Localiza\xe7\xe3o e rotas: usar a aba ",(0,s.jsx)("strong",{children:"Log\xedstica"})]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Pa\xeds"}),(0,s.jsx)("input",{type:"text",value:null!=(K=eu.pais)?K:"Portugal",onChange:e=>ex(a=>({...a,pais:e.target.value})),className:"input",placeholder:"Portugal"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Localidade / Zona"}),(0,s.jsx)("input",{type:"text",value:null!=(G=eu.localidade)?G:"",onChange:e=>ex(a=>({...a,localidade:e.target.value})),className:"input",placeholder:"Ex: Chiado, Parque das Na\xe7\xf5es…"})]})]})]}),(0,s.jsxs)("div",{className:"card space-y-4",children:[(0,s.jsx)("p",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:"Brief do Cliente"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Descri\xe7\xe3o do Projeto"}),(0,s.jsx)("textarea",{value:null!=(X=eu.descricao)?X:"",onChange:e=>ex(a=>({...a,descricao:e.target.value})),className:"input",rows:4,placeholder:"Descreve o projeto, objetivos, p\xfablico-alvo, refer\xeancias visuais…",style:{resize:"none"}})]}),(0,s.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Observa\xe7\xf5es Internas"}),(0,s.jsx)("textarea",{value:null!=(Z=eu.observacoes)?Z:"",onChange:e=>ex(a=>({...a,observacoes:e.target.value})),className:"input",rows:3,placeholder:"Notas internas, pontos de aten\xe7\xe3o…",style:{resize:"none"}})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Condi\xe7\xf5es Comerciais"}),(0,s.jsx)("textarea",{value:null!=(ea=eu.condicoes)?ea:"",onChange:e=>ex(a=>({...a,condicoes:e.target.value})),className:"input",rows:3,placeholder:"Termos de pagamento, prazo de revis\xf5es…",style:{resize:"none"}})]})]})]})]},"brief"),"entregas"===eN&&(0,s.jsxs)(n.P.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.15},className:"space-y-4",children:[(0,s.jsxs)("div",{className:"card space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(P,{className:"h-4 w-4",style:{color:"var(--text-3)"}}),(0,s.jsx)("p",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:"Configura\xe7\xe3o Dropbox"})]}),e8&&(0,s.jsxs)("span",{className:"text-xs",style:{color:"var(--text-3)"},children:["Sync: ",new Date(e8).toLocaleDateString("pt-PT",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})]})]}),e9||!e3?(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{className:"input flex-1",value:e1,onChange:e=>e2(e.target.value),placeholder:"/Beyond/Clients/NomeCliente/NomeProjeto"}),(0,s.jsx)("button",{className:"btn btn-primary btn-sm",disabled:aa||!e1.trim(),onClick:async()=>{at(!0);let e=(0,o.U)();await e.from("project_dropbox").upsert({project_id:el,root_path:e1.trim()},{onConflict:"project_id"}),e4(!0),ae(!1),at(!1)},children:aa?"…":"Guardar"})]}):(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(M.A,{className:"h-4 w-4 shrink-0",style:{color:"var(--accent)"}}),(0,s.jsx)("span",{className:"text-sm flex-1 truncate font-mono",style:{color:"var(--text-2)"},children:e1}),(0,s.jsx)("button",{className:"btn btn-secondary btn-sm",onClick:()=>ae(!0),children:"Editar"}),(0,s.jsxs)("button",{className:"btn btn-primary btn-sm",disabled:e5,onClick:async()=>{e7(!0);try{let e=await fetch("/api/dropbox/sync?projectId=".concat(el),{method:"POST"}),a=await e.json();if(void 0!==a.synced){e6(new Date().toISOString());let e=(0,o.U)(),{data:a}=await e.from("deliverable_files").select("id, filename, ext, file_type, collection, shared_link, bytes, captured_at, created_at").eq("project_id",el).order("captured_at",{ascending:!1});eZ(null!=a?a:[])}}catch(e){}e7(!1)},children:[(0,s.jsx)(L.A,{className:"h-3.5 w-3.5 ".concat(e5?"animate-spin":"")}),e5?"A sincronizar…":"Sincronizar agora"]})]})]}),0===eX.length?(0,s.jsx)("div",{className:"card",children:(0,s.jsxs)("div",{className:"empty-state",children:[(0,s.jsx)(q.A,{className:"empty-icon"}),(0,s.jsx)("p",{className:"empty-title",children:"Sem entregas"}),(0,s.jsx)("p",{className:"empty-desc",children:"Configura o caminho Dropbox e sincroniza para ver os ficheiros."})]})}):(()=>{let e={photo:{icon:z.A,color:"#1a8fa3",label:"Fotos"},video:{icon:E,color:"#7c3aed",label:"V\xeddeos"},document:{icon:I.A,color:"#d97706",label:"Docs"},audio:{icon:D,color:"#34a853",label:"\xc1udio"},other:{icon:q.A,color:"#5a6280",label:"Outros"}},a=["all",...Array.from(new Set(eX.map(e=>e.file_type)))],t=["all",...Array.from(new Set(eX.map(e=>{var a;return null!=(a=e.collection)?a:"Geral"})))],l=eX.filter(e=>{var a;let t="all"===eY||e.file_type===eY,s="all"===e$||(null!=(a=e.collection)?a:"Geral")===e$;return t&&s}).reduce((e,a)=>{var t,s;let l=null!=(t=a.collection)?t:"Geral";return(null!=(s=e[l])?s:e[l]=[]).push(a),e},{});return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsx)("div",{className:"flex gap-1 p-1 rounded-xl",style:{background:"var(--surface-2)"},children:a.map(a=>{var t;let l=e[a];return(0,s.jsx)("button",{onClick:()=>eQ(a),className:"px-3 py-1 rounded-lg text-xs font-medium transition-all",style:{background:eY===a?"var(--surface-3)":"transparent",color:eY===a?"var(--text)":"var(--text-3)"},children:"all"===a?"Todos":null!=(t=null==l?void 0:l.label)?t:a},a)})}),t.length>2&&(0,s.jsx)("div",{className:"flex gap-1 p-1 rounded-xl flex-wrap",style:{background:"var(--surface-2)"},children:t.map(e=>(0,s.jsx)("button",{onClick:()=>e0(e),className:"px-3 py-1 rounded-lg text-xs font-medium transition-all",style:{background:e$===e?"var(--surface-3)":"transparent",color:e$===e?"var(--text)":"var(--text-3)"},children:"all"===e?"Todas":e},e))})]}),Object.entries(l).map(a=>{let[t,l]=a;return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide",style:{color:"var(--text-3)"},children:t}),(0,s.jsx)("div",{className:"grid gap-2 sm:grid-cols-2",children:l.map(a=>{var t,l;let r=null!=(l=e[a.file_type])?l:e.other,n=r.icon;return(0,s.jsxs)("div",{className:"flex items-center gap-3 rounded-lg px-3 py-2.5",style:{background:"var(--surface-2)"},children:[(0,s.jsx)("div",{className:"h-8 w-8 rounded-lg flex items-center justify-center shrink-0",style:{background:"".concat(r.color,"20")},children:(0,s.jsx)(n,{className:"h-4 w-4",style:{color:r.color}})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-xs font-medium truncate",style:{color:"var(--text)"},children:a.filename}),(0,s.jsxs)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:[null==(t=a.ext)?void 0:t.toUpperCase(),a.bytes?" \xb7 ".concat(a.bytes>1048576?"".concat((a.bytes/1048576).toFixed(1)," MB"):"".concat((a.bytes/1024).toFixed(0)," KB")):""]})]}),a.shared_link&&(0,s.jsx)("a",{href:a.shared_link,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 px-2 py-1 rounded-lg text-xs",style:{background:"var(--accent-bg)",color:"var(--accent)"},children:(0,s.jsx)(R.A,{className:"h-3 w-3"})})]},a.id)})})]},t)})]})})()]},"entregas"),"aprovacoes"===eN&&(0,s.jsx)(n.P.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.15},className:"space-y-4",children:(0,s.jsxs)("div",{className:"card space-y-3",children:[(0,s.jsx)("p",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:"Aprova\xe7\xf5es"}),(0,s.jsx)("p",{className:"text-sm",style:{color:"var(--text-2)"},children:"Esta sec\xe7\xe3o concentra decis\xf5es de aprova\xe7\xe3o do cliente por ronda."}),(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:"Pr\xf3ximo passo: ligar hist\xf3rico de aprova\xe7\xf5es aos m\xf3dulos de inbox e notifica\xe7\xf5es."})]})},"aprovacoes")]}),ep&&ep.custo_direto>0&&"items"===eN&&(0,s.jsx)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"fixed bottom-4 left-1/2 -translate-x-1/2 z-30 hidden md:flex",style:{maxWidth:"calc(100% - 2rem)",width:"auto"},children:(0,s.jsxs)("div",{className:"flex items-center gap-6 rounded-2xl px-6 py-3",style:{background:"var(--glass-bg)",backdropFilter:"var(--glass-blur)",WebkitBackdropFilter:"var(--glass-blur)",border:"1px solid var(--border-2)",boxShadow:"var(--shadow-lg)"},children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:"Custo Direto"}),(0,s.jsx)("p",{className:"text-sm font-bold tabular-nums",style:{color:"var(--text)"},children:(0,u.SS)(ep.custo_direto)})]}),(0,s.jsx)("span",{style:{color:"var(--border-3)"},children:"→"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:"Recomendado"}),(0,s.jsx)("p",{className:"text-sm font-bold tabular-nums",style:{color:"var(--accent-2)"},children:(0,u.SS)(ep.preco_recomendado)})]}),(0,s.jsx)("span",{style:{color:"var(--border-3)"},children:"|"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:"c/ IVA"}),(0,s.jsx)("p",{className:"text-sm font-bold tabular-nums",style:{color:"var(--text)"},children:(0,u.SS)(ep.preco_recomendado_com_iva)})]}),(0,s.jsx)("button",{onClick:()=>e_("resumo"),className:"btn btn-primary btn-sm ml-2",children:"Ver Resumo"})]})}),ep&&ep.custo_direto>0&&"items"===eN&&(0,s.jsx)("div",{className:"fixed bottom-[72px] left-0 right-0 md:hidden px-4 pb-2",style:{zIndex:30},children:(0,s.jsxs)("div",{className:"rounded-xl px-4 py-2 flex items-center justify-between",style:{background:"var(--glass-bg)",backdropFilter:"var(--glass-blur)",WebkitBackdropFilter:"var(--glass-blur)",border:"1px solid var(--border-2)",boxShadow:"var(--shadow-md)"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:"Recomendado"}),(0,s.jsx)("p",{className:"text-base font-bold tabular-nums",style:{color:"var(--accent-2)"},children:(0,u.SS)(ep.preco_recomendado)})]}),(0,s.jsx)("button",{onClick:()=>e_("resumo"),className:"btn btn-primary btn-sm",children:"Resumo"})]})}),(0,s.jsx)(O,{open:eC,defaultCategoria:eA,onClose:()=>eS(!1),onSelect:e=>{ex(a=>({...a,itens:[...a.itens,e]})),ew(e.categoria)}})]})}},89559:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},89715:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},93014:(e,a,t)=>{"use strict";t.d(a,{ToastProvider:()=>x,d:()=>d});var s=t(95155),l=t(12115),r=t(61362),n=t(78874),c=t(23327),o=t(65229);let i=(0,l.createContext)(null);function d(){let e=(0,l.useContext)(i);if(!e)throw Error("useToast must be used inside <ToastProvider>");return e}let m={success:(0,s.jsx)(r.A,{className:"h-4 w-4 shrink-0",style:{color:"#22c55e"}}),error:(0,s.jsx)(n.A,{className:"h-4 w-4 shrink-0",style:{color:"#ef4444"}}),info:(0,s.jsx)(c.A,{className:"h-4 w-4 shrink-0",style:{color:"var(--accent)"}})},u={success:"rgba(34,197,94,0.3)",error:"rgba(239,68,68,0.3)",info:"rgba(26,143,163,0.3)"};function x(e){let{children:a}=e,[t,r]=(0,l.useState)([]),n=(0,l.useRef)({}),c=(0,l.useCallback)(e=>{r(a=>a.filter(a=>a.id!==e)),n.current[e]&&(clearTimeout(n.current[e]),delete n.current[e])},[]),d=(0,l.useCallback)((e,a)=>{let t=Math.random().toString(36).slice(2);r(s=>[...s.slice(-4),{id:t,type:e,message:a}]),n.current[t]=setTimeout(()=>c(t),3500)},[c]),x=(0,l.useMemo)(()=>({success:e=>d("success",e),error:e=>d("error",e),info:e=>d("info",e)}),[d]);return(0,s.jsxs)(i.Provider,{value:x,children:[a,(0,s.jsx)("div",{"aria-live":"polite",className:"fixed bottom-5 right-4 z-[9999] flex flex-col gap-2 items-end pointer-events-none",style:{maxWidth:"min(380px, calc(100vw - 2rem))"},children:t.map(e=>(0,s.jsxs)("div",{role:"alert",className:"pointer-events-auto flex items-start gap-3 rounded-xl px-4 py-3 text-sm shadow-lg animate-toast-in",style:{background:"var(--surface-3)",border:"1px solid ".concat(u[e.type]),backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",color:"var(--text)",minWidth:"240px"},children:[m[e.type],(0,s.jsx)("p",{className:"flex-1 leading-snug",style:{color:"var(--text)"},children:e.message}),(0,s.jsx)("button",{onClick:()=>c(e.id),className:"shrink-0 mt-0.5 opacity-50 hover:opacity-100 transition-opacity","aria-label":"Fechar",children:(0,s.jsx)(o.A,{className:"h-3.5 w-3.5"})})]},e.id))}),(0,s.jsx)("style",{children:"\n        @keyframes toast-in {\n          from { opacity: 0; transform: translateY(8px) scale(0.96); }\n          to   { opacity: 1; transform: translateY(0) scale(1); }\n        }\n        .animate-toast-in { animation: toast-in 0.18s ease-out forwards; }\n      "})]})}},93499:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]])}},e=>{e.O(0,[5417,6028,4909,2619,1163,9939,8441,1255,7358],()=>e(e.s=53304)),_N_E=e.O()}]);