(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1618],{8539:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>g});var a=t(95155),r=t(12115),l=t(69434),i=t(26497),c=t(62890),n=t(64269),o=t(6191),d=t(89715),m=t(5917),u=t(26617),p=t(27937),x=t(65229),h=t(93014);let y={institutional:"Institucional",shortform:"Short-Form",documentary:"Document\xe1rio",event:"Evento",custom:"Personalizado"},j={institutional:"#1a8fa3",shortform:"#7c3aed",documentary:"#d97706",event:"#34d399",custom:"#5a6280"};function g(){let[e,s]=(0,r.useState)([]),[t,g]=(0,r.useState)(!0),[v,f]=(0,r.useState)(null),[N,b]=(0,r.useState)(null),[w,_]=(0,r.useState)([]),[k,C]=(0,r.useState)(!1),[S,A]=(0,r.useState)(null),P=(0,h.d)(),z=(0,r.useCallback)(async()=>{g(!0),f(null);let e=(0,c.U)(),{data:t,error:a}=await e.from("templates").select("id, name, type, defaults, created_at, user_id").order("created_at",{ascending:!0});if(a)P.error("Erro ao carregar templates: ".concat(a.message)),f(a.message);else if(t){let a=t.map(e=>e.id),r=await Promise.all(a.map(s=>e.from("template_items").select("id",{count:"exact",head:!0}).eq("template_id",s)));s(t.map((e,s)=>{var t;return{...e,_itemCount:null!=(t=r[s].count)?t:0}}))}g(!1)},[P]);(0,r.useEffect)(()=>{z()},[z]);let I=async e=>{b(e),C(!0);let s=(0,c.U)(),{data:t}=await s.from("template_items").select("*").eq("template_id",e.id).order("ordem",{ascending:!0});_(null!=t?t:[]),C(!1)},F=async e=>{var s,t,a,r;let l=(0,c.U)(),{data:i}=await l.auth.getUser();if(!i.user)return;let o=e.defaults,{data:d,error:m}=await l.from("projects").insert({user_id:i.user.id,owner_user_id:i.user.id,project_name:"".concat(e.name," — Novo Projeto"),client_name:"",status:"rascunho",inputs:{itens:w.map(e=>({id:(0,n.$C)(),categoria:e.categoria,nome:e.nome,unidade:e.unidade,quantidade:e.quantidade,preco_unitario:e.preco_unitario,total:e.quantidade*e.preco_unitario})),overhead_pct:null!=(s=o.overhead_pct)?s:15,contingencia_pct:null!=(t=o.contingencia_pct)?t:10,margem_alvo_pct:null!=(a=o.margem_alvo_pct)?a:30,margem_minima_pct:null!=(r=o.margem_minima_pct)?r:15,investimento_pct:0,iva_regime:"continental_23"}}).select().single();if(m)return void P.error("Erro ao criar projeto: ".concat(m.message));d&&(P.success("Projeto criado a partir do template!"),A(e.id),setTimeout(()=>{window.location.href="/app/projects/".concat(d.id)},800))},q=e=>{var s;return null!=(s=j[e.type])?s:"#5a6280"},E=e.filter(e=>null===e.user_id),T=e.filter(e=>null!==e.user_id);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"page-header",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"page-title",children:"Templates"}),(0,a.jsx)("p",{className:"page-subtitle",children:"Estruturas reutiliz\xe1veis de itens e or\xe7amentos"})]}),(0,a.jsxs)("button",{className:"btn btn-secondary",disabled:!0,children:[(0,a.jsx)(o.A,{className:"h-4 w-4"}),"Novo Template"]})]}),t?(0,a.jsx)("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:4}).map((e,s)=>(0,a.jsxs)("div",{className:"card space-y-3",children:[(0,a.jsx)("div",{className:"skeleton h-10 w-10 rounded-lg"}),(0,a.jsx)("div",{className:"skeleton h-5 w-32"}),(0,a.jsx)("div",{className:"skeleton h-4 w-24"})]},s))}):v?(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"empty-state",children:[(0,a.jsx)(d.A,{className:"empty-icon"}),(0,a.jsx)("p",{className:"empty-title",children:"Erro ao carregar templates"}),(0,a.jsx)("p",{className:"empty-desc",children:v}),(0,a.jsx)("button",{className:"btn btn-secondary btn-sm",onClick:z,children:"Tentar novamente"})]})}):(0,a.jsxs)(a.Fragment,{children:[E.length>0&&(0,a.jsxs)("section",{className:"space-y-3",children:[(0,a.jsx)("p",{className:"section-title",children:"Presets de sistema"}),(0,a.jsx)("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-4",children:E.map((e,s)=>{var t;return(0,a.jsx)(l.P.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:.05*s},children:(0,a.jsxs)("button",{onClick:()=>I(e),className:"card card-hover w-full text-left group relative",children:[S===e.id&&(0,a.jsx)("div",{className:"absolute inset-0 rounded-xl flex items-center justify-center z-10",style:{background:"rgba(8,11,16,0.85)"},children:(0,a.jsx)(m.A,{className:"h-8 w-8",style:{color:"#34d399"}})}),(0,a.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg mb-3",style:{background:"".concat(q(e),"20")},children:(0,a.jsx)(d.A,{className:"h-5 w-5",style:{color:q(e)}})}),(0,a.jsx)("p",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:e.name}),(0,a.jsxs)("p",{className:"text-xs mt-1 flex items-center gap-1",style:{color:"var(--text-3)"},children:[(0,a.jsx)(u.A,{className:"h-3 w-3"}),e._itemCount," itens",(0,a.jsxs)("span",{className:"ml-auto flex items-center gap-0.5",style:{color:q(e)},children:[null!=(t=y[e.type])?t:e.type,(0,a.jsx)(p.A,{className:"h-3 w-3"})]})]})]})},e.id)})})]}),T.length>0&&(0,a.jsxs)("section",{className:"space-y-3",children:[(0,a.jsx)("p",{className:"section-title",children:"Os meus templates"}),(0,a.jsx)("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:T.map((e,s)=>{var t;return(0,a.jsx)(l.P.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:.05*s},children:(0,a.jsxs)("button",{onClick:()=>I(e),className:"card card-hover w-full text-left",children:[(0,a.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg mb-3",style:{background:"".concat(q(e),"20")},children:(0,a.jsx)(d.A,{className:"h-5 w-5",style:{color:q(e)}})}),(0,a.jsx)("p",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:e.name}),(0,a.jsxs)("p",{className:"text-xs mt-1",style:{color:"var(--text-3)"},children:[null!=(t=y[e.type])?t:e.type," \xb7 ",(0,n.kz)(e.created_at)]})]})},e.id)})})]}),0===E.length&&0===T.length&&(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"empty-state",children:[(0,a.jsx)(d.A,{className:"empty-icon"}),(0,a.jsx)("p",{className:"empty-title",children:"Sem templates"}),(0,a.jsx)("p",{className:"empty-desc",children:"Os presets de sistema estar\xe3o dispon\xedveis ap\xf3s aplicar as migra\xe7\xf5es SQL"})]})})]}),(0,a.jsx)(i.N,{children:N&&(0,a.jsx)(l.P.div,{className:"modal-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>b(null),children:(0,a.jsxs)(l.P.div,{className:"card-glass",initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2},onClick:e=>e.stopPropagation(),style:{width:"100%",maxWidth:"560px",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column"},children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 p-5 border-b",style:{borderColor:"var(--border)"},children:[(0,a.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-xl",style:{background:"".concat(q(N),"20")},children:(0,a.jsx)(d.A,{className:"h-5 w-5",style:{color:q(N)}})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h2",{className:"text-base font-semibold truncate",style:{color:"var(--text)"},children:N.name}),(0,a.jsxs)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:[y[N.type]," \xb7 ",N._itemCount," itens"]})]}),(0,a.jsx)("button",{onClick:()=>b(null),className:"flex h-8 w-8 items-center justify-center rounded-lg transition-colors",style:{background:"var(--surface-2)",color:"var(--text-3)"},children:(0,a.jsx)(x.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-5 space-y-2",children:[k?Array.from({length:5}).map((e,s)=>(0,a.jsx)("div",{className:"skeleton h-10 w-full rounded-lg"},s)):0===w.length?(0,a.jsx)("p",{className:"text-sm text-center py-8",style:{color:"var(--text-3)"},children:"Sem itens neste template"}):w.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 rounded-lg px-3 py-2.5",style:{background:"var(--surface-2)"},children:[(0,a.jsx)("div",{className:"h-2 w-2 rounded-full shrink-0",style:{background:"crew"===e.categoria?"#1a8fa3":"equipamento"===e.categoria?"#8b6b56":"pos_producao"===e.categoria?"#7c3aed":"despesas"===e.categoria?"#d97706":"#5a6280"}}),(0,a.jsx)("span",{className:"flex-1 text-sm",style:{color:"var(--text)"},children:e.nome}),(0,a.jsxs)("span",{className:"text-xs",style:{color:"var(--text-3)"},children:[e.quantidade," ",e.unidade]})]},e.id)),Object.keys(N.defaults).length>0&&(0,a.jsxs)("div",{className:"rounded-lg p-3 mt-3 space-y-1.5",style:{background:"var(--surface-2)",border:"1px solid var(--border)"},children:[(0,a.jsx)("p",{className:"text-xs font-medium",style:{color:"var(--text-3)"},children:"Par\xe2metros por omiss\xe3o"}),Object.entries(N.defaults).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,a.jsx)("span",{style:{color:"var(--text-3)"},children:s.replace(/_pct$/,"").replace(/_/g," ")}),(0,a.jsx)("span",{style:{color:"var(--accent-2)"},children:"number"==typeof t?"".concat(t,"%"):String(t)})]},s)})]})]}),(0,a.jsx)("div",{className:"p-5 border-t",style:{borderColor:"var(--border)"},children:(0,a.jsx)("button",{onClick:()=>F(N),disabled:k||S===N.id,className:"btn btn-primary w-full",children:S===N.id?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.A,{className:"h-4 w-4"}),"Projeto criado! A redirecionar…"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.A,{className:"h-4 w-4"}),"Usar template — Criar novo projeto"]})})})]})})})]})}},15709:(e,s,t)=>{Promise.resolve().then(t.bind(t,8539))},62890:(e,s,t)=>{"use strict";t.d(s,{U:()=>r});var a=t(55417);function r(){return(0,a.createBrowserClient)("https://wjzcutnjnzxylzqysneg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndqemN1dG5qbnp4eWx6cXlzbmVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMjYzMjcsImV4cCI6MjA4NjkwMjMyN30.bku3F43nks_Uq22Ag-viZZpMQfrw43eq3sahNChbBq8")}},64269:(e,s,t)=>{"use strict";t.d(s,{$C:()=>o,SS:()=>c,Sc:()=>i,Yv:()=>n,cn:()=>l,kz:()=>d});var a=t(2821),r=t(75889);function l(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,r.QP)((0,a.$)(s))}function i(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e.toLocaleString("pt-PT",{minimumFractionDigits:s,maximumFractionDigits:s})}function c(e){return e.toLocaleString("pt-PT",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2})}function n(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")}function o(){return Math.random().toString(36).slice(2,9)}function d(e){return new Date(e).toLocaleDateString("pt-PT")}},93014:(e,s,t)=>{"use strict";t.d(s,{ToastProvider:()=>p,d:()=>d});var a=t(95155),r=t(12115),l=t(61362),i=t(78874),c=t(23327),n=t(65229);let o=(0,r.createContext)(null);function d(){let e=(0,r.useContext)(o);if(!e)throw Error("useToast must be used inside <ToastProvider>");return e}let m={success:(0,a.jsx)(l.A,{className:"h-4 w-4 shrink-0",style:{color:"#22c55e"}}),error:(0,a.jsx)(i.A,{className:"h-4 w-4 shrink-0",style:{color:"#ef4444"}}),info:(0,a.jsx)(c.A,{className:"h-4 w-4 shrink-0",style:{color:"var(--accent)"}})},u={success:"rgba(34,197,94,0.3)",error:"rgba(239,68,68,0.3)",info:"rgba(26,143,163,0.3)"};function p(e){let{children:s}=e,[t,l]=(0,r.useState)([]),i=(0,r.useRef)({}),c=(0,r.useCallback)(e=>{l(s=>s.filter(s=>s.id!==e)),i.current[e]&&(clearTimeout(i.current[e]),delete i.current[e])},[]),d=(0,r.useCallback)((e,s)=>{let t=Math.random().toString(36).slice(2);l(a=>[...a.slice(-4),{id:t,type:e,message:s}]),i.current[t]=setTimeout(()=>c(t),3500)},[c]),p=(0,r.useMemo)(()=>({success:e=>d("success",e),error:e=>d("error",e),info:e=>d("info",e)}),[d]);return(0,a.jsxs)(o.Provider,{value:p,children:[s,(0,a.jsx)("div",{"aria-live":"polite",className:"fixed bottom-5 right-4 z-[9999] flex flex-col gap-2 items-end pointer-events-none",style:{maxWidth:"min(380px, calc(100vw - 2rem))"},children:t.map(e=>(0,a.jsxs)("div",{role:"alert",className:"pointer-events-auto flex items-start gap-3 rounded-xl px-4 py-3 text-sm shadow-lg animate-toast-in",style:{background:"var(--surface-3)",border:"1px solid ".concat(u[e.type]),backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",color:"var(--text)",minWidth:"240px"},children:[m[e.type],(0,a.jsx)("p",{className:"flex-1 leading-snug",style:{color:"var(--text)"},children:e.message}),(0,a.jsx)("button",{onClick:()=>c(e.id),className:"shrink-0 mt-0.5 opacity-50 hover:opacity-100 transition-opacity","aria-label":"Fechar",children:(0,a.jsx)(n.A,{className:"h-3.5 w-3.5"})})]},e.id))}),(0,a.jsx)("style",{children:"\n        @keyframes toast-in {\n          from { opacity: 0; transform: translateY(8px) scale(0.96); }\n          to   { opacity: 1; transform: translateY(0) scale(1); }\n        }\n        .animate-toast-in { animation: toast-in 0.18s ease-out forwards; }\n      "})]})}}},e=>{e.O(0,[5417,6028,4909,9219,8441,1255,7358],()=>e(e.s=15709)),_N_E=e.O()}]);