(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4236],{26041:(e,a,t)=>{"use strict";t.d(a,{BU:()=>n,V:()=>r,dx:()=>i,iJ:()=>s,qd:()=>c,vj:()=>l});let l=[{value:"crew",label:"Equipa (Crew)",color:"#1a8fa3"},{value:"equipamento",label:"Equipamento",color:"#8b6b56"},{value:"pos_producao",label:"P\xf3s-Produ\xe7\xe3o",color:"#7c3aed"},{value:"despesas",label:"Despesas",color:"#d97706"},{value:"outro",label:"Outro",color:"#5a6280"}],s=[{value:"continental_23",label:"Continental (23%)",rate:23},{value:"madeira_22",label:"Madeira (22%)",rate:22},{value:"acores_16",label:"A\xe7ores (16%)",rate:16},{value:"isento",label:"Isento / Art. 53.\xba (0%)",rate:0}];function r(e){var a,t;return null!=(t=null==(a=s.find(a=>a.value===e))?void 0:a.rate)?t:23}let n=[{value:"rascunho",label:"Rascunho",badge:"badge-default"},{value:"enviado",label:"Enviado",badge:"badge-accent"},{value:"aprovado",label:"Aprovado",badge:"badge-success"},{value:"cancelado",label:"Cancelado",badge:"badge-error"},{value:"arquivado",label:"Arquivado",badge:"badge-warning"}],c=[{value:"pre_producao",label:"Pr\xe9-Produ\xe7\xe3o",color:"#1a8fa3"},{value:"rodagem",label:"Rodagem",color:"#d97706"},{value:"pos_producao",label:"P\xf3s-Produ\xe7\xe3o",color:"#7c3aed"}],i={iva_regime:"continental_23",overhead_pct:15,contingencia_pct:10,margem_alvo_pct:30,margem_minima_pct:15,investimento_pct:0,moeda:"EUR"}},61833:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>N});var l=t(95155),s=t(12115),r=t(20063),n=t(52619),c=t.n(n),i=t(69434),o=t(26497),d=t(62890),u=t(26041),m=t(64269),p=t(35626),x=t(21190),h=t(59847),v=t(61194),f=t(59e3),g=t(71360),y=t(6191),b=t(5917),j=t(93014);function N(){var e,a,t;let{id:n}=(0,r.useParams)(),N=(0,r.useRouter)(),k=(0,j.d)(),[w,_]=(0,s.useState)(null),[C,A]=(0,s.useState)([]),[S,q]=(0,s.useState)(!0),[E,P]=(0,s.useState)("pre_producao"),[I,z]=(0,s.useState)(!1),[M,D]=(0,s.useState)(""),[U,F]=(0,s.useState)(""),[R,J]=(0,s.useState)(!1),O=(0,s.useRef)(null),T=(0,s.useRef)(null),B=(0,s.useCallback)(async()=>{let e=(0,d.U)(),[{data:a},{data:t}]=await Promise.all([e.from("checklists").select("id, nome, project_id, projects(project_name)").eq("id",n).single(),e.from("checklist_items").select("*").eq("checklist_id",n).order("ordem",{ascending:!0})]);if(!a)return void N.push("/app/checklists");_(a),D(a.nome),A(null!=t?t:[]),q(!1)},[n,N]);(0,s.useEffect)(()=>{B()},[B]),(0,s.useEffect)(()=>{I&&O.current&&O.current.focus()},[I]);let L=async()=>{if(z(!1),!M.trim()||M===(null==w?void 0:w.nome))return;let e=(0,d.U)(),{error:a}=await e.from("checklists").update({nome:M}).eq("id",n);if(a){var t;k.error("Erro ao guardar nome: ".concat(a.message)),D(null!=(t=null==w?void 0:w.nome)?t:"")}else _(e=>e?{...e,nome:M}:e)},Y=async e=>{let a=!e.concluido;if(A(t=>t.map(t=>t.id===e.id?{...t,concluido:a}:t)),!e._local){let t=(0,d.U)();await t.from("checklist_items").update({concluido:a}).eq("id",e.id)}},Z=async()=>{var e;let a=U.trim();if(!a)return;let t=C.filter(e=>e.fase===E),l={id:(0,m.$C)(),checklist_id:n,fase:E,texto:a,concluido:!1,ordem:t.length,created_at:new Date().toISOString(),_local:!0};A(e=>[...e,l]),F(""),null==(e=T.current)||e.focus();let s=(0,d.U)(),{data:r,error:c}=await s.from("checklist_items").insert({checklist_id:n,fase:E,texto:a,concluido:!1,ordem:t.length}).select().single();c?(A(e=>e.filter(e=>e.id!==l.id)),k.error("Erro ao adicionar item: ".concat(c.message))):r&&A(e=>e.map(e=>e.id===l.id?{...r,_local:!1}:e))},V=async(e,a)=>{if(A(a=>a.filter(a=>a.id!==e)),!a){let a=(0,d.U)(),{error:t}=await a.from("checklist_items").delete().eq("id",e);t&&(A(C),k.error("Erro ao apagar item: ".concat(t.message)))}},W=async e=>{J(!0);let a=C.filter(a=>a.fase===e&&!a.concluido);if(0===a.length)return void J(!1);A(a=>a.map(a=>a.fase===e?{...a,concluido:!0}:a));let t=(0,d.U)(),l=a.filter(e=>!e._local).map(e=>e.id);l.length>0&&await t.from("checklist_items").update({concluido:!0}).in("id",l),J(!1)},X=e=>C.filter(a=>a.fase===e),$=0===C.length?0:Math.round(C.filter(e=>e.concluido).length/C.length*100);return S?(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)("div",{className:"page-header",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"skeleton h-8 w-8 rounded-lg"}),(0,l.jsx)("div",{className:"skeleton h-6 w-48"})]})}),(0,l.jsx)("div",{className:"space-y-3",children:Array.from({length:5}).map((e,a)=>(0,l.jsx)("div",{className:"card",children:(0,l.jsx)("div",{className:"skeleton h-4 w-full"})},a))})]}):(0,l.jsxs)("div",{className:"space-y-6 pb-24",children:[(0,l.jsxs)("div",{className:"page-header",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,l.jsx)(c(),{href:"/app/checklists",className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-lg transition-colors",style:{background:"var(--surface-2)"},children:(0,l.jsx)(p.A,{className:"h-4 w-4",style:{color:"var(--text-2)"}})}),I?(0,l.jsx)("input",{ref:O,value:M,onChange:e=>D(e.target.value),onBlur:L,onKeyDown:e=>{if("Enter"===e.key&&L(),"Escape"===e.key){var a;D(null!=(a=null==w?void 0:w.nome)?a:""),z(!1)}},className:"input text-lg font-semibold min-w-0 flex-1",style:{padding:"0.25rem 0.5rem",color:"var(--text)"}}):(0,l.jsxs)("button",{onClick:()=>z(!0),className:"flex items-center gap-2 group min-w-0",children:[(0,l.jsx)("h1",{className:"page-title truncate",style:{margin:0},children:M}),(0,l.jsx)(x.A,{className:"h-3.5 w-3.5 shrink-0 opacity-0 group-hover:opacity-60 transition-opacity",style:{color:"var(--text-3)"}})]})]}),(null==w?void 0:w.projects)&&(0,l.jsxs)(c(),{href:"/app/projects/".concat(w.project_id),className:"badge badge-accent shrink-0 flex items-center gap-1",style:{fontSize:"0.7rem"},children:[(0,l.jsx)(h.A,{className:"h-3 w-3"}),null==(e=w.projects)?void 0:e.project_name]})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsx)("p",{className:"text-sm font-medium",style:{color:"var(--text-2)"},children:"Progresso geral"}),(0,l.jsxs)("span",{className:"text-xl font-bold",style:{color:100===$?"#34d399":"var(--accent-2)"},children:[$,"%"]})]}),(0,l.jsx)("div",{className:"w-full rounded-full overflow-hidden",style:{height:"6px",background:"var(--surface-3)"},children:(0,l.jsx)(i.P.div,{className:"h-full rounded-full",style:{background:100===$?"#34d399":"var(--accent)"},initial:{width:0},animate:{width:"".concat($,"%")},transition:{duration:.5,ease:"easeOut"}})}),(0,l.jsx)("div",{className:"flex gap-4 mt-3",children:u.qd.map(e=>{let a=(e=>{let a=X(e);return 0===a.length?0:Math.round(a.filter(e=>e.concluido).length/a.length*100)})(e.value);return(0,l.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,l.jsx)("div",{className:"h-2 w-2 rounded-full",style:{background:e.color}}),(0,l.jsxs)("span",{className:"text-xs",style:{color:"var(--text-3)"},children:[e.label,": ",(0,l.jsxs)("span",{style:{color:"var(--text-2)"},children:[a,"%"]})]})]},e.value)})})]}),(0,l.jsx)("div",{className:"flex gap-1 rounded-xl p-1",style:{background:"var(--surface-2)"},children:u.qd.map(e=>{let a=X(e.value).length,t=X(e.value).filter(e=>e.concluido).length,s=E===e.value;return(0,l.jsxs)("button",{onClick:()=>P(e.value),className:"flex-1 flex flex-col items-center gap-0.5 rounded-lg py-2 px-1 text-xs font-medium transition-all",style:{background:s?"var(--surface)":"transparent",color:s?e.color:"var(--text-3)",boxShadow:s?"0 1px 4px rgba(0,0,0,0.3)":"none"},children:[(0,l.jsx)("span",{className:"font-semibold hidden sm:block",children:e.label}),(0,l.jsx)("span",{className:"sm:hidden",children:e.label.split(" ")[0]}),(0,l.jsxs)("span",{className:"text-xs opacity-80",style:{color:s?e.color:"var(--text-3)"},children:[t,"/",a]})]},e.value)})}),(0,l.jsxs)("div",{className:"space-y-1.5",children:[(0,l.jsx)(o.N,{mode:"popLayout",children:X(E).map(e=>(0,l.jsxs)(i.P.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:"card flex items-center gap-3 group",style:{padding:"0.75rem 1rem"},children:[(0,l.jsx)("button",{onClick:()=>Y(e),className:"shrink-0 transition-transform active:scale-95","aria-label":e.concluido?"Marcar incompleto":"Marcar conclu\xeddo",children:e.concluido?(0,l.jsx)(v.A,{className:"h-5 w-5",style:{color:"#34d399"}}):(0,l.jsx)(f.A,{className:"h-5 w-5",style:{color:"var(--text-3)"}})}),(0,l.jsx)("span",{className:"flex-1 text-sm",style:{color:e.concluido?"var(--text-3)":"var(--text)",textDecoration:e.concluido?"line-through":"none"},children:e.texto}),(0,l.jsx)("button",{onClick:()=>{var a;return V(e.id,null!=(a=e._local)&&a)},className:"opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded",style:{color:"var(--text-3)"},"aria-label":"Eliminar item",children:(0,l.jsx)(g.A,{className:"h-3.5 w-3.5"})})]},e.id))}),0===X(E).length&&(0,l.jsx)("div",{className:"card",children:(0,l.jsxs)("div",{className:"empty-state",style:{padding:"2rem 1rem"},children:[(0,l.jsx)(v.A,{className:"empty-icon"}),(0,l.jsx)("p",{className:"empty-title",children:"Sem itens"}),(0,l.jsxs)("p",{className:"empty-desc",children:["Adiciona itens para a fase de ",null==(a=u.qd.find(e=>e.value===E))?void 0:a.label]})]})})]}),(0,l.jsxs)("div",{className:"card flex items-center gap-3",style:{padding:"0.75rem 1rem"},children:[(0,l.jsx)("div",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-lg",style:{background:"var(--surface-2)"},children:(0,l.jsx)(y.A,{className:"h-4 w-4",style:{color:"var(--text-3)"}})}),(0,l.jsx)("input",{ref:T,type:"text",placeholder:"Novo item em ".concat(null==(t=u.qd.find(e=>e.value===E))?void 0:t.label,"â€¦"),value:U,onChange:e=>F(e.target.value),onKeyDown:e=>{"Enter"===e.key&&Z()},className:"flex-1 bg-transparent text-sm outline-none placeholder:text-[var(--text-3)]",style:{color:"var(--text)",border:"none"}}),U&&(0,l.jsxs)("button",{onClick:Z,className:"btn btn-primary btn-sm shrink-0",children:[(0,l.jsx)(b.A,{className:"h-3.5 w-3.5"}),"Adicionar"]})]}),X(E).some(e=>!e.concluido)&&(0,l.jsx)(i.P.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},children:(0,l.jsxs)("button",{onClick:()=>W(E),disabled:R,className:"btn btn-secondary w-full",children:[(0,l.jsx)(b.A,{className:"h-4 w-4"}),"Concluir todos os itens desta fase"]})})]})}},62890:(e,a,t)=>{"use strict";t.d(a,{U:()=>s});var l=t(55417);function s(){return(0,l.createBrowserClient)("https://wjzcutnjnzxylzqysneg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndqemN1dG5qbnp4eWx6cXlzbmVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMjYzMjcsImV4cCI6MjA4NjkwMjMyN30.bku3F43nks_Uq22Ag-viZZpMQfrw43eq3sahNChbBq8")}},64269:(e,a,t)=>{"use strict";t.d(a,{$C:()=>o,SS:()=>c,Sc:()=>n,Yv:()=>i,cn:()=>r,kz:()=>d});var l=t(2821),s=t(75889);function r(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,s.QP)((0,l.$)(a))}function n(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e.toLocaleString("pt-PT",{minimumFractionDigits:a,maximumFractionDigits:a})}function c(e){return e.toLocaleString("pt-PT",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2})}function i(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")}function o(){return Math.random().toString(36).slice(2,9)}function d(e){return new Date(e).toLocaleDateString("pt-PT")}},86855:(e,a,t)=>{Promise.resolve().then(t.bind(t,61833))},93014:(e,a,t)=>{"use strict";t.d(a,{ToastProvider:()=>p,d:()=>d});var l=t(95155),s=t(12115),r=t(61362),n=t(78874),c=t(23327),i=t(65229);let o=(0,s.createContext)(null);function d(){let e=(0,s.useContext)(o);if(!e)throw Error("useToast must be used inside <ToastProvider>");return e}let u={success:(0,l.jsx)(r.A,{className:"h-4 w-4 shrink-0",style:{color:"#22c55e"}}),error:(0,l.jsx)(n.A,{className:"h-4 w-4 shrink-0",style:{color:"#ef4444"}}),info:(0,l.jsx)(c.A,{className:"h-4 w-4 shrink-0",style:{color:"var(--accent)"}})},m={success:"rgba(34,197,94,0.3)",error:"rgba(239,68,68,0.3)",info:"rgba(26,143,163,0.3)"};function p(e){let{children:a}=e,[t,r]=(0,s.useState)([]),n=(0,s.useRef)({}),c=(0,s.useCallback)(e=>{r(a=>a.filter(a=>a.id!==e)),n.current[e]&&(clearTimeout(n.current[e]),delete n.current[e])},[]),d=(0,s.useCallback)((e,a)=>{let t=Math.random().toString(36).slice(2);r(l=>[...l.slice(-4),{id:t,type:e,message:a}]),n.current[t]=setTimeout(()=>c(t),3500)},[c]),p=(0,s.useMemo)(()=>({success:e=>d("success",e),error:e=>d("error",e),info:e=>d("info",e)}),[d]);return(0,l.jsxs)(o.Provider,{value:p,children:[a,(0,l.jsx)("div",{"aria-live":"polite",className:"fixed bottom-5 right-4 z-[9999] flex flex-col gap-2 items-end pointer-events-none",style:{maxWidth:"min(380px, calc(100vw - 2rem))"},children:t.map(e=>(0,l.jsxs)("div",{role:"alert",className:"pointer-events-auto flex items-start gap-3 rounded-xl px-4 py-3 text-sm shadow-lg animate-toast-in",style:{background:"var(--surface-3)",border:"1px solid ".concat(m[e.type]),backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",color:"var(--text)",minWidth:"240px"},children:[u[e.type],(0,l.jsx)("p",{className:"flex-1 leading-snug",style:{color:"var(--text)"},children:e.message}),(0,l.jsx)("button",{onClick:()=>c(e.id),className:"shrink-0 mt-0.5 opacity-50 hover:opacity-100 transition-opacity","aria-label":"Fechar",children:(0,l.jsx)(i.A,{className:"h-3.5 w-3.5"})})]},e.id))}),(0,l.jsx)("style",{children:"\n        @keyframes toast-in {\n          from { opacity: 0; transform: translateY(8px) scale(0.96); }\n          to   { opacity: 1; transform: translateY(0) scale(1); }\n        }\n        .animate-toast-in { animation: toast-in 0.18s ease-out forwards; }\n      "})]})}}},e=>{e.O(0,[5417,6028,4909,2619,7579,8441,1255,7358],()=>e(e.s=86855)),_N_E=e.O()}]);