(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8253],{6026:(e,a,t)=>{"use strict";t.d(a,{AppShell:()=>H});var s=t(95155),l=t(52619),r=t.n(l),i=t(20063),n=t(62890),o=t(41407),c=t(69434),d=t(59384),h=t(80647),p=t(19408),x=t(37586),m=t(1524),u=t(15870),f=t(61194),b=t(89715),j=t(47937),v=t(80298),g=t(52020),w=t(87066),N=t(50906),y=t(10383),k=t(56154),A=t(59427),C=t(37494),_=t(84926),P=t(12115),S=t(26617),T=t(39347),E=t(6132),M=t(69152),I=t(85998),D=t(65229);let O={new_message:x.A,new_deliverable:S.A,approval_requested:T.A,request_created:E.A,milestone_reached:M.A};function R(){let[e,a]=(0,P.useState)(!1),[t,l]=(0,P.useState)([]),[i,o]=(0,P.useState)(0),c=(0,P.useRef)(null),d=(0,P.useMemo)(()=>(0,n.U)(),[]),h=(0,P.useCallback)(async()=>{let e=await fetch("/api/notifications?limit=20");if(!e.ok)return;let a=await e.json();l(a),o(a.filter(e=>!e.read_at).length)},[]);(0,P.useEffect)(()=>{h()},[h]),(0,P.useEffect)(()=>{let e=null;return d.auth.getUser().then(a=>{let{data:{user:t}}=a;t&&(e=d.channel("notifications-bell").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:"user_id=eq.".concat(t.id)},()=>void h()).subscribe())}),()=>{e&&d.removeChannel(e)}},[h,d]),(0,P.useEffect)(()=>{if(!e)return;let t=e=>{c.current&&!c.current.contains(e.target)&&a(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[e]);let p=async()=>{await fetch("/api/notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"markAllRead"})}),h()},x=async e=>{await fetch("/api/notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"markRead",id:e})}),h()};return(0,s.jsxs)("div",{className:"relative",ref:c,children:[(0,s.jsxs)("button",{onClick:()=>a(e=>!e),className:"relative p-2 rounded-xl hover:bg-white/10 transition-colors","aria-label":"Notifica\xe7\xf5es",children:[(0,s.jsx)(I.A,{className:"w-5 h-5 text-white/70"}),i>0&&(0,s.jsx)("span",{className:"absolute top-1 right-1 min-w-[16px] h-4 px-0.5 bg-rose-500 rounded-full text-[10px] font-bold text-white flex items-center justify-center",children:i>9?"9+":i})]}),e&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-80 max-h-[480px] rounded-2xl bg-gray-900 border border-white/10 shadow-2xl overflow-hidden flex flex-col z-50",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/8",children:[(0,s.jsx)("span",{className:"text-sm font-semibold text-white",children:"Notifica\xe7\xf5es"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[i>0&&(0,s.jsx)("button",{onClick:p,className:"text-xs text-white/40 hover:text-white/70 transition-colors",children:"Ler tudo"}),(0,s.jsx)("button",{onClick:()=>a(!1),className:"text-white/40 hover:text-white",children:(0,s.jsx)(D.A,{className:"w-4 h-4"})})]})]}),(0,s.jsx)("div",{className:"overflow-y-auto flex-1",children:0===t.length?(0,s.jsxs)("div",{className:"text-center py-10 text-white/30",children:[(0,s.jsx)(I.A,{className:"w-6 h-6 mx-auto mb-2 opacity-40"}),(0,s.jsx)("p",{className:"text-xs",children:"Sem notifica\xe7\xf5es"})]}):t.map(e=>{var t;let l=null!=(t=O[e.type])?t:I.A,i=!e.read_at,n=(0,s.jsxs)("div",{onClick:()=>i&&x(e.id),className:"flex gap-3 px-4 py-3 hover:bg-white/5 transition-colors cursor-pointer border-b border-white/5 last:border-0 ".concat(i?"bg-blue-500/5":""),children:[(0,s.jsx)("div",{className:"shrink-0 w-8 h-8 rounded-xl flex items-center justify-center ".concat(i?"bg-blue-500/20":"bg-white/8"),children:(0,s.jsx)(l,{className:"w-4 h-4 ".concat(i?"text-blue-400":"text-white/40")})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-xs font-medium line-clamp-1 ".concat(i?"text-white":"text-white/60"),children:e.title}),e.body&&(0,s.jsx)("p",{className:"text-xs text-white/40 line-clamp-2 mt-0.5",children:e.body})]}),(0,s.jsx)("span",{className:"text-[10px] text-white/30 shrink-0 mt-0.5",children:function(e){let a=new Date(e),t=Math.floor((Date.now()-a.getTime())/6e4);if(t<1)return"agora";if(t<60)return"".concat(t,"m");let s=Math.floor(t/60);return s<24?"".concat(s,"h"):a.toLocaleDateString("pt-PT",{day:"2-digit",month:"short"})}(e.created_at)})]});return e.link_url?(0,s.jsx)(r(),{href:e.link_url,onClick:()=>{x(e.id),a(!1)},children:n},e.id):(0,s.jsx)("div",{children:n},e.id)})})]})]})}var q=t(63479),z=t(34416),U=t(4874);let W=[{href:"/app/dashboard",label:"Dashboard",icon:d.A},{href:"/app/projects",label:"Projects",icon:h.A},{href:"/app/clients",label:"Clients",icon:p.A},{href:"/app/inbox",label:"Inbox",icon:x.A},{href:"/app/insights",label:"Insights",icon:m.A},{href:"/app/settings",label:"Settings",icon:u.A}],L=[{href:"/app/checklists",label:"Checklists",icon:f.A},{href:"/app/templates",label:"Templates",icon:b.A},{href:"/app/journal",label:"Journal",icon:j.A},{href:"/app/tasks",label:"Tasks",icon:v.A},{href:"/app/crm",label:"CRM",icon:g.A},{href:"/app/callsheets",label:"Call Sheets",icon:w.A},{href:"/app/diagnostics",label:"Diagnostics",icon:N.A}],Y=[{href:"/app/tasks",label:"My Tasks",icon:v.A},{href:"/app/callsheets",label:"Calendar",icon:y.A},{href:"/app/inbox",label:"Inbox",icon:x.A}],B=[{href:"/app/dashboard",label:"Dash",icon:d.A},{href:"/app/projects",label:"Projects",icon:h.A},{href:"/app/clients",label:"Clients",icon:p.A},{href:"/app/inbox",label:"Inbox",icon:x.A},{href:"/app/settings",label:"Settings",icon:u.A}];function F(e,a){return("/app/preferences"===e&&(e="/app/settings"),"/app/dashboard"===a)?"/app"===e||"/app/dashboard"===e:e===a||e.startsWith("".concat(a,"/"))}function H(e){var a;let{children:t,userEmail:l}=e,d=(0,i.usePathname)(),h=(0,i.useRouter)(),[p,x]=(0,P.useState)(!1),{theme:m,toggleTheme:u,dashboardMode:f}=(0,q.D)(),b=(0,o.I)(),j=(0,P.useMemo)(()=>(function(e){var a;let t=W.find(a=>F(e,a.href));return null!=(a=null==t?void 0:t.href)?a:"/app/dashboard"})(d),[d]),v=async()=>{x(!0);let e=(0,n.U)();await e.auth.signOut(),h.push("/login"),h.refresh()},g=(null!=(a=null==l?void 0:l[0])?a:"U").toUpperCase();return(0,s.jsxs)("div",{className:"super-theme super-shell-bg h-dvh min-h-dvh overflow-x-clip",style:{padding:"clamp(16px, 2.5vw, 40px)"},children:[(0,s.jsxs)(z.AC,{className:"mx-auto flex h-full min-h-full w-full max-w-[1440px] flex-col overflow-x-clip",children:[(0,s.jsxs)("header",{className:"super-topbar",children:[(0,s.jsxs)(r(),{href:"/app/dashboard",className:"inline-flex items-center gap-2.5",children:[(0,s.jsx)("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full",style:{background:"var(--accent-blue)",color:"#fff"},children:(0,s.jsx)(k.A,{className:"h-4 w-4"})}),(0,s.jsx)("span",{className:"text-sm font-semibold tracking-tight",style:{color:"var(--text)"},children:"Beyond Pricing"})]}),(0,s.jsx)("div",{className:"hidden min-w-0 flex-1 justify-center px-5 md:flex",children:(0,s.jsx)(z.EE,{tabs:W.map(e=>({href:e.href,label:e.label})),active:j})}),(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)(R,{}),(0,s.jsx)(c.P.button,{onClick:u,className:"icon-btn",title:"dark"===m?"Modo claro":"Modo escuro","aria-label":"dark"===m?"Modo claro":"Modo escuro",...(0,U.HY)({enabled:!b}),children:"dark"===m?(0,s.jsx)(A.A,{className:"h-4 w-4"}):(0,s.jsx)(C.A,{className:"h-4 w-4"})}),(0,s.jsx)(c.P.button,{onClick:v,disabled:p,className:"icon-btn",title:"Terminar sess\xe3o","aria-label":"Terminar sess\xe3o",...(0,U.HY)({enabled:!b}),children:(0,s.jsx)(_.A,{className:"h-4 w-4"})}),(0,s.jsx)("span",{className:"hidden h-8 w-8 items-center justify-center rounded-full text-xs font-semibold md:inline-flex",style:{background:"rgba(26, 143, 163, 0.14)",border:"1px solid rgba(26, 143, 163, 0.32)",color:"var(--accent-blue)"},title:l,children:g})]})]}),(0,s.jsx)("div",{className:"border-b px-3 py-2 md:hidden",style:{borderColor:"var(--border)"},children:(0,s.jsx)(z.EE,{tabs:W.map(e=>({href:e.href,label:e.label})),active:j})}),(0,s.jsx)("main",{className:"min-h-0 flex-1 overflow-y-auto px-4 pb-24 pt-5 md:px-7 md:pb-7 md:pt-6",children:(0,s.jsxs)(c.P.div,{initial:!b&&"initial",animate:b?void 0:"animate",variants:U.HI.page,transition:U.bm.page,className:"mx-auto w-full app-main-grid",children:[(0,s.jsx)("aside",{className:"quick-rail hidden xl:flex",children:("ceo"===f?Y:L).map(e=>{var a;let t="/app/dashboard"===(a=e.href)?"/app"===d||"/app/dashboard"===d:d===a||d.startsWith("".concat(a,"/"));return(0,s.jsxs)(r(),{href:e.href,className:"quick-rail__link ".concat(t?"quick-rail__link--active":""),children:[(0,s.jsx)(e.icon,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:e.label})]},e.href)})}),(0,s.jsx)("section",{className:"min-w-0",children:t})]})})]}),(0,s.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 z-40 border-t backdrop-blur-md md:hidden",style:{borderColor:"var(--border)",background:"color-mix(in srgb, var(--surface) 88%, transparent)",paddingBottom:"env(safe-area-inset-bottom)"},children:(0,s.jsx)("div",{className:"mx-auto flex max-w-[1380px] items-stretch justify-around px-1 py-1.5",children:B.map(e=>{let a=F(d,e.href);return(0,s.jsxs)(r(),{href:e.href,className:"relative flex min-w-0 flex-1 flex-col items-center justify-center gap-0.5 rounded-2xl py-1",style:{color:a?"#1a8fa3":"#7d889d"},children:[a?(0,s.jsx)(c.P.span,{layoutId:"mobile-nav-pill",className:"absolute inset-0 rounded-2xl",style:{background:"rgba(26, 143, 163, 0.12)",border:"1px solid rgba(26, 143, 163, 0.26)"},transition:{type:"spring",stiffness:420,damping:34}}):null,(0,s.jsx)(e.icon,{className:"relative z-10 h-4 w-4"}),(0,s.jsx)("span",{className:"relative z-10 text-[0.63rem] font-semibold",children:e.label})]},e.href)})})})]})}},79498:(e,a,t)=>{Promise.resolve().then(t.bind(t,6026)),Promise.resolve().then(t.bind(t,63479)),Promise.resolve().then(t.bind(t,93014))},93014:(e,a,t)=>{"use strict";t.d(a,{ToastProvider:()=>x,d:()=>d});var s=t(95155),l=t(12115),r=t(61362),i=t(78874),n=t(23327),o=t(65229);let c=(0,l.createContext)(null);function d(){let e=(0,l.useContext)(c);if(!e)throw Error("useToast must be used inside <ToastProvider>");return e}let h={success:(0,s.jsx)(r.A,{className:"h-4 w-4 shrink-0",style:{color:"#22c55e"}}),error:(0,s.jsx)(i.A,{className:"h-4 w-4 shrink-0",style:{color:"#ef4444"}}),info:(0,s.jsx)(n.A,{className:"h-4 w-4 shrink-0",style:{color:"var(--accent)"}})},p={success:"rgba(34,197,94,0.3)",error:"rgba(239,68,68,0.3)",info:"rgba(26,143,163,0.3)"};function x(e){let{children:a}=e,[t,r]=(0,l.useState)([]),i=(0,l.useRef)({}),n=(0,l.useCallback)(e=>{r(a=>a.filter(a=>a.id!==e)),i.current[e]&&(clearTimeout(i.current[e]),delete i.current[e])},[]),d=(0,l.useCallback)((e,a)=>{let t=Math.random().toString(36).slice(2);r(s=>[...s.slice(-4),{id:t,type:e,message:a}]),i.current[t]=setTimeout(()=>n(t),3500)},[n]),x=(0,l.useMemo)(()=>({success:e=>d("success",e),error:e=>d("error",e),info:e=>d("info",e)}),[d]);return(0,s.jsxs)(c.Provider,{value:x,children:[a,(0,s.jsx)("div",{"aria-live":"polite",className:"fixed bottom-5 right-4 z-[9999] flex flex-col gap-2 items-end pointer-events-none",style:{maxWidth:"min(380px, calc(100vw - 2rem))"},children:t.map(e=>(0,s.jsxs)("div",{role:"alert",className:"pointer-events-auto flex items-start gap-3 rounded-xl px-4 py-3 text-sm shadow-lg animate-toast-in",style:{background:"var(--surface-3)",border:"1px solid ".concat(p[e.type]),backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",color:"var(--text)",minWidth:"240px"},children:[h[e.type],(0,s.jsx)("p",{className:"flex-1 leading-snug",style:{color:"var(--text)"},children:e.message}),(0,s.jsx)("button",{onClick:()=>n(e.id),className:"shrink-0 mt-0.5 opacity-50 hover:opacity-100 transition-opacity","aria-label":"Fechar",children:(0,s.jsx)(o.A,{className:"h-3.5 w-3.5"})})]},e.id))}),(0,s.jsx)("style",{children:"\n        @keyframes toast-in {\n          from { opacity: 0; transform: translateY(8px) scale(0.96); }\n          to   { opacity: 1; transform: translateY(0) scale(1); }\n        }\n        .animate-toast-in { animation: toast-in 0.18s ease-out forwards; }\n      "})]})}}},e=>{e.O(0,[5417,6028,4909,2619,1163,6912,9939,6394,1082,9922,8441,1255,7358],()=>e(e.s=79498)),_N_E=e.O()}]);