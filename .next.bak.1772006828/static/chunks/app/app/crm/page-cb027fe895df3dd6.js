(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1097],{6191:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},19408:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},20508:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},23664:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},35299:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},39867:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},52999:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>v});var s=t(95155),l=t(12115),r=t(35299);let n=(0,t(71847).A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var c=t(39867),i=t(6191),o=t(65229),d=t(86651),m=t(19408),p=t(23664),x=t(69141),u=t(20508);let h=[{id:"lead",label:"Lead",bg:"var(--surface-2)",border:"var(--border)",text:"var(--text-2)"},{id:"qualified",label:"Qualificado",bg:"var(--pastel-blue)",border:"var(--pastel-blue-border)",text:"var(--pastel-blue-text)"},{id:"proposal",label:"Proposta",bg:"var(--pastel-amber)",border:"var(--pastel-amber-border)",text:"var(--pastel-amber-text)"},{id:"negotiation",label:"Negocia\xe7\xe3o",bg:"var(--pastel-purple)",border:"var(--pastel-purple-border)",text:"var(--pastel-purple-text)"},{id:"won",label:"Ganho ✓",bg:"var(--pastel-green)",border:"var(--pastel-green-border)",text:"var(--pastel-green-text)"},{id:"lost",label:"Perdido",bg:"var(--pastel-rose)",border:"var(--pastel-rose-border)",text:"var(--pastel-rose-text)"}];function v(){let[e,a]=(0,l.useState)("contacts"),[t,v]=(0,l.useState)([]),[b,y]=(0,l.useState)([]),[g,j]=(0,l.useState)(!0),[N,f]=(0,l.useState)(null),[k,w]=(0,l.useState)(""),[C,A]=(0,l.useState)(!1),[L,S]=(0,l.useState)(!1),[M,T]=(0,l.useState)({name:"",email:"",phone:"",company:"",role:""}),[E,P]=(0,l.useState)({title:"",stage:"lead",value:"",probability:"50",notes:""}),[O,q]=(0,l.useState)(!1),[R,U]=(0,l.useState)(!1),_=(0,l.useCallback)(async()=>{var e,a;f(null);let t=await fetch("/api/crm?limit=200");t.ok?v(null!=(e=(await t.json()).contacts)?e:[]):f(null!=(a=(await t.json().catch(()=>({}))).error)?a:"Erro ao carregar contactos")},[]),H=(0,l.useCallback)(async()=>{let e=await fetch("/api/crm/deals");if(e.ok){let a=await e.json();y(null!=a?a:[])}else{var a;f(null!=(a=(await e.json().catch(()=>({}))).error)?a:"Erro ao carregar deals")}},[]);(0,l.useEffect)(()=>{(async()=>{await Promise.all([_(),H()]),j(!1)})()},[_,H]);let z=async()=>{M.name.trim()&&!O&&(q(!0),await fetch("/api/crm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(M)}),q(!1),A(!1),T({name:"",email:"",phone:"",company:"",role:""}),_())},B=async()=>{E.title.trim()&&!O&&(q(!0),await fetch("/api/crm/deals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...E,value:parseFloat(E.value)||0,probability:parseInt(E.probability)||50})}),q(!1),S(!1),P({title:"",stage:"lead",value:"",probability:"50",notes:""}),H())},D=async(e,a)=>{y(t=>t.map(t=>t.id===e?{...t,stage:a}:t)),await fetch("/api/crm/deals",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,stage:a})})},F=async e=>{var a,t,s;let l=null==(a=e.target.files)?void 0:a[0];if(!l)return;U(!0);let r=(await l.text()).split("\n").filter(Boolean),n=null!=(s=null==(t=r[0])?void 0:t.toLowerCase().split(",").map(e=>e.trim()))?s:[],c=r.slice(1).map(e=>{let a=e.split(",");return Object.fromEntries(n.map((e,t)=>{var s,l;return[e,null!=(l=null==(s=a[t])?void 0:s.trim())?l:""]}))});c.length>0&&await fetch("/api/crm/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contacts:c})}),U(!1),_(),e.target.value=""},J=t.filter(e=>{var a,t;return!k||e.name.toLowerCase().includes(k.toLowerCase())||(null!=(a=e.email)?a:"").toLowerCase().includes(k.toLowerCase())||(null!=(t=e.company)?t:"").toLowerCase().includes(k.toLowerCase())}),G=b.filter(e=>!["won","lost"].includes(e.stage)).reduce((e,a)=>{var t;return e+(null!=(t=a.value)?t:0)},0),I=b.filter(e=>"won"===e.stage).reduce((e,a)=>{var t;return e+(null!=(t=a.value)?t:0)},0);return g?(0,s.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,s.jsx)(r.A,{className:"w-6 h-6 animate-spin",style:{color:"var(--text-3)"}})}):N?(0,s.jsxs)("div",{className:"card text-center space-y-3",children:[(0,s.jsx)("p",{style:{color:"var(--text-2)"},children:N}),(0,s.jsx)("button",{className:"btn btn-secondary btn-sm",onClick:async()=>{j(!0),await Promise.all([_(),H()]),j(!1)},children:"Tentar novamente"})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"page-title",children:"CRM"}),(0,s.jsxs)("p",{className:"page-subtitle",children:[t.length," contactos \xb7 ",b.length," deals"]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:["contacts"===e&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("label",{className:"btn btn-secondary btn-sm cursor-pointer",children:[R?(0,s.jsx)(r.A,{className:"w-4 h-4 animate-spin"}):(0,s.jsx)(n,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Importar"}),(0,s.jsx)("input",{type:"file",accept:".csv",className:"hidden",onChange:F})]}),(0,s.jsxs)("button",{onClick:()=>{let e=new Blob([[["Nome","Email","Telefone","Empresa","Fun\xe7\xe3o"],...t.map(e=>{var a,t,s,l;return[e.name,null!=(a=e.email)?a:"",null!=(t=e.phone)?t:"",null!=(s=e.company)?s:"",null!=(l=e.role)?l:""]})].map(e=>e.join(",")).join("\n")],{type:"text/csv"}),a=URL.createObjectURL(e),s=document.createElement("a");s.href=a,s.download="crm_contacts.csv",s.click(),URL.revokeObjectURL(a)},className:"btn btn-secondary btn-sm",children:[(0,s.jsx)(c.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Exportar"})]}),(0,s.jsxs)("button",{onClick:()=>A(e=>!e),className:"btn btn-primary btn-sm",children:[(0,s.jsx)(i.A,{className:"w-4 h-4"})," Contacto"]})]}),"pipeline"===e&&(0,s.jsxs)("button",{onClick:()=>S(e=>!e),className:"btn btn-primary btn-sm",children:[(0,s.jsx)(i.A,{className:"w-4 h-4"})," Deal"]})]})]}),(0,s.jsx)("div",{className:"tabs-list",children:["contacts","pipeline"].map(t=>(0,s.jsx)("button",{onClick:()=>a(t),className:"tab-trigger ".concat(e===t?"active":""),children:"contacts"===t?"Contactos":"Pipeline"},t))}),"contacts"===e&&(0,s.jsxs)("div",{className:"space-y-4",children:[C&&(0,s.jsxs)("div",{className:"card space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:"Novo Contacto"}),(0,s.jsx)("button",{onClick:()=>A(!1),className:"btn btn-ghost btn-icon-sm",children:(0,s.jsx)(o.A,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,s.jsx)("input",{value:M.name,onChange:e=>T(a=>({...a,name:e.target.value})),placeholder:"Nome *",className:"input col-span-full md:col-span-1"}),(0,s.jsx)("input",{value:M.email,onChange:e=>T(a=>({...a,email:e.target.value})),placeholder:"Email",type:"email",className:"input"}),(0,s.jsx)("input",{value:M.phone,onChange:e=>T(a=>({...a,phone:e.target.value})),placeholder:"Telefone",className:"input"}),(0,s.jsx)("input",{value:M.company,onChange:e=>T(a=>({...a,company:e.target.value})),placeholder:"Empresa",className:"input"}),(0,s.jsx)("input",{value:M.role,onChange:e=>T(a=>({...a,role:e.target.value})),placeholder:"Fun\xe7\xe3o",className:"input col-span-full md:col-span-1"})]}),(0,s.jsx)("button",{onClick:z,disabled:O||!M.name.trim(),className:"btn btn-primary btn-sm",children:O?"A guardar…":"Guardar"})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(d.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4",style:{color:"var(--text-3)"}}),(0,s.jsx)("input",{value:k,onChange:e=>w(e.target.value),placeholder:"Pesquisar contactos…",className:"input",style:{paddingLeft:"2.25rem"}})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[J.map(e=>{var a,t,l;return(0,s.jsxs)("div",{className:"card card-hover",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold shrink-0",style:{background:"var(--accent-dim)",color:"var(--accent-2)"},children:e.name.charAt(0).toUpperCase()}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium text-sm",style:{color:"var(--text)"},children:e.name}),e.company&&(0,s.jsxs)("p",{className:"text-xs mt-0.5 flex items-center gap-1",style:{color:"var(--text-3)"},children:[(0,s.jsx)(m.A,{className:"w-3 h-3"}),e.company]}),e.role&&(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:e.role})]})]}),(0,s.jsxs)("div",{className:"mt-3 space-y-1",children:[e.email&&(0,s.jsxs)("a",{href:"mailto:".concat(e.email),className:"flex items-center gap-2 text-xs transition-colors",style:{color:"var(--text-3)"},onMouseEnter:e=>e.currentTarget.style.color="var(--text)",onMouseLeave:e=>e.currentTarget.style.color="var(--text-3)",children:[(0,s.jsx)(p.A,{className:"w-3 h-3"}),e.email]}),e.phone&&(0,s.jsxs)("a",{href:"tel:".concat(e.phone),className:"flex items-center gap-2 text-xs transition-colors",style:{color:"var(--text-3)"},onMouseEnter:e=>e.currentTarget.style.color="var(--text)",onMouseLeave:e=>e.currentTarget.style.color="var(--text-3)",children:[(0,s.jsx)(x.A,{className:"w-3 h-3"}),e.phone]})]}),(null!=(l=null==(a=e.tags)?void 0:a.length)?l:0)>0&&(0,s.jsx)("div",{className:"flex gap-1 mt-2 flex-wrap",children:null==(t=e.tags)?void 0:t.map(e=>(0,s.jsx)("span",{className:"badge badge-default text-[10px]",children:e},e))})]},e.id)}),0===J.length&&(0,s.jsxs)("div",{className:"col-span-full empty-state",children:[(0,s.jsx)(u.A,{className:"empty-icon"}),(0,s.jsx)("p",{className:"empty-title",children:k?"Sem resultados":"Nenhum contacto ainda."})]})]})]}),"pipeline"===e&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,s.jsxs)("div",{className:"card-pastel-blue",children:[(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--pastel-blue-text)",opacity:.7},children:"Pipeline"}),(0,s.jsxs)("p",{className:"text-xl font-bold mt-1",style:{color:"var(--pastel-blue-text)"},children:["€",G.toLocaleString("pt-PT")]})]}),(0,s.jsxs)("div",{className:"card-pastel-green",children:[(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--pastel-green-text)",opacity:.7},children:"Ganho"}),(0,s.jsxs)("p",{className:"text-xl font-bold mt-1",style:{color:"var(--pastel-green-text)"},children:["€",I.toLocaleString("pt-PT")]})]}),(0,s.jsxs)("div",{className:"card-pastel-amber",children:[(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--pastel-amber-text)",opacity:.7},children:"Deals ativos"}),(0,s.jsx)("p",{className:"text-xl font-bold mt-1",style:{color:"var(--pastel-amber-text)"},children:b.filter(e=>!["won","lost"].includes(e.stage)).length})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:"Total deals"}),(0,s.jsx)("p",{className:"text-xl font-bold mt-1",style:{color:"var(--text)"},children:b.length})]})]}),L&&(0,s.jsxs)("div",{className:"card space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:"Novo Deal"}),(0,s.jsx)("button",{onClick:()=>S(!1),className:"btn btn-ghost btn-icon-sm",children:(0,s.jsx)(o.A,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,s.jsx)("input",{value:E.title,onChange:e=>P(a=>({...a,title:e.target.value})),placeholder:"T\xedtulo *",className:"input col-span-full"}),(0,s.jsx)("select",{value:E.stage,onChange:e=>P(a=>({...a,stage:e.target.value})),className:"input",children:h.map(e=>(0,s.jsx)("option",{value:e.id,children:e.label},e.id))}),(0,s.jsx)("input",{value:E.value,onChange:e=>P(a=>({...a,value:e.target.value})),placeholder:"Valor (€)",type:"number",className:"input"}),(0,s.jsx)("input",{value:E.probability,onChange:e=>P(a=>({...a,probability:e.target.value})),placeholder:"Probabilidade %",type:"number",min:"0",max:"100",className:"input"}),(0,s.jsx)("textarea",{value:E.notes,onChange:e=>P(a=>({...a,notes:e.target.value})),placeholder:"Notas",rows:2,className:"input col-span-full"})]}),(0,s.jsx)("button",{onClick:B,disabled:O||!E.title.trim(),className:"btn btn-primary btn-sm",children:O?"A guardar…":"Criar deal"})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:h.map(e=>{let a=b.filter(a=>a.stage===e.id),t=a.reduce((e,a)=>{var t;return e+(null!=(t=a.value)?t:0)},0);return(0,s.jsxs)("div",{style:{background:e.bg,border:"1px solid ".concat(e.border),borderRadius:"var(--r-xl)",padding:"0.75rem",minHeight:"12rem"},children:[(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("p",{className:"text-xs font-semibold",style:{color:e.text},children:e.label}),(0,s.jsxs)("p",{className:"text-xs mt-0.5",style:{color:e.text,opacity:.6},children:["€",t.toLocaleString("pt-PT")," \xb7 ",a.length]})]}),(0,s.jsx)("div",{className:"space-y-2",children:a.map(a=>(0,s.jsxs)("div",{className:"rounded-xl p-2.5",style:{background:"var(--surface)",border:"1px solid var(--border)"},children:[(0,s.jsx)("p",{className:"text-xs font-medium line-clamp-2",style:{color:"var(--text)"},children:a.title}),a.value>0&&(0,s.jsxs)("p",{className:"text-xs mt-1",style:{color:"var(--text-3)"},children:["€",a.value.toLocaleString("pt-PT")]}),a.contact&&(0,s.jsx)("p",{className:"text-[10px] mt-0.5",style:{color:"var(--text-3)"},children:a.contact.name}),(0,s.jsx)("div",{className:"flex gap-1 mt-2 flex-wrap",children:h.filter(a=>a.id!==e.id).slice(0,2).map(e=>(0,s.jsx)("button",{onClick:()=>D(a.id,e.id),className:"text-[10px] px-1.5 py-0.5 rounded-md transition-colors",style:{background:"var(--surface-2)",color:"var(--text-3)",border:"1px solid var(--border)"},onMouseEnter:e=>e.currentTarget.style.color="var(--text)",onMouseLeave:e=>e.currentTarget.style.color="var(--text-3)",children:e.label},e.id))})]},a.id))})]},e.id)})})]})]})}},60572:(e,a,t)=>{Promise.resolve().then(t.bind(t,52999))},65229:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},69141:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},71847:(e,a,t)=>{"use strict";t.d(a,{A:()=>c});var s=t(12115);let l=function(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return a.filter((e,a,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===a).join(" ").trim()};var r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,s.forwardRef)((e,a)=>{let{color:t="currentColor",size:n=24,strokeWidth:c=2,absoluteStrokeWidth:i,className:o="",children:d,iconNode:m,...p}=e;return(0,s.createElement)("svg",{ref:a,...r,width:n,height:n,stroke:t,strokeWidth:i?24*Number(c)/Number(n):c,className:l("lucide",o),...p},[...m.map(e=>{let[a,t]=e;return(0,s.createElement)(a,t)}),...Array.isArray(d)?d:[d]])}),c=(e,a)=>{let t=(0,s.forwardRef)((t,r)=>{let{className:c,...i}=t;return(0,s.createElement)(n,{ref:r,iconNode:a,className:l("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),c),...i})});return t.displayName="".concat(e),t}},86651:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(71847).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=60572)),_N_E=e.O()}]);