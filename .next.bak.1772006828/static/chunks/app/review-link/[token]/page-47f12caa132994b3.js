(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4832],{6132:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(71847).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},18085:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(71847).A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},20063:(e,r,s)=>{"use strict";var t=s(47260);s.o(t,"useParams")&&s.d(r,{useParams:function(){return t.useParams}}),s.o(t,"usePathname")&&s.d(r,{usePathname:function(){return t.usePathname}}),s.o(t,"useRouter")&&s.d(r,{useRouter:function(){return t.useRouter}}),s.o(t,"useSearchParams")&&s.d(r,{useSearchParams:function(){return t.useSearchParams}})},35299:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(71847).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},37586:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(71847).A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},61362:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(71847).A)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},67117:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>h});var t=s(95155),a=s(12115),l=s(20063),n=s(35299),i=s(99708),o=s(6132),c=s(93499),d=s(18085),m=s(61362),u=s(37586);function h(){let{token:e}=(0,l.useParams)(),r=(0,a.useRef)(null),[s,h]=(0,a.useState)(!0),[x,p]=(0,a.useState)(null),[v,f]=(0,a.useState)(!1),[y,j]=(0,a.useState)(""),[b,w]=(0,a.useState)(null),[N,g]=(0,a.useState)(""),[k,A]=(0,a.useState)(""),[S,C]=(0,a.useState)(""),[P,_]=(0,a.useState)(""),[E,M]=(0,a.useState)(!1),[L,z]=(0,a.useState)(null),R=(0,a.useCallback)(async r=>{var s,t,a;h(!0),p(null);let l=new URLSearchParams;y&&l.set("password",y),r&&l.set("versionId",r);let n=await fetch("/api/review-link/".concat(e,"?").concat(l.toString()),{cache:"no-store"}),i=await n.json().catch(()=>({}));if(!n.ok){f(!!i.requiresPassword),p(null!=(a=i.error)?a:"Falha ao abrir review link."),h(!1);return}f(!1),w(i),g(r||i.selectedVersionId||(null==(t=i.versions)||null==(s=t[0])?void 0:s.id)||""),h(!1)},[y,e]);(0,a.useEffect)(()=>{R()},[R]);let q=(0,a.useMemo)(()=>{var e,r;return b&&null!=(r=null!=(e=b.versions.find(e=>e.id===N))?e:b.versions[0])?r:null},[b,N]),O=(null==q?void 0:q.file_url)||"",T=((null==q?void 0:q.file_type)||"").toLowerCase(),D=T.includes("video")||/\.(mp4|mov|webm)$/i.test(O),I=T.includes("image")||/\.(jpg|jpeg|png|gif|webp)$/i.test(O),V=async s=>{var t,a;if(s.preventDefault(),!b||!N||!P.trim())return;M(!0),z(null);let l=r.current?Number(null!=(t=r.current.currentTime)?t:0):null,n=await fetch("/api/review-link/".concat(e,"/comments"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({versionId:N,body:P,name:k,email:S,password:y,timecodeSeconds:l})}),i=await n.json().catch(()=>({}));if(!n.ok){z(null!=(a=i.error)?a:"Falha ao enviar coment\xe1rio."),M(!1);return}_(""),z("Coment\xe1rio enviado com sucesso."),await R(N),M(!1)};return s?(0,t.jsx)("div",{className:"super-theme super-shell-bg min-h-dvh flex items-center justify-center",children:(0,t.jsxs)("div",{className:"inline-flex items-center gap-2 text-sm",style:{color:"var(--text-2)"},children:[(0,t.jsx)(n.A,{className:"h-4 w-4 animate-spin"})," A carregar review link..."]})}):v?(0,t.jsx)("div",{className:"super-theme super-shell-bg min-h-dvh px-4 py-8",children:(0,t.jsxs)("div",{className:"mx-auto max-w-md card-glass rounded-[28px] border p-6",style:{borderColor:"var(--border-soft)"},children:[(0,t.jsx)("h1",{className:"text-lg font-semibold",style:{color:"var(--text)"},children:"Review protegido"}),(0,t.jsx)("p",{className:"mt-2 text-sm",style:{color:"var(--text-2)"},children:"Este link exige password para acesso."}),(0,t.jsx)("label",{className:"label mt-4",children:"Password"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(i.A,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2",style:{color:"var(--text-3)"}}),(0,t.jsx)("input",{type:"password",className:"input w-full pl-9",value:y,onChange:e=>j(e.target.value),placeholder:"Introduz password"})]}),x?(0,t.jsxs)("div",{className:"alert alert-error mt-3",children:[(0,t.jsx)(o.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:x})]}):null,(0,t.jsx)("button",{className:"btn btn-primary mt-4 w-full",onClick:()=>void R(N||void 0),children:"Entrar no review"})]})}):b?(0,t.jsx)("div",{className:"super-theme super-shell-bg min-h-dvh px-4 py-5 md:px-8 md:py-8",children:(0,t.jsxs)("div",{className:"mx-auto grid max-w-6xl gap-5 xl:grid-cols-[minmax(0,1.4fr)_minmax(320px,0.8fr)]",children:[(0,t.jsxs)("section",{className:"card-glass rounded-[28px] border p-4 md:p-5",style:{borderColor:"var(--border-soft)"},children:[(0,t.jsxs)("div",{className:"mb-3 flex flex-wrap items-center justify-between gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-semibold",style:{color:"var(--text)"},children:b.deliverable.title}),(0,t.jsxs)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:["Expira em ",new Date(b.link.expiresAt).toLocaleDateString("pt-PT")]})]}),(0,t.jsx)("select",{className:"input h-9 min-w-[140px] text-sm",value:N,onChange:e=>{let r=e.target.value;g(r),R(r)},children:b.versions.map(e=>{var r,s;return(0,t.jsxs)("option",{value:e.id,children:["v",null!=(s=null!=(r=e.version_number)?r:e.version)?s:1]},e.id)})})]}),(0,t.jsx)("div",{className:"overflow-hidden rounded-[20px] border",style:{borderColor:"var(--border)"},children:O?D?(0,t.jsx)("video",{ref:r,controls:!0,className:"max-h-[560px] w-full bg-black",children:(0,t.jsx)("source",{src:O,type:"video/mp4"})}):I?(0,t.jsx)("img",{src:O,alt:b.deliverable.title,className:"max-h-[560px] w-full object-contain"}):(0,t.jsx)("div",{className:"flex min-h-[260px] items-center justify-center p-8 text-sm",style:{color:"var(--text-2)"},children:"Preview indispon\xedvel, abre o ficheiro externo."}):(0,t.jsx)("div",{className:"flex min-h-[260px] items-center justify-center p-8 text-sm",style:{color:"var(--text-2)"},children:"Sem ficheiro para esta vers\xe3o."})}),O?(0,t.jsxs)("a",{className:"btn btn-secondary btn-sm mt-3",href:O,target:"_blank",rel:"noopener noreferrer",children:["Abrir ficheiro ",(0,t.jsx)(c.A,{className:"h-3.5 w-3.5"})]}):null,(0,t.jsxs)("form",{onSubmit:V,className:"mt-4 space-y-2",children:[(0,t.jsxs)("div",{className:"grid gap-2 sm:grid-cols-2",children:[(0,t.jsx)("input",{className:"input h-9",placeholder:"Nome",value:k,onChange:e=>A(e.target.value)}),(0,t.jsx)("input",{className:"input h-9",placeholder:"Email (opcional)",value:S,onChange:e=>C(e.target.value)})]}),(0,t.jsx)("textarea",{className:"input min-h-24 w-full",placeholder:"Adicionar coment\xe1rio neste ponto",value:P,onChange:e=>_(e.target.value)}),(0,t.jsxs)("button",{className:"btn btn-primary",disabled:E||!P.trim()||!b.link.allowGuestComments,children:[E?(0,t.jsx)(n.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(d.A,{className:"h-4 w-4"}),"Enviar coment\xe1rio"]})]}),L?(0,t.jsxs)("div",{className:"alert mt-3",children:[(0,t.jsx)(m.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:L})]}):null]}),(0,t.jsxs)("aside",{className:"card-glass rounded-[28px] border p-4 md:p-5",style:{borderColor:"var(--border-soft)"},children:[(0,t.jsx)("h2",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:"Coment\xe1rios"}),(0,t.jsx)("div",{className:"mt-3 max-h-[70vh] space-y-3 overflow-y-auto pr-1",children:0===b.threads.length?(0,t.jsx)("div",{className:"rounded-2xl border p-3 text-sm",style:{borderColor:"var(--border)",color:"var(--text-2)"},children:"Sem coment\xe1rios nesta vers\xe3o."}):b.threads.map(e=>(0,t.jsxs)("div",{className:"rounded-2xl border p-3",style:{borderColor:"var(--border)"},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs",style:{color:"var(--text-3)"},children:[(0,t.jsx)("span",{children:function(e){if(!Number.isFinite(e))return"--:--";let r=Math.max(0,Math.floor(Number(e))),s=Math.floor(r/60).toString().padStart(2,"0"),t=(r%60).toString().padStart(2,"0");return"".concat(s,":").concat(t)}(e.timecode_seconds)}),(0,t.jsx)("span",{children:"resolved"===e.status?"Resolvido":"Aberto"})]}),e.review_comments.map(e=>(0,t.jsxs)("div",{className:"mt-2 rounded-xl bg-[var(--surface-2)] px-2.5 py-2",children:[(0,t.jsx)("p",{className:"text-xs",style:{color:"var(--text-2)"},children:e.body}),(0,t.jsxs)("p",{className:"mt-1 text-[11px]",style:{color:"var(--text-3)"},children:[(0,t.jsx)(u.A,{className:"mr-1 inline h-3 w-3"}),e.guest_name||"Utilizador"," \xb7 ",new Date(e.created_at).toLocaleString("pt-PT")]})]},e.id))]},e.id))})]})]})}):(0,t.jsx)("div",{className:"super-theme super-shell-bg min-h-dvh px-4 py-8",children:(0,t.jsx)("div",{className:"mx-auto max-w-xl card-glass rounded-[28px] border p-6",style:{borderColor:"var(--border-soft)"},children:(0,t.jsxs)("div",{className:"alert alert-error",children:[(0,t.jsx)(o.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:null!=x?x:"N\xe3o foi poss\xedvel abrir o review."})]})})})}},71847:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var t=s(12115);let a=function(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];return r.filter((e,r,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===r).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,t.forwardRef)((e,r)=>{let{color:s="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:c="",children:d,iconNode:m,...u}=e;return(0,t.createElement)("svg",{ref:r,...l,width:n,height:n,stroke:s,strokeWidth:o?24*Number(i)/Number(n):i,className:a("lucide",c),...u},[...m.map(e=>{let[r,s]=e;return(0,t.createElement)(r,s)}),...Array.isArray(d)?d:[d]])}),i=(e,r)=>{let s=(0,t.forwardRef)((s,l)=>{let{className:i,...o}=s;return(0,t.createElement)(n,{ref:l,iconNode:r,className:a("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),i),...o})});return s.displayName="".concat(e),s}},78211:(e,r,s)=>{Promise.resolve().then(s.bind(s,67117))},93499:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(71847).A)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]])},99708:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(71847).A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=78211)),_N_E=e.O()}]);