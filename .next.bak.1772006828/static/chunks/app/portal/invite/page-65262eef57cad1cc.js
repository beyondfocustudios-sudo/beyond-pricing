(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1907],{4874:(e,t,a)=>{"use strict";a.d(t,{HI:()=>i,HY:()=>o,Pm:()=>n,XC:()=>d,Y3:()=>c,bm:()=>l});var s=a(12115),r=a(41407);let l={page:{duration:.26,ease:"easeOut"},micro:{type:"spring",stiffness:380,damping:32,mass:.6},smooth:{duration:.22,ease:"easeOut"}},i={page:{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8}},tab:{initial:{opacity:0,x:12},animate:{opacity:1,x:0},exit:{opacity:0,x:-12}},listItem:{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8}},fadeIn:{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}}};function n(){return!(0,r.I)()}function c(){let e=n(),[t,a]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=window.matchMedia("(min-width: 1024px) and (hover: hover) and (pointer: fine)"),t=()=>a(e.matches);return t(),e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]),e&&t}function o(e){var t,a;return e.enabled?{whileHover:{y:null!=(t=e.hoverY)?t:-1.5},whileTap:{scale:null!=(a=e.tapScale)?a:.98},transition:l.micro}:{}}function d(e){return e?{whileHover:{y:-4,scale:1.004},transition:l.micro}:{}}},6132:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},20063:(e,t,a)=>{"use strict";var s=a(47260);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},20508:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},23664:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},41407:(e,t,a)=>{"use strict";a.d(t,{I:()=>i});var s=a(40031),r=a(15824),l=a(12115);function i(){s.r.current||(0,r.Uu)();let[e]=(0,l.useState)(s.O.current);return e}},52987:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},56154:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},61362:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},62890:(e,t,a)=>{"use strict";a.d(t,{U:()=>r});var s=a(55417);function r(){return(0,s.createBrowserClient)("https://wjzcutnjnzxylzqysneg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndqemN1dG5qbnp4eWx6cXlzbmVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMjYzMjcsImV4cCI6MjA4NjkwMjMyN30.bku3F43nks_Uq22Ag-viZZpMQfrw43eq3sahNChbBq8")}},88006:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>N});var s=a(95155),r=a(12115),l=a(20063),i=a(69434),n=a(56154),c=a(6132),o=a(61362),d=a(23664),m=a(20508),u=a(99708),p=a(52987),h=a(62890),x=a(96644),v=a(4874);function y(){return(0,s.jsxs)("svg",{className:"h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 0 1 8-8V0C5.37 0 0 5.37 0 12h4z"})]})}function f(){var e,t;let a=(0,l.useRouter)(),f=(0,l.useSearchParams)(),j=(0,v.Pm)(),N=null!=(e=f.get("token"))?e:"",[w,g]=(0,r.useState)(!0),[b,k]=(0,r.useState)(null),[A,C]=(0,r.useState)(null),[S,I]=(0,r.useState)(!1),[M,P]=(0,r.useState)(""),[z,O]=(0,r.useState)(""),[q,R]=(0,r.useState)(""),[_,E]=(0,r.useState)(!1),U=(0,r.useMemo)(()=>M?M.length<8?"Password demasiado curta":"Password v\xe1lida":"M\xednimo 8 caracteres",[M]);(0,r.useEffect)(()=>{(async()=>{var e,t;if(!N){C("Token de convite em falta."),g(!1);return}let a=await fetch("/api/clients/invites?token=".concat(encodeURIComponent(N)),{cache:"no-store"}),s=await a.json().catch(()=>({}));if(!a.ok){C(null!=(e=null==s?void 0:s.error)?e:"Convite inv\xe1lido."),g(!1);return}k({emailMasked:s.emailMasked,role:s.role,clientName:null!=(t=s.clientName)?t:null,expiresAt:s.expiresAt}),g(!1)})()},[N]);let H=async e=>{if(e.preventDefault(),S||!N)return;if(M.length<8)return void C("A password deve ter pelo menos 8 caracteres.");if(M!==z)return void C("As passwords n\xe3o coincidem.");I(!0),C(null);let t=await fetch("/api/clients/invites/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:N,password:M,fullName:q.trim()||void 0})}),s=await t.json().catch(()=>({}));if(!t.ok||!s.email){var r;C(null!=(r=s.error)?r:"N\xe3o foi poss\xedvel concluir o convite."),I(!1);return}let l=(0,h.U)();if((await l.auth.signInWithPassword({email:s.email,password:M})).error){E(!0),I(!1);return}(0,x.Ux)(x.M5.SHORT),a.push("/portal"),a.refresh()};return(0,s.jsx)("div",{className:"super-theme super-shell-bg h-dvh overflow-y-auto px-4 py-5 md:p-8",children:(0,s.jsx)(i.P.div,{initial:!!j&&"initial",animate:j?"animate":void 0,variants:v.HI.page,transition:v.bm.page,className:"mx-auto w-full max-w-[820px]",children:(0,s.jsx)("section",{className:"card-glass overflow-hidden rounded-[32px] border",style:{borderColor:"var(--border-soft)"},children:(0,s.jsxs)("div",{className:"grid min-h-[560px] md:grid-cols-[1fr_1fr]",children:[(0,s.jsxs)("aside",{className:"relative hidden border-r p-9 md:block",style:{borderColor:"var(--border)"},children:[(0,s.jsx)("div",{className:"absolute inset-0 pointer-events-none",style:{background:"radial-gradient(44rem 26rem at 20% 12%, rgba(26,143,163,0.24), transparent 60%), radial-gradient(36rem 20rem at 82% 84%, rgba(244,223,125,0.2), transparent 55%)"}}),(0,s.jsxs)("div",{className:"relative z-10",children:[(0,s.jsx)("div",{className:"inline-flex h-10 w-10 items-center justify-center rounded-2xl",style:{background:"var(--accent-primary)",color:"#fff"},children:(0,s.jsx)(n.A,{className:"h-4 w-4"})}),(0,s.jsx)("h1",{className:"mt-5 text-[1.9rem] font-[560] tracking-[-0.03em]",style:{color:"var(--text)"},children:"Convite Portal"}),(0,s.jsx)("p",{className:"mt-3 text-sm",style:{color:"var(--text-2)"},children:"Finaliza o convite para aceder ao portal cliente com seguran\xe7a."})]})]}),(0,s.jsxs)("div",{className:"p-6 sm:p-8 md:p-9",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.11em]",style:{color:"var(--text-3)"},children:"Portal Invite"}),(0,s.jsx)("h2",{className:"mt-1.5 text-[1.6rem] font-[560] tracking-[-0.03em]",style:{color:"var(--text)"},children:"Criar credenciais"}),w?(0,s.jsxs)("div",{className:"mt-8 inline-flex items-center gap-2 text-sm",style:{color:"var(--text-2)"},children:[(0,s.jsx)(y,{})," A validar convite…"]}):null,!w&&A?(0,s.jsxs)("div",{className:"alert alert-error mt-6",children:[(0,s.jsx)(c.A,{className:"h-4 w-4 shrink-0"}),(0,s.jsx)("span",{className:"text-sm",children:A})]}):null,!w&&_?(0,s.jsxs)("div",{className:"alert alert-success mt-6",children:[(0,s.jsx)(o.A,{className:"h-4 w-4 shrink-0"}),(0,s.jsx)("span",{className:"text-sm",children:"Conta criada. Faz login em `/portal/login`."})]}):null,w||A||!b?null:(0,s.jsxs)("form",{className:"mt-6 space-y-4",onSubmit:H,children:[(0,s.jsxs)("div",{className:"pill inline-flex items-center gap-2 text-xs",children:[(0,s.jsx)(d.A,{className:"h-3.5 w-3.5"}),b.emailMasked]}),(0,s.jsxs)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:["Cliente: ",null!=(t=b.clientName)?t:"—"," \xb7 Expira em ",new Date(b.expiresAt).toLocaleDateString("pt-PT")]}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)("label",{className:"label",children:"Nome (opcional)"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(m.A,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2",style:{color:"var(--text-3)"}}),(0,s.jsx)("input",{value:q,onChange:e=>R(e.target.value),className:"input w-full pl-9",placeholder:"Nome completo"})]})]}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)("label",{className:"label",children:"Password"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(u.A,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2",style:{color:"var(--text-3)"}}),(0,s.jsx)("input",{type:"password",required:!0,autoComplete:"new-password",className:"input w-full pl-9",value:M,onChange:e=>P(e.target.value),placeholder:"M\xednimo 8 caracteres"})]}),(0,s.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:U})]}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)("label",{className:"label",children:"Confirmar password"}),(0,s.jsx)("input",{type:"password",required:!0,autoComplete:"new-password",className:"input w-full",value:z,onChange:e=>O(e.target.value),placeholder:"Repetir password"})]}),(0,s.jsx)(i.P.button,{type:"submit",disabled:S,className:"btn btn-primary btn-lg w-full",...(0,v.HY)({enabled:j}),children:S?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y,{})," A concluir…"]}):(0,s.jsxs)(s.Fragment,{children:["Concluir convite ",(0,s.jsx)(p.A,{className:"h-4 w-4"})]})})]})]})]})})})})}function j(){return(0,s.jsx)("div",{className:"super-theme super-shell-bg h-dvh overflow-y-auto px-4 py-5 md:p-8",children:(0,s.jsx)("div",{className:"mx-auto flex w-full max-w-[640px] items-center justify-center rounded-[28px] border p-8 card-glass",style:{borderColor:"var(--border-soft)"},children:(0,s.jsxs)("div",{className:"inline-flex items-center gap-2 text-sm",style:{color:"var(--text-2)"},children:[(0,s.jsx)(y,{})," A carregar convite…"]})})})}function N(){return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)(j,{}),children:(0,s.jsx)(f,{})})}},96644:(e,t,a)=>{"use strict";a.d(t,{$c:()=>i,M5:()=>s,Ux:()=>l});let s={SHORT:3600,DAY:86400,LONG:2592e3},r="bp_session_ttl";function l(e){let t=JSON.stringify({login_at:Math.floor(Date.now()/1e3),ttl:e}),a="https:"===window.location.protocol?"; Secure":"";document.cookie="".concat(r,"=").concat(encodeURIComponent(t),"; Max-Age=").concat(e,"; Path=/; SameSite=").concat("Lax").concat(a)}function i(){document.cookie="".concat(r,"=; Max-Age=0; Path=/; SameSite=Lax")}},97006:(e,t,a)=>{Promise.resolve().then(a.bind(a,88006))},99708:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])}},e=>{e.O(0,[5417,6028,8441,1255,7358],()=>e(e.s=97006)),_N_E=e.O()}]);