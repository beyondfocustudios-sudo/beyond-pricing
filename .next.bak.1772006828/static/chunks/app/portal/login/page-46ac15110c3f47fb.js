(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7183],{1552:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w});var r=a(95155),s=a(12115),n=a(20063),l=a(69434),i=a(26497),c=a(56154),o=a(76907),u=a(6132),m=a(23664),d=a(52987),p=a(35626),h=a(61362),x=a(89559),v=a(62890),f=a(96644),g=a(4874),y=a(94826),j=a(82382);function b(){return(0,r.jsxs)("svg",{className:"h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 0 1 8-8V0C5.37 0 0 5.37 0 12h4z"})]})}function N(){var e,t;let a=(0,n.useRouter)(),N=(0,n.useSearchParams)(),w=(0,g.Pm)(),k="1"===N.get("expired"),C=null!=(t=(0,j.QA)(null!=(e=N.get("mode"))?e:N.get("role")))?t:"client",I="1"===N.get("mismatch"),[A,S]=(0,s.useState)("email"),[M,E]=(0,s.useState)(""),[O,P]=(0,s.useState)(""),[z,U]=(0,s.useState)(!1),[H,D]=(0,s.useState)(null),[F,_]=(0,s.useState)(null),[R,q]=(0,s.useState)(0),L=(0,s.useRef)(null);(0,s.useEffect)(()=>()=>{L.current&&clearInterval(L.current)},[]),(0,s.useEffect)(()=>{"team"===C&&a.replace((0,j.rU)("team"))},[C,a]);let Y=()=>{q(30),L.current=setInterval(()=>{q(e=>e<=1?(L.current&&clearInterval(L.current),0):e-1)},1e3)},J=async e=>{if(e.preventDefault(),!z){D(null),_(null),U(!0);try{let e=(0,v.U)(),{error:t}=await e.auth.signInWithOtp({email:M,options:{shouldCreateUser:!1}});if(t)return void D("N\xe3o foi poss\xedvel enviar o c\xf3digo. Confirma o email com a equipa.");S("otp"),P(""),Y()}finally{U(!1)}}},B=async e=>{if(e.preventDefault(),!z&&6===O.length){D(null),_(null),U(!0);try{let e=(0,v.U)(),{error:r}=await e.auth.verifyOtp({email:M,token:O.trim(),type:"email"});if(r)return void D("C\xf3digo inv\xe1lido ou expirado.");let s=await fetch("/api/auth/validate-audience?audience=".concat(C),{cache:"no-store"});if(!s.ok){var t;let r=await s.json().catch(()=>({}));await e.auth.signOut();let n="string"==typeof r.suggestedPath?r.suggestedPath:(0,j.rU)(C);_(null!=(t=r.message)?t:"Esta conta n\xe3o pertence a ".concat((0,j.j0)(C),".")),a.replace(n.includes("?")?"".concat(n,"&mismatch=1"):"".concat(n,"?mismatch=1"));return}(0,f.Ux)(f.M5.SHORT),a.push("/portal"),a.refresh()}finally{U(!1)}}},X=async()=>{if(!z&&!(R>0)){D(null),_(null),U(!0);try{let e=(0,v.U)(),{error:t}=await e.auth.signInWithOtp({email:M,options:{shouldCreateUser:!1}});if(t)return void D("Falha ao reenviar c\xf3digo.");P(""),Y()}finally{U(!1)}}};return(0,r.jsx)("div",{className:"super-theme super-shell-bg h-dvh overflow-y-auto px-4 py-5 md:p-8",children:(0,r.jsx)(l.P.div,{initial:!!w&&"initial",animate:w?"animate":void 0,variants:g.HI.page,transition:g.bm.page,className:"mx-auto w-full max-w-[980px]",children:(0,r.jsx)("section",{className:"card-glass overflow-hidden rounded-[32px] border",style:{borderColor:"var(--border-soft)"},children:(0,r.jsxs)("div",{className:"grid min-h-[620px] md:grid-cols-[1fr_1fr]",children:[(0,r.jsxs)("aside",{className:"relative hidden border-r p-9 md:block",style:{borderColor:"var(--border)"},children:[(0,r.jsx)("div",{className:"absolute inset-0 pointer-events-none",style:{background:"radial-gradient(48rem 30rem at 20% 12%, rgba(26,143,163,0.24), transparent 58%), radial-gradient(42rem 24rem at 82% 86%, rgba(244,223,125,0.2), transparent 55%)"}}),(0,r.jsxs)("div",{className:"relative z-10",children:[(0,r.jsx)("div",{className:"inline-flex h-10 w-10 items-center justify-center rounded-2xl",style:{background:"var(--accent-primary)",color:"#fff"},children:(0,r.jsx)(c.A,{className:"h-4 w-4"})}),(0,r.jsx)("h1",{className:"mt-5 text-[2rem] font-[560] tracking-[-0.03em]",style:{color:"var(--text)"},children:"Portal Cliente"}),(0,r.jsx)("p",{className:"mt-3 text-sm",style:{color:"var(--text-2)"},children:"Acesso OTP-only para acompanhar entregas, mensagens e aprova\xe7\xf5es."}),(0,r.jsxs)("div",{className:"mt-7 pill inline-flex items-center gap-2",children:[(0,r.jsx)(o.A,{className:"h-3.5 w-3.5"}),"Sess\xe3o curta e segura (1h)"]})]})]}),(0,r.jsxs)("div",{className:"p-6 sm:p-8 md:p-9",children:[(0,r.jsx)("p",{className:"text-xs uppercase tracking-[0.11em]",style:{color:"var(--text-3)"},children:(0,j.j0)(C)}),(0,r.jsx)("h2",{className:"mt-1.5 text-[1.75rem] font-[560] tracking-[-0.03em]",style:{color:"var(--text)"},children:"Entrar com c\xf3digo"}),k?(0,r.jsxs)("div",{className:"alert alert-error mt-4",children:[(0,r.jsx)(u.A,{className:"h-4 w-4 shrink-0"}),(0,r.jsx)("span",{className:"text-sm",children:"Sess\xe3o expirada. Faz login novamente."})]}):null,I?(0,r.jsxs)("div",{className:"alert alert-error mt-4",children:[(0,r.jsx)(u.A,{className:"h-4 w-4 shrink-0"}),(0,r.jsx)("span",{className:"text-sm",children:"Conta sem permiss\xe3o para este acesso."})]}):null,F?(0,r.jsxs)("div",{className:"alert alert-error mt-4",children:[(0,r.jsx)(u.A,{className:"h-4 w-4 shrink-0"}),(0,r.jsx)("span",{className:"text-sm",children:F})]}):null,(0,r.jsxs)(i.N,{mode:"wait",children:["email"===A?(0,r.jsxs)(l.P.form,{className:"mt-6 space-y-4",onSubmit:J,initial:!!w&&"initial",animate:w?"animate":void 0,exit:w?"exit":void 0,variants:g.HI.tab,transition:g.bm.page,children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("label",{className:"label",children:"Email"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(m.A,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2",style:{color:"var(--text-3)"}}),(0,r.jsx)("input",{type:"email",required:!0,autoFocus:!0,className:"input w-full pl-9",placeholder:"o.teu@email.com",value:M,onChange:e=>E(e.target.value)})]})]}),H?(0,r.jsxs)("div",{className:"alert alert-error",children:[(0,r.jsx)(u.A,{className:"h-4 w-4 shrink-0"}),(0,r.jsx)("span",{className:"text-sm",children:H})]}):null,(0,r.jsx)(l.P.button,{type:"submit",disabled:z||!M,className:"btn btn-primary btn-lg w-full",...(0,g.HY)({enabled:w}),children:z?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b,{})," A enviar…"]}):(0,r.jsxs)(r.Fragment,{children:["Enviar c\xf3digo ",(0,r.jsx)(d.A,{className:"h-4 w-4"})]})})]},"portal-email"):null,"otp"===A?(0,r.jsxs)(l.P.form,{className:"mt-6 space-y-4",onSubmit:B,initial:!!w&&"initial",animate:w?"animate":void 0,exit:w?"exit":void 0,variants:g.HI.tab,transition:g.bm.page,children:[(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("button",{type:"button",className:"mt-0.5 text-[var(--text-3)]",onClick:()=>{S("email"),P(""),D(null)},children:(0,r.jsx)(p.A,{className:"h-4 w-4"})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-sm font-medium",style:{color:"var(--text)"},children:["C\xf3digo enviado para ",M]}),(0,r.jsx)("p",{className:"text-xs",style:{color:"var(--text-3)"},children:"Introduz os 6 d\xedgitos para continuar."})]})]}),(0,r.jsx)(y.f,{value:O,onChange:e=>P(e.replace(/\D/g,"").slice(0,6)),autoFocus:!0,disabled:z}),H?(0,r.jsxs)("div",{className:"alert alert-error",children:[(0,r.jsx)(u.A,{className:"h-4 w-4 shrink-0"}),(0,r.jsx)("span",{className:"text-sm",children:H})]}):null,(0,r.jsx)(l.P.button,{type:"submit",disabled:z||6!==O.length,className:"btn btn-primary btn-lg w-full",...(0,g.HY)({enabled:w}),children:z?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b,{})," A validar…"]}):(0,r.jsxs)(r.Fragment,{children:["Entrar ",(0,r.jsx)(h.A,{className:"h-4 w-4"})]})}),(0,r.jsxs)("button",{type:"button",className:"inline-flex items-center gap-1 text-xs",onClick:X,disabled:z||R>0,style:{color:R>0?"var(--text-3)":"var(--accent-2)"},children:[(0,r.jsx)(x.A,{className:"h-3 w-3"}),R>0?"Reenviar (".concat(R,"s)"):"Reenviar c\xf3digo"]})]},"portal-otp"):null]})]})]})})})})}function w(){return(0,r.jsx)(s.Suspense,{children:(0,r.jsx)(N,{})})}},4874:(e,t,a)=>{"use strict";a.d(t,{HI:()=>l,HY:()=>o,Pm:()=>i,XC:()=>u,Y3:()=>c,bm:()=>n});var r=a(12115),s=a(41407);let n={page:{duration:.26,ease:"easeOut"},micro:{type:"spring",stiffness:380,damping:32,mass:.6},smooth:{duration:.22,ease:"easeOut"}},l={page:{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8}},tab:{initial:{opacity:0,x:12},animate:{opacity:1,x:0},exit:{opacity:0,x:-12}},listItem:{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8}},fadeIn:{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}}};function i(){return!(0,s.I)()}function c(){let e=i(),[t,a]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let e=window.matchMedia("(min-width: 1024px) and (hover: hover) and (pointer: fine)"),t=()=>a(e.matches);return t(),e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]),e&&t}function o(e){var t,a;return e.enabled?{whileHover:{y:null!=(t=e.hoverY)?t:-1.5},whileTap:{scale:null!=(a=e.tapScale)?a:.98},transition:n.micro}:{}}function u(e){return e?{whileHover:{y:-4,scale:1.004},transition:n.micro}:{}}},34732:(e,t,a)=>{Promise.resolve().then(a.bind(a,1552))},35626:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(71847).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},62890:(e,t,a)=>{"use strict";a.d(t,{U:()=>s});var r=a(55417);function s(){return(0,r.createBrowserClient)("https://wjzcutnjnzxylzqysneg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndqemN1dG5qbnp4eWx6cXlzbmVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMjYzMjcsImV4cCI6MjA4NjkwMjMyN30.bku3F43nks_Uq22Ag-viZZpMQfrw43eq3sahNChbBq8")}},82382:(e,t,a)=>{"use strict";function r(e){return e?"team"===e||"client"===e||"collaborator"===e?e:"freelancer"===e?"collaborator":null:null}function s(e){return"team"===e?"Equipa Beyond":"client"===e?"Cliente":"Colaborador"}function n(e){return"client"===e?"/portal/login?mode=client":"collaborator"===e?"/portal/login?mode=collaborator":"/login?mode=team"}a.d(t,{QA:()=>r,j0:()=>s,rU:()=>n})},94826:(e,t,a)=>{"use strict";a.d(t,{f:()=>n});var r=a(95155),s=a(12115);function n(e){let{value:t,onChange:a,length:n=6,disabled:l=!1,autoFocus:i=!1}=e,c=(0,s.useRef)([]),o=(0,s.useMemo)(()=>Array.from({length:n},(e,a)=>{var r;return null!=(r=t[a])?r:""}),[n,t]);(0,s.useEffect)(()=>{var e;if(!i||l)return;let t=o.findIndex(e=>!e),a=t>=0?t:n-1;null==(e=c.current[a])||e.focus()},[i,o,l,n]);let u=(e,t)=>{let r=o.slice();r[e]=t,a(r.join(""))};return(0,r.jsx)("div",{className:"flex items-center gap-2",children:o.map((e,t)=>(0,r.jsx)("input",{ref:e=>{c.current[t]=e},type:"text",inputMode:"numeric",autoComplete:0===t?"one-time-code":"off",maxLength:1,value:e,disabled:l,className:"h-11 w-10 rounded-xl border text-center text-base font-semibold tabular-nums outline-none transition-all",style:{borderColor:"var(--border-soft)",background:"linear-gradient(180deg, rgba(255,255,255,0.08), transparent), var(--surface-2)",color:"var(--text)"},onChange:e=>{var a;let r=e.target.value.replace(/\D/g,"").slice(-1);u(t,r),r&&t<n-1&&(null==(a=c.current[t+1])||a.focus())},onKeyDown:e=>{var a,r,s;if("Backspace"===e.key)return o[t]?void u(t,""):void(t>0&&(null==(a=c.current[t-1])||a.focus(),u(t-1,"")));"ArrowLeft"===e.key&&t>0&&(null==(r=c.current[t-1])||r.focus()),"ArrowRight"===e.key&&t<n-1&&(null==(s=c.current[t+1])||s.focus())},onPaste:e=>{var t;e.preventDefault();let r=e.clipboardData.getData("text").replace(/\D/g,"").slice(0,n);r&&(a(r),null==(t=c.current[Math.min(r.length,n)-1])||t.focus())}},t))})}},96644:(e,t,a)=>{"use strict";a.d(t,{$c:()=>l,M5:()=>r,Ux:()=>n});let r={SHORT:3600,DAY:86400,LONG:2592e3},s="bp_session_ttl";function n(e){let t=JSON.stringify({login_at:Math.floor(Date.now()/1e3),ttl:e}),a="https:"===window.location.protocol?"; Secure":"";document.cookie="".concat(s,"=").concat(encodeURIComponent(t),"; Max-Age=").concat(e,"; Path=/; SameSite=").concat("Lax").concat(a)}function l(){document.cookie="".concat(s,"=; Max-Age=0; Path=/; SameSite=Lax")}}},e=>{e.O(0,[5417,6028,498,8441,1255,7358],()=>e(e.s=34732)),_N_E=e.O()}]);